ruby:
  shopping_cart_summary_init = "
    window.app.shopping_cart_summary = new ShoppingCartSummary({
      cart: window.app.shopping_cart,
      container: '.checkout-items'
    });
  "
  preload_cart_data = "
    (function(){
      cart_data  = #{ raw cart.serialize.to_json };
      window.app.shopping_cart.updateData(cart_data);
    })();
  "
= content_for :inline_javascript do
  = raw preload_cart_data
  = raw shopping_cart_summary_init

.checkout-items
  h3.text-center
    ' Cart:
    = cart.products.length
  ul.cart-items
    - (cart.products || []).each do |product|
      li.cart-item data-id=(product.line_item_id)
        .clearfix
          = link_to product.name, collection_product_path(product), class: 'cart-item-title'
          a.remove-product.fa.fa-close.pull-right.link-grey href="#0"
        .cart-item-image-holder.pull-left
          = link_to collection_product_path(product) do
            = image_tag product.image.large, class: 'cart-item-image'
        .cart-item-info
          .heading
            span.qty 
              ' Qty:
              =' "#{product.quantity}"
            span 
              ' /
            span 
              ' Size: #{ product.size.presentation }
            span 
              ' /
            span 
              ' Color:
              span.color style="background-color: #{ product.color.value}; border: 1px solid gray;"
          .cart-prices
            div = product.price.display_price
            - if product.making_options.present?
              - product.making_options.each do |option|
                .small 
                  = "+ #{ option.display_price.to_s } #{ option.name }"
                  = link_to '', '#', class: 'fa fa-close making-option-remove', data: { id: option.id }
            - if product.customizations.present?
              - product.customizations.each do |customization|
                .small 
                  = "+ #{ customization.display_price.to_s } #{ customization.name }"
                  = link_to '', '#', class: 'fa fa-close customization-remove'
            /.total 
              ' = $999.99

  /! cd-cart-items
  form.promo-code action="#"
    label for=""  Promo Code
    .input-group
      input.form-control.form-control-md#promotion-code type="text"
      span.input-group-addon
        button.btn-submit.btn-reset Apply

  / hr
  p
    | Sub Total
    span.pull-right = cart.display_item_total.to_s
  p
    | Shipping
    span.pull-right = cart.display_shipment_total.present? ? cart.display_shipment_total.to_s : 'Free Shipping'
  p
    | Promotion
    span.pull-right = cart.display_promotion_total.to_s
  / hr
  p
    strong
      | Total
      span.pull-right = cart.display_total.to_s
      - if current_site_version.is_australia?
        .taxes Including GST
