ruby:
  init_items_counter_sync = "
    (function(){
      var updateShoppingBagCounter = function() {
        $('.js-cart-item-count').html(window.app.shopping_cart.data.item_count);
      };
      window.app.shopping_cart.on('change', updateShoppingBagCounter);
      updateShoppingBagCounter();
    })();
  "
  init_style_quiz = ""
  if Features.active?(:style_quiz)
    init_style_quiz = "
      (function(){
        $('#style-quiz-trigger').on('click', function(e) {
          e.preventDefault();
          $iframe = $('<iframe />', {
            src: urlWithSitePrefix('/style_quiz'),
            frameBorder: '0',
            width: '1102px',
            height: '680px'
          });

          if ($('#quiz_popup').length > 0) {
            $('#quiz_popup').find('iframe').replaceWith($iframe);
          } else {
            $content = $('<div />', { id: 'quiz_popup' }).html($iframe);
            vex.open({
              content: $content,
              className: 'vex-dialog-default vex-dialog-quiz'
            });
          };
        });
      })();
    "
  end

  side_menu_init = "
    window.app.side_menu = new SideMenu({
      container:              '#sideMenu',
      sideMenuTrigger:        '#side-menu-trigger',
      close:                  '#sideMenu #close',
      arrowImg:               '.arrow img',
      dropdownMenu:           '.dropdown-menu'
    });
  "

= content_for :inline_javascript do
  = raw init_items_counter_sync
  = raw init_style_quiz
  = raw side_menu_init

.js-talkable-gleam-bar-top.talkable-gleam-bar

- cache [:layout, :header, spree_user_signed_in?, @locale_warning.cache_key], expires_in: configatron.cache.expire.long do

  header.main.js-header

    .nav-menu.nav-alert-top
      #fixed-header.fixed-header.js-fixed-header
        = render 'layouts/redesign/header/locale_warn/base', warning: @locale_warning
        = render 'layouts/redesign/header/gray_top_banner/base'

      = render 'layouts/redesign/header/locale_selector/mobile'

      .container-fluid.mobile-header-fluid
        #masthead-container.cfix
          .masthead.pull-left.visible-xs.visible-sm
            nav.navbar.navbar-default.visible-xs.visible-sm.hamburger role="navigation"
              .navbar-header
                button.navbar-toggle.visible-xs.visible-sm#side-menu-trigger type="button" onclick="typeof window === 'object' && !!window.ga ?  window.ga('send', 'event', { eventCategory: 'Top Nav', eventAction: 'Menu Open', eventLabel: null, nonInteraction: false }) : console.log('Google analytics not found')"
                  = image_tag('Hamburger.svg', height: '25px')

          .mobile-logo-area.visible-xs.visible-sm
            = link_to root_path do
              = image_tag src='logo/new-logo.svg', :alt => 'Fame and Partners'

          .masthead.nav-icons.pull-right.visible-xs.visible-sm
            span.shopping-bag-wrapper.js-header-toolbar
              a.trigger-shopping-cart.js-trigger-shopping-bag href='javascript:;'
                span.icon.icon-bag
                span.count.js-cart-item-count 0

    - unless disable_notices?
      = render 'layouts/redesign/notices'
    = render 'layouts/redesign/campaigns/auto_apply_promo_code'

  = render 'layouts/redesign/new_this_week'

  #sideMenu
    = render 'layouts/redesign/header/simplified_side_nav'
javascript:
  function sendToGA(eventObject) {
      if(typeof window === 'object' && !!window.ga) {
        window.ga('send', 'event', eventObject)
      }
      else {
        console.log('Google analytics not found')
      }
  }
