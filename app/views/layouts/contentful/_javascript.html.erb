<!-- Body End is for Javascript that needs to be loaded after markup -->
<%= yield :body_end %>

<!-- bootstrap -->
<script type="text/javascript">
  window.app = {
    env:    '<%= Rails.env %>',
    debug:  <%= Rails.env.development? %>,
    user:   { id: <%= current_spree_user.present? ? current_spree_user.id : 'null' %> },
    user_signed_in: <%= signed_in? %>,
    site_version: {  name: '<%= current_site_version.try(:name) %>' },
    current_site_version: <%= raw SiteVersionSerializer.new(current_site_version).to_json %>,
    shopping_cart: new helpers.ShoppingCart({track: <%= Rails.env.production? || Features.active?(:test_analytics, current_spree_user) %>}),
    events: $({})
  };

  $(document).ready(function(){
    // Inline Javascript is for javascript to be executed after DOM Content loaded event fired
    <%= yield :inline_javascript %>

    // init here allows assigned listeners to update data
    window.app.shopping_cart.setItemCount(<%= current_order.try(:item_count).to_i %>);
  });

  $(document).ready(function () {
    initProductCollectionImageHover({
      selector: 'body',
      delegate: '.js-product-image'
    });
  });

  // Autoplay videos (for Chrome and other browsers)
  $(document).ready(function () {
    var countVideosOnPage = $(".js-autoload-video").size();
    for(i = 0; i < countVideosOnPage; i++) {
      $(".js-autoload-video").get(i).play();
    }
  });

  // Collapsible panel
  $(document).ready(function(){
    if ($(".js-collapsible-panel").length) {

      // Get current URL hash
      var hash = document.location.hash;

      // Check if URL matches an existing entry to make it expand on page load
      if ($(hash).length) {
        // Expand the desired anchor entry
        $(hash).prop("checked", true);
      } else {
        // Expand first entry if this is a desired option
        $(".js-collapsible-panel--expand-first-entry .Panel:first-of-type input").prop("checked", true);
      }

      // Update URL as user clicks on collapsible panels
      $(".js-collapsible-panel .Panel__label").on("click", function(e) {
        history.pushState({}, '', "#"+$(this).attr('for')+"");
      });

    }
  });
</script>

<% # Check if current landing page's settings allow fade-in/out effects while users scroll %>
<% if @landing_page_container %>
  <% lp_fade_scroll = @landing_page_container[:fade_scroll] %>
  <% if lp_fade_scroll %>
    <script>
      (function(window) {
        $(function(){

          // Add trigger dynamically
          $('.LandingPage__RowsContainer .section-row').addClass('js-scroll-fade-in');

          // Scroll & Fade
          window.sr = ScrollReveal({ reset: true, easing: 'linear', scale: 1, distance: 0, duration: 500, viewFactor: 0.05 });
          sr.reveal('.js-scroll-fade-in');

        });
      })(window)
    </script>
  <% end %>
<% end %>
