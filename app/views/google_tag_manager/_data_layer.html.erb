<%# - Always use `#push()` with dataLayer %>
<%# - dataLayer must be declared above tag manager JS import %>
<%# http://www.simoahava.com/gtm-tips/datalayer-declaration-vs-push/ %>

<script>window.dataLayer = window.dataLayer || [];</script>

<%
   # TODO: probably better not having this here, and putting it properly on a before_filter
   user      = Marketing::Gtm::UserPresenter.new(spree_user: spree_current_user, request_ip: request.ip)
   device    = Marketing::Gtm::DevicePresenter.new(user_agent: request.user_agent)
   site      = Marketing::Gtm::SitePresenter.new(current_site_version: current_site_version)
   container = Marketing::Gtm::Container.new(presenters: [user, device, site])
%>

<script>
    dataLayer.push(<%= container.to_json.html_safe %>);
</script>

