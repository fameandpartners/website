// Generated by CoffeeScript 1.3.3
var EmailCaptureModalPopup;

window.popups || (window.popups = {});

window.popups.EmailCaptureModalPopup = EmailCaptureModalPopup = (function() {

  EmailCaptureModalPopup.prototype.contentLoaded = false;

  function EmailCaptureModalPopup() {
    _.bindAll(this, 'hide', 'show', 'showModalWindow');
    _.bindAll(this, 'closeButtonClickHandler', 'keyPressHandler');
    this.container = window.popups.getModalContainer(null, null);
    this.container.on('click', '.close-lightbox, .overlay', this.closeButtonClickHandler);
    $(document).bind('keyup', this.keyPressHandler);
  }

  EmailCaptureModalPopup.prototype.show = function(content) {
    return this.popupLoadRequest(content).done(this.showModalWindow).fail(this.hide);
  };

  EmailCaptureModalPopup.prototype.hide = function() {
    this.container.hide();
    $.cookie('email_capture', 'hide', {
      expires: 365,
      path: '/'
    });
    $(document).unbind('keyup', this.keyPressHandler);
    return this;
  };

  EmailCaptureModalPopup.prototype.closeButtonClickHandler = function(e) {
    e.preventDefault();
    return this.hide();
  };

  EmailCaptureModalPopup.prototype.keyPressHandler = function(e) {
    if (e.which === 27) {
      return this.hide();
    }
  };

  EmailCaptureModalPopup.prototype.popupLoadRequest = function(content) {
    var loadHtmlUrl;
    loadHtmlUrl = urlWithSitePrefix("/campaigns/email_capture/new?content=" + content);
    return $.ajax({
      url: loadHtmlUrl,
      type: 'GET',
      dataType: 'html'
    });
  };

  EmailCaptureModalPopup.prototype.showModalWindow = function(formHtml) {
    this.container.addClass('birthday-popup').show();
    this.container.find('.modal-container .item').addClass('modal-form').html(formHtml);
    return this.container.find('.modal-container').css({
      width: '700px'
    }).center();
  };

  return EmailCaptureModalPopup;

})();
