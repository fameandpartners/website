!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b=b.Twilio||(b.Twilio={}),b=b.Chat||(b.Chat={}),b.Client=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={default:a("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":41}],2:[function(a,b,c){b.exports={default:a("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":42}],3:[function(a,b,c){b.exports={default:a("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":43}],4:[function(a,b,c){b.exports={default:a("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":44}],5:[function(a,b,c){b.exports={default:a("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":45}],6:[function(a,b,c){b.exports={default:a("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":46}],7:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":47}],8:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":48}],9:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":49}],10:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":50}],11:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":51}],12:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":52}],13:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":53}],14:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":54}],15:[function(a,b,c){b.exports={default:a("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":55}],16:[function(a,b,c){b.exports={default:a("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":56}],17:[function(a,b,c){b.exports={default:a("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":57}],18:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":58}],19:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":59}],20:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/promise"),e=f(d);c.default=function(a){return function(){var b=a.apply(this,arguments);return new e.default(function(a,c){function d(f,g){try{var h=b[f](g),i=h.value}catch(a){return void c(a)}return h.done?void a(i):e.default.resolve(i).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}},{"../core-js/promise":15}],21:[function(a,b,c){"use strict";c.__esModule=!0,c.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}},{}],22:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/object/define-property"),e=f(d);c.default=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,e.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()},{"../core-js/object/define-property":10}],23:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/object/assign"),e=f(d);c.default=e.default||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}},{"../core-js/object/assign":7}],24:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/object/set-prototype-of"),e=j(d),f=a("../core-js/object/create"),g=j(f),h=a("../helpers/typeof"),i=j(h);c.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof b?"undefined":(0,i.default)(b)));a.prototype=(0,g.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(e.default?(0,e.default)(a,b):a.__proto__=b)}},{"../core-js/object/create":8,"../core-js/object/set-prototype-of":14,"../helpers/typeof":27}],25:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../helpers/typeof"),e=f(d);c.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==("undefined"==typeof b?"undefined":(0,e.default)(b))&&"function"!=typeof b?a:b}},{"../helpers/typeof":27}],26:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/is-iterable"),e=h(d),f=a("../core-js/get-iterator"),g=h(f);c.default=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var i,h=(0,g.default)(a);!(d=(i=h.next()).done)&&(c.push(i.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if((0,e.default)(Object(b)))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":2,"../core-js/is-iterable":3}],27:[function(a,b,c){"use strict";function i(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var d=a("../core-js/symbol/iterator"),e=i(d),f=a("../core-js/symbol"),g=i(f),h="function"==typeof g.default&&"symbol"==typeof e.default?function(a){return typeof a}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":typeof a};c.default="function"==typeof g.default&&"symbol"===h(e.default)?function(a){return"undefined"==typeof a?"undefined":h(a)}:function(a){return a&&"function"==typeof g.default&&a.constructor===g.default&&a!==g.default.prototype?"symbol":"undefined"==typeof a?"undefined":h(a)}},{"../core-js/symbol":18,"../core-js/symbol/iterator":19}],28:[function(a,b,c){b.exports=a("regenerator-runtime")},{"regenerator-runtime":179}],29:[function(a,b,c){var d=a("./lib/backoff"),e=a("./lib/strategy/exponential"),f=a("./lib/strategy/fibonacci"),g=a("./lib/function_call.js");b.exports.Backoff=d,b.exports.FunctionCall=g,b.exports.FibonacciStrategy=f,b.exports.ExponentialStrategy=e,b.exports.fibonacci=function(a){return new d(new f(a))},b.exports.exponential=function(a){return new d(new e(a))},b.exports.call=function(a,b,c){var d=Array.prototype.slice.call(arguments);return a=d[0],b=d.slice(1,d.length-1),c=d[d.length-1],new g(a,b,c)}},{"./lib/backoff":30,"./lib/function_call.js":31,"./lib/strategy/exponential":32,"./lib/strategy/fibonacci":33}],30:[function(a,b,c){function g(a){d.EventEmitter.call(this),this.backoffStrategy_=a,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}var d=a("events"),e=a("precond"),f=a("util");f.inherits(g,d.EventEmitter),g.prototype.failAfter=function(a){e.checkArgument(a>0,"Expected a maximum number of retry greater than 0 but got %s.",a),this.maxNumberOfRetry_=a},g.prototype.backoff=function(a){e.checkState(this.timeoutID_===-1,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",a),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,a))},g.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},g.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},b.exports=g},{events:169,precond:175,util:223}],31:[function(a,b,c){function i(a,b,c){d.EventEmitter.call(this),e.checkIsFunction(a,"Expected fn to be a function."),e.checkIsArray(b,"Expected args to be an array."),e.checkIsFunction(c,"Expected callback to be a function."),this.function_=a,this.arguments_=b,this.callback_=c,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=i.DEFAULT_RETRY_PREDICATE_,this.state_=i.State_.PENDING}var d=a("events"),e=a("precond"),f=a("util"),g=a("./backoff"),h=a("./strategy/fibonacci");f.inherits(i,d.EventEmitter),i.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},i.DEFAULT_RETRY_PREDICATE_=function(a){return!0},i.prototype.isPending=function(){return this.state_==i.State_.PENDING},i.prototype.isRunning=function(){return this.state_==i.State_.RUNNING},i.prototype.isCompleted=function(){return this.state_==i.State_.COMPLETED},i.prototype.isAborted=function(){return this.state_==i.State_.ABORTED},i.prototype.setStrategy=function(a){return e.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=a,this},i.prototype.retryIf=function(a){return e.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=a,this},i.prototype.getLastResult=function(){return this.lastResult_.concat()},i.prototype.getNumRetries=function(){return this.numRetries_},i.prototype.failAfter=function(a){return e.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=a,this},i.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=i.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},i.prototype.start=function(a){e.checkState(!this.isAborted(),"FunctionCall is aborted."),e.checkState(this.isPending(),"FunctionCall already started.");var b=this.strategy_||new h;this.backoff_=a?a(b):new g(b),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=i.State_.RUNNING,this.doCall_(!1)},i.prototype.doCall_=function(a){a&&this.numRetries_++;var b=["call"].concat(this.arguments_);d.EventEmitter.prototype.emit.apply(this,b);var c=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(c))},i.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},i.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var a=Array.prototype.slice.call(arguments);this.lastResult_=a,d.EventEmitter.prototype.emit.apply(this,["callback"].concat(a));var b=a[0];b&&this.retryPredicate_(b)?this.backoff_.backoff(b):(this.state_=i.State_.COMPLETED,this.doCallback_())}},i.prototype.handleBackoff_=function(a,b,c){this.emit("backoff",a,b,c)},b.exports=i},{"./backoff":30,"./strategy/fibonacci":33,events:169,precond:175,util:223}],32:[function(a,b,c){function g(a){f.call(this,a),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=g.DEFAULT_FACTOR,a&&void 0!==a.factor&&(e.checkArgument(a.factor>1,"Exponential factor should be greater than 1 but got %s.",a.factor),this.factor_=a.factor)}var d=a("util"),e=a("precond"),f=a("./strategy");d.inherits(g,f),g.DEFAULT_FACTOR=2,g.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},g.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},b.exports=g},{"./strategy":34,precond:175,util:223}],33:[function(a,b,c){function f(a){e.call(this,a),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}var d=a("util"),e=a("./strategy");d.inherits(f,e),f.prototype.next_=function(){var a=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=a,a},f.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},b.exports=f},{"./strategy":34,util:223}],34:[function(a,b,c){function f(a){return void 0!==a&&null!==a}function g(a){if(a=a||{},f(a.initialDelay)&&a.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(f(a.maxDelay)&&a.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=a.initialDelay||100,this.maxDelay_=a.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(f(a.randomisationFactor)&&(a.randomisationFactor<0||a.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=a.randomisationFactor||0}a("events"),a("util");g.prototype.getMaxDelay=function(){return this.maxDelay_},g.prototype.getInitialDelay=function(){return this.initialDelay_},g.prototype.next=function(){var a=this.next_(),b=1+Math.random()*this.randomisationFactor_,c=Math.round(a*b);return c},g.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},g.prototype.reset=function(){this.reset_()},g.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},b.exports=g},{events:169,util:223}],35:[function(_dereq_,module,exports){(function(process,global){!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Promise=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof _dereq_&&_dereq_;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof _dereq_&&_dereq_,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=function(a){function c(a){var c=new b(a),d=c.promise();return c.setHowMany(1),c.setUnwrap(),c.init(),d}var b=a._SomePromiseArray;a.any=function(a){return c(a)},a.prototype.any=function(){return c(this)}}},{}],2:[function(a,b,c){"use strict";function h(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new f(16),this._normalQueue=new f(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=e}function i(a,b,c){this._lateQueue.push(a,b,c),this._queueTick()}function j(a,b,c){this._normalQueue.push(a,b,c),this._queueTick()}function k(a){this._normalQueue._pushOne(a),this._queueTick()}var d;try{throw new Error}catch(a){d=a}var e=a("./schedule"),f=a("./queue"),g=a("./util");h.prototype.setScheduler=function(a){var b=this._schedule;return this._schedule=a,this._customScheduler=!0,b},h.prototype.hasCustomScheduler=function(){return this._customScheduler},h.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},h.prototype.disableTrampolineIfNecessary=function(){g.hasDevTools&&(this._trampolineEnabled=!1)},h.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},h.prototype.fatalError=function(a,b){b?(process.stderr.write("Fatal "+(a instanceof Error?a.stack:a)+"\n"),process.exit(2)):this.throwLater(a)},h.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(a){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},g.hasDevTools?(h.prototype.invokeLater=function(a,b,c){this._trampolineEnabled?i.call(this,a,b,c):this._schedule(function(){setTimeout(function(){a.call(b,c)},100)})},h.prototype.invoke=function(a,b,c){this._trampolineEnabled?j.call(this,a,b,c):this._schedule(function(){a.call(b,c)})},h.prototype.settlePromises=function(a){this._trampolineEnabled?k.call(this,a):this._schedule(function(){a._settlePromises()})}):(h.prototype.invokeLater=i,h.prototype.invoke=j,h.prototype.settlePromises=k),h.prototype._drainQueue=function(a){for(;a.length()>0;){var b=a.shift();if("function"==typeof b){var c=a.shift(),d=a.shift();b.call(c,d)}else b._settlePromises()}},h.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},h.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},h.prototype._reset=function(){this._isTickUsed=!1},b.exports=h,b.exports.firstLineError=d},{"./queue":26,"./schedule":29,"./util":36}],3:[function(a,b,c){"use strict";b.exports=function(a,b,c,d){var e=!1,f=function(a,b){this._reject(b)},g=function(a,b){b.promiseRejectionQueued=!0,b.bindingPromise._then(f,f,null,this,a)},h=function(a,b){0===(50397184&this._bitField)&&this._resolveCallback(b.target)},i=function(a,b){b.promiseRejectionQueued||this._reject(a)};a.prototype.bind=function(f){e||(e=!0,a.prototype._propagateFrom=d.propagateFromFunction(),a.prototype._boundValue=d.boundValueFunction());var j=c(f),k=new a(b);k._propagateFrom(this,1);var l=this._target();if(k._setBoundTo(j),j instanceof a){var m={promiseRejectionQueued:!1,promise:k,target:l,bindingPromise:j};l._then(b,g,void 0,k,m),j._then(h,i,void 0,k,m),k._setOnCancel(j)}else k._resolveCallback(l);return k},a.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=2097152|this._bitField,this._boundTo=a):this._bitField=this._bitField&-2097153},a.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},a.bind=function(b,c){return a.resolve(c).bind(b)}}},{}],4:[function(a,b,c){"use strict";function e(){try{Promise===f&&(Promise=d)}catch(a){}return f}var d;"undefined"!=typeof Promise&&(d=Promise);var f=a("./promise")();f.noConflict=e,b.exports=f},{"./promise":22}],5:[function(a,b,c){"use strict";var d=Object.create;if(d){var e=d(null),f=d(null);e[" size"]=f[" size"]=0}b.exports=function(b){function m(a,d){var e;if(null!=a&&(e=a[d]),"function"!=typeof e){var f="Object "+c.classString(a)+" has no method '"+c.toString(d)+"'";throw new b.TypeError(f)}return e}function n(a){var b=this.pop(),c=m(a,b);return c.apply(a,this)}function o(a){return a[this]}function p(a){var b=+this;return b<0&&(b=Math.max(0,b+a.length)),a[b]}var i,c=a("./util"),d=c.canEvaluate;c.isIdentifier;b.prototype.call=function(a){var b=[].slice.call(arguments,1);return b.push(a),this._then(n,void 0,void 0,b,void 0)},b.prototype.get=function(a){var c,b="number"==typeof a;if(b)c=p;else if(d){var e=i(a);c=null!==e?e:o}else c=o;return this._then(c,void 0,void 0,a,void 0)}}},{"./util":36}],6:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){var f=a("./util"),g=f.tryCatch,h=f.errorObj,i=b._async;b.prototype.break=b.prototype.cancel=function(){if(!e.cancellation())return this._warn("cancellation is disabled");for(var a=this,b=a;a._isCancellable();){if(!a._cancelBy(b)){b._isFollowing()?b._followee().cancel():b._cancelBranched();break}var c=a._cancellationParent;if(null==c||!c._isCancellable()){a._isFollowing()?a._followee().cancel():a._cancelBranched();break}a._isFollowing()&&a._followee().cancel(),a._setWillBeCancelled(),b=a,a=c}},b.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},b.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},b.prototype._cancelBy=function(a){return a===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},b.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},b.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),i.invoke(this._cancelPromises,this,void 0))},b.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},b.prototype._unsetOnCancel=function(){this._onCancelField=void 0},b.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},b.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},b.prototype._doInvokeOnCancel=function(a,b){if(f.isArray(a))for(var c=0;c<a.length;++c)this._doInvokeOnCancel(a[c],b);else if(void 0!==a)if("function"==typeof a){if(!b){var d=g(a).call(this._boundValue());d===h&&(this._attachExtraTrace(d.e),i.throwLater(d.e))}}else a._resultCancelled(this)},b.prototype._invokeOnCancel=function(){var a=this._onCancel();this._unsetOnCancel(),i.invoke(this._doInvokeOnCancel,this,a)},b.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},b.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(a,b,c){"use strict";b.exports=function(b){function g(a,g,h){return function(i){var j=h._boundValue();a:for(var k=0;k<a.length;++k){var l=a[k];if(l===Error||null!=l&&l.prototype instanceof Error){if(i instanceof l)return e(g).call(j,i)}else if("function"==typeof l){var m=e(l).call(j,i);if(m===f)return m;if(m)return e(g).call(j,i)}else if(c.isObject(i)){for(var n=d(l),o=0;o<n.length;++o){var p=n[o];if(l[p]!=i[p])continue a}return e(g).call(j,i)}}return b}}var c=a("./util"),d=a("./es5").keys,e=c.tryCatch,f=c.errorObj;return g}},{"./es5":13,"./util":36}],8:[function(a,b,c){"use strict";b.exports=function(a){function d(){this._trace=new d.CapturedTrace(f())}function e(){if(b)return new d}function f(){var a=c.length-1;if(a>=0)return c[a]}var b=!1,c=[];return a.prototype._promiseCreated=function(){},a.prototype._pushContext=function(){},a.prototype._popContext=function(){return null},a._peekContext=a.prototype._peekContext=function(){},d.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,c.push(this._trace))},d.prototype._popContext=function(){if(void 0!==this._trace){var a=c.pop(),b=a._promiseCreated;return a._promiseCreated=null,b}return null},d.CapturedTrace=null,d.create=e,d.deactivateLongStackTraces=function(){},d.activateLongStackTraces=function(){var c=a.prototype._pushContext,e=a.prototype._popContext,g=a._peekContext,h=a.prototype._peekContext,i=a.prototype._promiseCreated;d.deactivateLongStackTraces=function(){a.prototype._pushContext=c,a.prototype._popContext=e,a._peekContext=g,a.prototype._peekContext=h,a.prototype._promiseCreated=i,b=!1},b=!0,a.prototype._pushContext=d.prototype._pushContext,a.prototype._popContext=d.prototype._popContext,a._peekContext=a.prototype._peekContext=f,a.prototype._promiseCreated=function(){var a=this._peekContext();a&&null==a._promiseCreated&&(a._promiseCreated=this)}},d}},{}],9:[function(a,b,c){"use strict";b.exports=function(b,c){function y(a,b){return{promise:b}}function B(){return!1}function C(a,b,c){var d=this;try{a(b,c,function(a){if("function"!=typeof a)throw new TypeError("onCancel must be a function, got: "+g.toString(a));d._attachCancellationCallback(a)})}catch(a){return a}}function D(a){if(!this._isCancellable())return this;var b=this._onCancel();void 0!==b?g.isArray(b)?b.push(a):this._setOnCancel([b,a]):this._setOnCancel(a)}function E(){return this._onCancelField}function F(a){this._onCancelField=a}function G(){this._cancellationParent=void 0,this._onCancelField=void 0}function H(a,b){if(0!==(1&b)){this._cancellationParent=a;var c=a._branchesRemainingToCancel;void 0===c&&(c=0),a._branchesRemainingToCancel=c+1}0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function I(a,b){0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function K(){var a=this._boundTo;return void 0!==a&&a instanceof b?a.isFulfilled()?a.value():void 0:a}function L(){this._trace=new da(this._peekContext())}function M(a,b){if(h(a)){var c=this._trace;if(void 0!==c&&b&&(c=c._parent),void 0!==c)c.attachExtraTrace(a);else if(!a.__stackCleaned__){var d=V(a);g.notEnumerableProp(a,"stack",d.message+"\n"+d.stack.join("\n")),g.notEnumerableProp(a,"__stackCleaned__",!0)}}}function N(a,b,c,d,e){if(void 0===a&&null!==b&&u){if(void 0!==e&&e._returnedNonUndefined())return;if(0===(65535&d._bitField))return;c&&(c+=" ");var f="",g="";if(b._trace){for(var h=b._trace.stack.split("\n"),i=T(h),j=i.length-1;j>=0;--j){var k=i[j];if(!l.test(k)){var n=k.match(m);n&&(f="at "+n[1]+":"+n[2]+":"+n[3]+" ");break}}if(i.length>0)for(var o=i[0],j=0;j<h.length;++j)if(h[j]===o){j>0&&(g="\n"+h[j-1]);break}}var p="a promise was created in a "+c+"handler "+f+"but was not returned from it, see http://goo.gl/rRqMUw"+g;d._warn(p,!0,b)}}function O(a,b){var c=a+" is deprecated and will be removed in a future version.";return b&&(c+=" Use "+b+" instead."),P(c)}function P(a,c,d){if(fa.warnings){var g,e=new f(a);if(c)d._attachExtraTrace(e);else if(fa.longStackTraces&&(g=b._peekContext()))g.attachExtraTrace(e);else{var h=V(e);e.stack=h.message+"\n"+h.stack.join("\n")}A("warning",e)||W(e,"",!0)}}function Q(a,b){for(var c=0;c<b.length-1;++c)b[c].push("From previous event:"),b[c]=b[c].join("\n");return c<b.length&&(b[c]=b[c].join("\n")),a+"\n"+b.join("\n")}function R(a){for(var b=0;b<a.length;++b)(0===a[b].length||b+1<a.length&&a[b][0]===a[b+1][0])&&(a.splice(b,1),b--)}function S(a){for(var b=a[0],c=1;c<a.length;++c){for(var d=a[c],e=b.length-1,f=b[e],g=-1,h=d.length-1;h>=0;--h)if(d[h]===f){g=h;break}for(var h=g;h>=0;--h){var i=d[h];if(b[e]!==i)break;b.pop(),e--}b=d}}function T(a){for(var b=[],c=0;c<a.length;++c){var d=a[c],e="    (No stack trace)"===d||n.test(d),f=e&&_(d);e&&!f&&(p&&" "!==d.charAt(0)&&(d="    "+d),b.push(d))}return b}function U(a){for(var b=a.stack.replace(/\s+$/g,"").split("\n"),c=0;c<b.length;++c){var d=b[c];if("    (No stack trace)"===d||n.test(d))break}return c>0&&"SyntaxError"!=a.name&&(b=b.slice(c)),b}function V(a){var b=a.stack,c=a.toString();return b="string"==typeof b&&b.length>0?U(a):["    (No stack trace)"],{message:c,stack:"SyntaxError"==a.name?b:T(b)}}function W(a,b,c){if("undefined"!=typeof console){var d;if(g.isObject(a)){var e=a.stack;d=b+o(e,a)}else d=b+String(a);"function"==typeof q?q(d,c):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(d)}}function X(a,b,c,d){var f=!1;try{"function"==typeof b&&(f=!0,"rejectionHandled"===a?b(d):b(c,d))}catch(a){e.throwLater(a)}"unhandledRejection"===a?A(a,c,d)||f||W(c,"Unhandled rejection "):A(a,d)}function Y(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a&&"function"==typeof a.toString?a.toString():g.toString(a);var c=/\[object [a-zA-Z0-9$_]+\]/;if(c.test(b))try{var d=JSON.stringify(a);b=d}catch(a){}0===b.length&&(b="(empty array)")}return"(<"+Z(b)+">, no stack trace)"}function Z(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function $(){return"function"==typeof ea}function ba(a){var b=a.match(aa);if(b)return{fileName:b[1],line:parseInt(b[2],10)}}function ca(a,b){if($()){for(var g,h,c=a.stack.split("\n"),d=b.stack.split("\n"),e=-1,f=-1,i=0;i<c.length;++i){var j=ba(c[i]);if(j){g=j.fileName,e=j.line;break}}for(var i=0;i<d.length;++i){var j=ba(d[i]);if(j){h=j.fileName,f=j.line;break}}e<0||f<0||!g||!h||g!==h||e>=f||(_=function(a){if(k.test(a))return!0;var b=ba(a);return!!(b&&b.fileName===g&&e<=b.line&&b.line<=f)})}}function da(a){this._parent=a,this._promisesCreated=0;var b=this._length=1+(void 0===a?0:a._length);ea(this,da),b>32&&this.uncycle()}var i,j,q,d=b._getDomain,e=b._async,f=a("./errors").Warning,g=a("./util"),h=g.canAttachTrace,k=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,l=/\((?:timers\.js):\d+:\d+\)/,m=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,n=null,o=null,p=!1,r=!(0==g.env("BLUEBIRD_DEBUG")),s=!(0==g.env("BLUEBIRD_WARNINGS")||!r&&!g.env("BLUEBIRD_WARNINGS")),t=!(0==g.env("BLUEBIRD_LONG_STACK_TRACES")||!r&&!g.env("BLUEBIRD_LONG_STACK_TRACES")),u=0!=g.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(s||!!g.env("BLUEBIRD_W_FORGOTTEN_RETURN"));b.prototype.suppressUnhandledRejections=function(){var a=this._target();a._bitField=a._bitField&-1048577|524288},b.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),e.invokeLater(this._notifyUnhandledRejection,this,void 0))},b.prototype._notifyUnhandledRejectionIsHandled=function(){X("rejectionHandled",i,void 0,this)},b.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},b.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue();this._setUnhandledRejectionIsNotified(),X("unhandledRejection",j,a,this)}},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},b.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},b.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},b.prototype._warn=function(a,b,c){return P(a,b,c||this)},b.onPossiblyUnhandledRejection=function(a){var b=d();j="function"==typeof a?null===b?a:g.domainBind(b,a):void 0},b.onUnhandledRejectionHandled=function(a){var b=d();i="function"==typeof a?null===b?a:g.domainBind(b,a):void 0};var v=function(){};b.longStackTraces=function(){if(e.haveItemsQueued()&&!fa.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!fa.longStackTraces&&$()){var a=b.prototype._captureStackTrace,d=b.prototype._attachExtraTrace;fa.longStackTraces=!0,v=function(){if(e.haveItemsQueued()&&!fa.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");b.prototype._captureStackTrace=a,b.prototype._attachExtraTrace=d,c.deactivateLongStackTraces(),e.enableTrampoline(),fa.longStackTraces=!1},b.prototype._captureStackTrace=L,b.prototype._attachExtraTrace=M,c.activateLongStackTraces(),e.disableTrampolineIfNecessary()}},b.hasLongStackTraces=function(){return fa.longStackTraces&&$()};var w=function(){try{if("function"==typeof CustomEvent){var a=new CustomEvent("CustomEvent");return g.global.dispatchEvent(a),function(a,b){var c=new CustomEvent(a.toLowerCase(),{detail:b,cancelable:!0});return!g.global.dispatchEvent(c)}}if("function"==typeof Event){var a=new Event("CustomEvent");return g.global.dispatchEvent(a),function(a,b){var c=new Event(a.toLowerCase(),{cancelable:!0
});return c.detail=b,!g.global.dispatchEvent(c)}}var a=document.createEvent("CustomEvent");return a.initCustomEvent("testingtheevent",!1,!0,{}),g.global.dispatchEvent(a),function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a.toLowerCase(),!1,!0,b),!g.global.dispatchEvent(c)}}catch(a){}return function(){return!1}}(),x=function(){return g.isNode?function(){return process.emit.apply(process,arguments)}:g.global?function(a){var b="on"+a.toLowerCase(),c=g.global[b];return!!c&&(c.apply(g.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),z={promiseCreated:y,promiseFulfilled:y,promiseRejected:y,promiseResolved:y,promiseCancelled:y,promiseChained:function(a,b,c){return{promise:b,child:c}},warning:function(a,b){return{warning:b}},unhandledRejection:function(a,b,c){return{reason:b,promise:c}},rejectionHandled:y},A=function(a){var b=!1;try{b=x.apply(null,arguments)}catch(a){e.throwLater(a),b=!0}var c=!1;try{c=w(a,z[a].apply(null,arguments))}catch(a){e.throwLater(a),c=!0}return c||b};b.config=function(a){if(a=Object(a),"longStackTraces"in a&&(a.longStackTraces?b.longStackTraces():!a.longStackTraces&&b.hasLongStackTraces()&&v()),"warnings"in a){var c=a.warnings;fa.warnings=!!c,u=fa.warnings,g.isObject(c)&&"wForgottenReturn"in c&&(u=!!c.wForgottenReturn)}if("cancellation"in a&&a.cancellation&&!fa.cancellation){if(e.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");b.prototype._clearCancellationData=G,b.prototype._propagateFrom=H,b.prototype._onCancel=E,b.prototype._setOnCancel=F,b.prototype._attachCancellationCallback=D,b.prototype._execute=C,J=H,fa.cancellation=!0}return"monitoring"in a&&(a.monitoring&&!fa.monitoring?(fa.monitoring=!0,b.prototype._fireEvent=A):!a.monitoring&&fa.monitoring&&(fa.monitoring=!1,b.prototype._fireEvent=B)),b},b.prototype._fireEvent=B,b.prototype._execute=function(a,b,c){try{a(b,c)}catch(a){return a}},b.prototype._onCancel=function(){},b.prototype._setOnCancel=function(a){},b.prototype._attachCancellationCallback=function(a){},b.prototype._captureStackTrace=function(){},b.prototype._attachExtraTrace=function(){},b.prototype._clearCancellationData=function(){},b.prototype._propagateFrom=function(a,b){};var J=I,_=function(){return!1},aa=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;g.inherits(da,Error),c.CapturedTrace=da,da.prototype.uncycle=function(){var a=this._length;if(!(a<2)){for(var b=[],c={},d=0,e=this;void 0!==e;++d)b.push(e),e=e._parent;a=this._length=d;for(var d=a-1;d>=0;--d){var f=b[d].stack;void 0===c[f]&&(c[f]=d)}for(var d=0;d<a;++d){var g=b[d].stack,h=c[g];if(void 0!==h&&h!==d){h>0&&(b[h-1]._parent=void 0,b[h-1]._length=1),b[d]._parent=void 0,b[d]._length=1;var i=d>0?b[d-1]:this;h<a-1?(i._parent=b[h+1],i._parent.uncycle(),i._length=i._parent._length+1):(i._parent=void 0,i._length=1);for(var j=i._length+1,k=d-2;k>=0;--k)b[k]._length=j,j++;return}}}},da.prototype.attachExtraTrace=function(a){if(!a.__stackCleaned__){this.uncycle();for(var b=V(a),c=b.message,d=[b.stack],e=this;void 0!==e;)d.push(T(e.stack.split("\n"))),e=e._parent;S(d),R(d),g.notEnumerableProp(a,"stack",Q(c,d)),g.notEnumerableProp(a,"__stackCleaned__",!0)}};var ea=function(){var b=/^\s*at\s*/,c=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.toString():Y(b)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,n=b,o=c;var d=Error.captureStackTrace;return _=function(a){return k.test(a)},function(a,b){Error.stackTraceLimit+=6,d(a,b),Error.stackTraceLimit-=6}}var e=new Error;if("string"==typeof e.stack&&e.stack.split("\n")[0].indexOf("stackDetection@")>=0)return n=/@/,o=c,p=!0,function(b){b.stack=(new Error).stack};var f;try{throw new Error}catch(a){f="stack"in a}return"stack"in e||!f||"number"!=typeof Error.stackTraceLimit?(o=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?Y(b):b.toString()},null):(n=b,o=c,function(b){Error.stackTraceLimit+=6;try{throw new Error}catch(a){b.stack=a.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(q=function(a){console.warn(a)},g.isNode&&process.stderr.isTTY?q=function(a,b){var c=b?"[33m":"[31m";console.warn(c+a+"[0m\n")}:g.isNode||"string"!=typeof(new Error).stack||(q=function(a,b){console.warn("%c"+a,b?"color: darkorange":"color: red")}));var fa={warnings:s,longStackTraces:!1,cancellation:!1,monitoring:!1};return t&&b.longStackTraces(),{longStackTraces:function(){return fa.longStackTraces},warnings:function(){return fa.warnings},cancellation:function(){return fa.cancellation},monitoring:function(){return fa.monitoring},propagateFromFunction:function(){return J},boundValueFunction:function(){return K},checkForgottenReturns:N,setBounds:ca,warn:P,deprecated:O,CapturedTrace:da,fireDomEvent:w,fireGlobalEvent:x}}},{"./errors":12,"./util":36}],10:[function(a,b,c){"use strict";b.exports=function(a){function b(){return this.value}function c(){throw this.reason}a.prototype.return=a.prototype.thenReturn=function(c){return c instanceof a&&c.suppressUnhandledRejections(),this._then(b,void 0,void 0,{value:c},void 0)},a.prototype.throw=a.prototype.thenThrow=function(a){return this._then(c,void 0,void 0,{reason:a},void 0)},a.prototype.catchThrow=function(a){if(arguments.length<=1)return this._then(void 0,c,void 0,{reason:a},void 0);var b=arguments[1],d=function(){throw b};return this.caught(a,d)},a.prototype.catchReturn=function(c){if(arguments.length<=1)return c instanceof a&&c.suppressUnhandledRejections(),this._then(void 0,b,void 0,{value:c},void 0);var d=arguments[1];d instanceof a&&d.suppressUnhandledRejections();var e=function(){return d};return this.caught(c,e)}}},{}],11:[function(a,b,c){"use strict";b.exports=function(a,b){function e(){return d(this)}function f(a,d){return c(a,d,b,b)}var c=a.reduce,d=a.all;a.prototype.each=function(a){return c(this,a,b,0)._then(e,void 0,void 0,this,void 0)},a.prototype.mapSeries=function(a){return c(this,a,b,b)},a.each=function(a,d){return c(a,d,b,0)._then(e,void 0,void 0,a,void 0)},a.mapSeries=f}},{}],12:[function(a,b,c){"use strict";function i(a,b){function c(d){return this instanceof c?(h(this,"message","string"==typeof d?d:b),h(this,"name",a),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new c(d)}return g(c,Error),c}function s(a){return this instanceof s?(h(this,"name","OperationalError"),h(this,"message",a),this.cause=a,this.isOperational=!0,void(a instanceof Error?(h(this,"message",a.message),h(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new s(a)}var j,k,d=a("./es5"),e=d.freeze,f=a("./util"),g=f.inherits,h=f.notEnumerableProp,l=i("Warning","warning"),m=i("CancellationError","cancellation error"),n=i("TimeoutError","timeout error"),o=i("AggregateError","aggregate error");try{j=TypeError,k=RangeError}catch(a){j=i("TypeError","type error"),k=i("RangeError","range error")}for(var p="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),q=0;q<p.length;++q)"function"==typeof Array.prototype[p[q]]&&(o.prototype[p[q]]=Array.prototype[p[q]]);d.defineProperty(o.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),o.prototype.isOperational=!0;var r=0;o.prototype.toString=function(){var a=Array(4*r+1).join(" "),b="\n"+a+"AggregateError of:\n";r++,a=Array(4*r+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return r--,b},g(s,Error);var t=Error.__BluebirdErrorTypes__;t||(t=e({CancellationError:m,TimeoutError:n,OperationalError:s,RejectionError:s,AggregateError:o}),d.defineProperty(Error,"__BluebirdErrorTypes__",{value:t,writable:!1,enumerable:!1,configurable:!1})),b.exports={Error:Error,TypeError:j,RangeError:k,CancellationError:t.CancellationError,OperationalError:t.OperationalError,TimeoutError:t.TimeoutError,AggregateError:t.AggregateError,Warning:l}},{"./es5":13,"./util":36}],13:[function(a,b,c){var d=function(){"use strict";return void 0===this}();if(d)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:d,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}};else{var e={}.hasOwnProperty,f={}.toString,g={}.constructor.prototype,h=function(a){var b=[];for(var c in a)e.call(a,c)&&b.push(c);return b},i=function(a,b){return{value:a[b]}},j=function(a,b,c){return a[b]=c.value,a},k=function(a){return a},l=function(a){try{return Object(a).constructor.prototype}catch(a){return g}},m=function(a){try{return"[object Array]"===f.call(a)}catch(a){return!1}};b.exports={isArray:m,keys:h,names:h,defineProperty:j,getDescriptor:i,freeze:k,getPrototypeOf:l,isES5:d,propertyIsWritable:function(){return!0}}}},{}],14:[function(a,b,c){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],15:[function(a,b,c){"use strict";b.exports=function(b,c){function g(a,b,c){this.promise=a,this.type=b,this.handler=c,this.called=!1,this.cancelPromise=null}function h(a){this.finallyHandler=a}function i(a,b){return null!=a.cancelPromise&&(arguments.length>1?a.cancelPromise._reject(b):a.cancelPromise._cancel(),a.cancelPromise=null,!0)}function j(){return l.call(this,this.promise._target()._settledValue())}function k(a){if(!i(this,a))return f.e=a,f}function l(a){var d=this.promise,g=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?g.call(d._boundValue()):g.call(d._boundValue(),a);if(void 0!==l){d._setReturnedNonUndefined();var m=c(l,d);if(m instanceof b){if(null!=this.cancelPromise){if(m._isCancelled()){var n=new e("late cancellation observer");return d._attachExtraTrace(n),f.e=n,f}m.isPending()&&m._attachCancellationCallback(new h(this))}return m._then(j,k,void 0,this,void 0)}}}return d.isRejected()?(i(this),f.e=a,f):(i(this),a)}var d=a("./util"),e=b.CancellationError,f=d.errorObj;return g.prototype.isFinallyHandler=function(){return 0===this.type},h.prototype._resultCancelled=function(){i(this.finallyHandler)},b.prototype._passThrough=function(a,b,c,d){return"function"!=typeof a?this.then():this._then(c,d,void 0,new g(this,b,a),void 0)},b.prototype.lastly=b.prototype.finally=function(a){return this._passThrough(a,0,l,l)},b.prototype.tap=function(a){return this._passThrough(a,1,l)},g}},{"./util":36}],16:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function n(a,c,d){for(var f=0;f<c.length;++f){d._pushContext();var g=l(c[f])(a);if(d._popContext(),g===k){d._pushContext();var h=b.reject(k.e);return d._popContext(),h}var i=e(g,d);if(i instanceof b)return i}return null}function o(a,c,e,f){if(g.cancellation()){var h=new b(d),i=this._finallyPromise=new b(d);this._promise=h.lastly(function(){return i}),h._captureStackTrace(),h._setOnCancel(this)}else{var j=this._promise=new b(d);j._captureStackTrace()}this._stack=f,this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(m):m,this._yieldedPromise=null,this._cancellationPhase=!1}var h=a("./errors"),i=h.TypeError,j=a("./util"),k=j.errorObj,l=j.tryCatch,m=[];j.inherits(o,f),o.prototype._isResolved=function(){return null===this._promise},o.prototype._cleanup=function(){this._promise=this._generator=null,g.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},o.prototype._promiseCancelled=function(){if(!this._isResolved()){var c,a="undefined"!=typeof this._generator.return;if(a)this._promise._pushContext(),c=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var d=new b.CancellationError("generator .return() sentinel");b.coroutine.returnSentinel=d,this._promise._attachExtraTrace(d),this._promise._pushContext(),c=l(this._generator.throw).call(this._generator,d),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(c)}},o.prototype._promiseFulfilled=function(a){this._yieldedPromise=null,this._promise._pushContext();var b=l(this._generator.next).call(this._generator,a);this._promise._popContext(),this._continue(b)},o.prototype._promiseRejected=function(a){this._yieldedPromise=null,this._promise._attachExtraTrace(a),this._promise._pushContext();var b=l(this._generator.throw).call(this._generator,a);this._promise._popContext(),this._continue(b)},o.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof b){var a=this._yieldedPromise;this._yieldedPromise=null,a.cancel()}},o.prototype.promise=function(){return this._promise},o.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},o.prototype._continue=function(a){var c=this._promise;if(a===k)return this._cleanup(),this._cancellationPhase?c.cancel():c._rejectCallback(a.e,!1);var d=a.value;if(a.done===!0)return this._cleanup(),this._cancellationPhase?c.cancel():c._resolveCallback(d);var f=e(d,this._promise);if(!(f instanceof b)&&(f=n(f,this._yieldHandlers,this._promise),null===f))return void this._promiseRejected(new i("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",d)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));f=f._target();var g=f._bitField;0===(50397184&g)?(this._yieldedPromise=f,f._proxy(this,null)):0!==(33554432&g)?b._async.invoke(this._promiseFulfilled,this,f._value()):0!==(16777216&g)?b._async.invoke(this._promiseRejected,this,f._reason()):this._promiseCancelled()},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var c=Object(b).yieldHandler,d=o,e=(new Error).stack;return function(){var b=a.apply(this,arguments),f=new d(void 0,void 0,c,e),g=f.promise();return f._generator=b,f._promiseFulfilled(void 0),g}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("expecting a function but got "+j.classString(a));m.push(a)},b.spawn=function(a){if(g.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof a)return c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var d=new o(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors":12,"./util":36}],17:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){var h=a("./util");h.canEvaluate,h.tryCatch,h.errorObj;b.join=function(){var f,a=arguments.length-1;if(a>0&&"function"==typeof arguments[a]){f=arguments[a];var j}var v=[].slice.call(arguments);f&&v.pop();var j=new c(v).promise();return void 0!==f?j.spread(f):j}}},{"./util":36}],18:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function m(a,b,c,d){this.constructor$(a),this._promise._captureStackTrace();var e=h();this._callback=null===e?b:i.domainBind(e,b),this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=[],l.invoke(this._asyncInit,this,void 0)}function n(a,c,e,f){if("function"!=typeof c)return d("expecting a function but got "+i.classString(c));var g=0;if(void 0!==e){if("object"!=typeof e||null===e)return b.reject(new TypeError("options argument must be an object but it is "+i.classString(e)));if("number"!=typeof e.concurrency)return b.reject(new TypeError("'concurrency' must be a number but it is "+i.classString(e.concurrency)));g=e.concurrency}return g="number"==typeof g&&isFinite(g)&&g>=1?g:0,new m(a,c,g,f).promise()}var h=b._getDomain,i=a("./util"),j=i.tryCatch,k=i.errorObj,l=b._async;i.inherits(m,c),m.prototype._asyncInit=function(){this._init$(void 0,-2)},m.prototype._init=function(){},m.prototype._promiseFulfilled=function(a,c){var d=this._values,f=this.length(),h=this._preservedValues,i=this._limit;if(c<0){if(c=c*-1-1,d[c]=a,i>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(i>=1&&this._inFlight>=i)return d[c]=a,this._queue.push(c),!1;null!==h&&(h[c]=a);var l=this._promise,m=this._callback,n=l._boundValue();l._pushContext();var o=j(m).call(n,a,c,f),p=l._popContext();if(g.checkForgottenReturns(o,p,null!==h?"Promise.filter":"Promise.map",l),o===k)return this._reject(o.e),!0;var q=e(o,this._promise);if(q instanceof b){q=q._target();var r=q._bitField;if(0===(50397184&r))return i>=1&&this._inFlight++,d[c]=q,q._proxy(this,(c+1)*-1),!1;if(0===(33554432&r))return 0!==(16777216&r)?(this._reject(q._reason()),!0):(this._cancel(),!0);o=q._value()}d[c]=o}var s=++this._totalResolved;return s>=f&&(null!==h?this._filter(d,h):this._resolve(d),!0)},m.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){if(this._isResolved())return;var d=a.pop();this._promiseFulfilled(c[d],d)}},m.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;f<c;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},m.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return n(this,a,b,null)},b.map=function(a,b,c,d){return n(a,b,c,d)}}},{"./util":36}],19:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){var g=a("./util"),h=g.tryCatch;b.method=function(a){if("function"!=typeof a)throw new b.TypeError("expecting a function but got "+g.classString(a));return function(){var d=new b(c);d._captureStackTrace(),d._pushContext();var e=h(a).apply(this,arguments),g=d._popContext();return f.checkForgottenReturns(e,g,"Promise.method",d),d._resolveFromSyncValue(e),d}},b.attempt=b.try=function(a){if("function"!=typeof a)return e("expecting a function but got "+g.classString(a));var d=new b(c);d._captureStackTrace(),d._pushContext();var i;if(arguments.length>1){f.deprecated("calling Promise.try with more than 1 argument");var j=arguments[1],k=arguments[2];i=g.isArray(j)?h(a).apply(k,j):h(a).call(k,j)}else i=h(a)();var l=d._popContext();return f.checkForgottenReturns(i,l,"Promise.try",d),d._resolveFromSyncValue(i),d},b.prototype._resolveFromSyncValue=function(a){a===g.errorObj?this._rejectCallback(a.e,!1):this._resolveCallback(a,!0)}}},{"./util":36}],20:[function(a,b,c){"use strict";function i(a){return a instanceof Error&&h.getPrototypeOf(a)===Error.prototype}function k(a){var b;if(i(a)){b=new g(a),b.name=a.name,b.message=a.message,b.stack=a.stack;for(var c=h.keys(a),e=0;e<c.length;++e){var f=c[e];j.test(f)||(b[f]=a[f])}return b}return d.markAsOriginatingFromRejection(a),a}function l(a,b){return function(c,d){if(null!==a){if(c){var f=k(e(c));a._attachExtraTrace(f),a._reject(f)}else if(b){var g=[].slice.call(arguments,1);a._fulfill(g)}else a._fulfill(d);a=null}}}var d=a("./util"),e=d.maybeWrapAsError,f=a("./errors"),g=f.OperationalError,h=a("./es5"),j=/^(?:name|message|stack|cause)$/;b.exports=l},{"./errors":12,"./es5":13,"./util":36}],21:[function(a,b,c){"use strict";b.exports=function(b){function g(a,b){var g=this;if(!c.isArray(a))return h.call(g,a,b);var i=e(b).apply(g._boundValue(),[null].concat(a));i===f&&d.throwLater(i.e)}function h(a,b){var c=this,g=c._boundValue(),h=void 0===a?e(b).call(g,null):e(b).call(g,null,a);h===f&&d.throwLater(h.e)}function i(a,b){var c=this;if(!a){var g=new Error(a+"");g.cause=a,a=g}var h=e(b).call(c._boundValue(),a);h===f&&d.throwLater(h.e)}var c=a("./util"),d=b._async,e=c.tryCatch,f=c.errorObj;b.prototype.asCallback=b.prototype.nodeify=function(a,b){if("function"==typeof a){var c=h;void 0!==b&&Object(b).spread&&(c=g),this._then(c,i,void 0,this,a)}return this}}},{"./util":36}],22:[function(a,b,c){"use strict";b.exports=function(){function f(){}function D(a,b){if("function"!=typeof b)throw new n("expecting a function but got "+h.classString(b));if(a.constructor!==E)throw new n("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function E(a){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,a!==p&&(D(this,a),this._resolveFromExecutor(a)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function F(a){this.promise._resolveCallback(a)}function G(a){this.promise._rejectCallback(a,!1)}function H(a){var b=new E(p);b._fulfillmentHandler0=a,b._rejectionHandler0=a,b._promise0=a,b._receiver0=a}var i,c=function(){return new n("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},d=function(){return new E.PromiseInspection(this._target())},e=function(a){return E.reject(new n(a))},g={},h=a("./util");i=h.isNode?function(){var a=process.domain;return void 0===a&&(a=null),a}:function(){return null},h.notEnumerableProp(E,"_getDomain",i);var j=a("./es5"),k=a("./async"),l=new k;j.defineProperty(E,"_async",{value:l});var m=a("./errors"),n=E.TypeError=m.TypeError;E.RangeError=m.RangeError;var o=E.CancellationError=m.CancellationError;E.TimeoutError=m.TimeoutError,E.OperationalError=m.OperationalError,E.RejectionError=m.OperationalError,E.AggregateError=m.AggregateError;var p=function(){},q={},r={},s=a("./thenables")(E,p),t=a("./promise_array")(E,p,s,e,f),u=a("./context")(E),v=u.create,w=a("./debuggability")(E,u),y=(w.CapturedTrace,a("./finally")(E,s)),z=a("./catch_filter")(r),A=a("./nodeback"),B=h.errorObj,C=h.tryCatch;return E.prototype.toString=function(){return"[object Promise]"},E.prototype.caught=E.prototype.catch=function(a){var b=arguments.length;if(b>1){var f,c=new Array(b-1),d=0;for(f=0;f<b-1;++f){var g=arguments[f];if(!h.isObject(g))return e("expecting an object but got A catch statement predicate "+h.classString(g));c[d++]=g}return c.length=d,a=arguments[f],this.then(void 0,z(c,a,this))}return this.then(void 0,a)},E.prototype.reflect=function(){return this._then(d,d,void 0,this,void 0)},E.prototype.then=function(a,b){if(w.warnings()&&arguments.length>0&&"function"!=typeof a&&"function"!=typeof b){var c=".then() only accepts functions but was passed: "+h.classString(a);arguments.length>1&&(c+=", "+h.classString(b)),this._warn(c)}return this._then(a,b,void 0,void 0,void 0)},E.prototype.done=function(a,b){var c=this._then(a,b,void 0,void 0,void 0);c._setIsFinal()},E.prototype.spread=function(a){return"function"!=typeof a?e("expecting a function but got "+h.classString(a)):this.all()._then(a,void 0,void 0,q,void 0)},E.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},E.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new t(this).promise()},E.prototype.error=function(a){return this.caught(h.originatesFromRejection,a)},E.getNewLibraryCopy=b.exports,E.is=function(a){return a instanceof E},E.fromNode=E.fromCallback=function(a){var b=new E(p);b._captureStackTrace();var c=arguments.length>1&&!!Object(arguments[1]).multiArgs,d=C(a)(A(b,c));return d===B&&b._rejectCallback(d.e,!0),b._isFateSealed()||b._setAsyncGuaranteed(),b},E.all=function(a){return new t(a).promise()},E.cast=function(a){var b=s(a);return b instanceof E||(b=new E(p),b._captureStackTrace(),b._setFulfilled(),b._rejectionHandler0=a),b},E.resolve=E.fulfilled=E.cast,E.reject=E.rejected=function(a){var b=new E(p);return b._captureStackTrace(),b._rejectCallback(a,!0),b},E.setScheduler=function(a){if("function"!=typeof a)throw new n("expecting a function but got "+h.classString(a));return l.setScheduler(a)},E.prototype._then=function(a,b,c,d,e){var f=void 0!==e,g=f?e:new E(p),j=this._target(),k=j._bitField;f||(g._propagateFrom(this,3),g._captureStackTrace(),void 0===d&&0!==(2097152&this._bitField)&&(d=0!==(50397184&k)?this._boundValue():j===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,g));var m=i();if(0!==(50397184&k)){var n,q,r=j._settlePromiseCtx;0!==(33554432&k)?(q=j._rejectionHandler0,n=a):0!==(16777216&k)?(q=j._fulfillmentHandler0,n=b,j._unsetRejectionIsUnhandled()):(r=j._settlePromiseLateCancellationObserver,q=new o("late cancellation observer"),j._attachExtraTrace(q),n=b),l.invoke(r,j,{handler:null===m?n:"function"==typeof n&&h.domainBind(m,n),promise:g,receiver:d,value:q})}else j._addCallbacks(a,b,g,d,m);return g},E.prototype._length=function(){return 65535&this._bitField},E.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},E.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},E.prototype._setLength=function(a){this._bitField=this._bitField&-65536|65535&a},E.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},E.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},E.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},E.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},E.prototype._isFinal=function(){return(4194304&this._bitField)>0},E.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},E.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},E.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},E.prototype._setAsyncGuaranteed=function(){l.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},E.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[4*a-4+3];if(b!==g)return void 0===b&&this._isBound()?this._boundValue():b},E.prototype._promiseAt=function(a){return this[4*a-4+2]},E.prototype._fulfillmentHandlerAt=function(a){return this[4*a-4+0]},E.prototype._rejectionHandlerAt=function(a){return this[4*a-4+1]},E.prototype._boundValue=function(){},E.prototype._migrateCallback0=function(a){var c=(a._bitField,a._fulfillmentHandler0),d=a._rejectionHandler0,e=a._promise0,f=a._receiverAt(0);void 0===f&&(f=g),this._addCallbacks(c,d,e,f,null)},E.prototype._migrateCallbackAt=function(a,b){var c=a._fulfillmentHandlerAt(b),d=a._rejectionHandlerAt(b),e=a._promiseAt(b),f=a._receiverAt(b);void 0===f&&(f=g),this._addCallbacks(c,d,e,f,null)},E.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=65531&&(f=0,this._setLength(0)),0===f)this._promise0=c,this._receiver0=d,"function"==typeof a&&(this._fulfillmentHandler0=null===e?a:h.domainBind(e,a)),"function"==typeof b&&(this._rejectionHandler0=null===e?b:h.domainBind(e,b));else{var g=4*f-4;this[g+2]=c,this[g+3]=d,"function"==typeof a&&(this[g+0]=null===e?a:h.domainBind(e,a)),"function"==typeof b&&(this[g+1]=null===e?b:h.domainBind(e,b))}return this._setLength(f+1),f},E.prototype._proxy=function(a,b){this._addCallbacks(void 0,void 0,b,a,null)},E.prototype._resolveCallback=function(a,b){if(0===(117506048&this._bitField)){if(a===this)return this._rejectCallback(c(),!1);var d=s(a,this);if(!(d instanceof E))return this._fulfill(a);b&&this._propagateFrom(d,2);var e=d._target();if(e===this)return void this._reject(c());var f=e._bitField;if(0===(50397184&f)){var g=this._length();g>0&&e._migrateCallback0(this);for(var h=1;h<g;++h)e._migrateCallbackAt(this,h);this._setFollowing(),this._setLength(0),this._setFollowee(e)}else if(0!==(33554432&f))this._fulfill(e._value());else if(0!==(16777216&f))this._reject(e._reason());else{var i=new o("late cancellation observer");e._attachExtraTrace(i),this._reject(i)}}},E.prototype._rejectCallback=function(a,b,c){var d=h.ensureErrorObject(a),e=d===a;if(!e&&!c&&w.warnings()){var f="a promise was rejected with a non-error: "+h.classString(a);this._warn(f,!0)}this._attachExtraTrace(d,!!b&&e),this._reject(a)},E.prototype._resolveFromExecutor=function(a){var b=this;this._captureStackTrace(),this._pushContext();var c=!0,d=this._execute(a,function(a){b._resolveCallback(a)},function(a){b._rejectCallback(a,c)});c=!1,this._popContext(),void 0!==d&&b._rejectCallback(d,!0)},E.prototype._settlePromiseFromHandler=function(a,b,c,d){var e=d._bitField;if(0===(65536&e)){d._pushContext();var f;b===q?c&&"number"==typeof c.length?f=C(a).apply(this._boundValue(),c):(f=B,f.e=new n("cannot .spread() a non-array: "+h.classString(c))):f=C(a).call(b,c);var g=d._popContext();e=d._bitField,0===(65536&e)&&(f===r?d._reject(c):f===B?d._rejectCallback(f.e,!1):(w.checkForgottenReturns(f,g,"",d,this),d._resolveCallback(f)))}},E.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},E.prototype._followee=function(){return this._rejectionHandler0},E.prototype._setFollowee=function(a){this._rejectionHandler0=a},E.prototype._settlePromise=function(a,b,c,e){var g=a instanceof E,h=this._bitField,i=0!==(134217728&h);0!==(65536&h)?(g&&a._invokeInternalOnCancel(),c instanceof y&&c.isFinallyHandler()?(c.cancelPromise=a,C(b).call(c,e)===B&&a._reject(B.e)):b===d?a._fulfill(d.call(c)):c instanceof f?c._promiseCancelled(a):g||a instanceof t?a._cancel():c.cancel()):"function"==typeof b?g?(i&&a._setAsyncGuaranteed(),this._settlePromiseFromHandler(b,c,e,a)):b.call(c,e,a):c instanceof f?c._isResolved()||(0!==(33554432&h)?c._promiseFulfilled(e,a):c._promiseRejected(e,a)):g&&(i&&a._setAsyncGuaranteed(),0!==(33554432&h)?a._fulfill(e):a._reject(e))},E.prototype._settlePromiseLateCancellationObserver=function(a){var b=a.handler,c=a.promise,d=a.receiver,e=a.value;"function"==typeof b?c instanceof E?this._settlePromiseFromHandler(b,d,e,c):b.call(d,e,c):c instanceof E&&c._reject(e)},E.prototype._settlePromiseCtx=function(a){this._settlePromise(a.promise,a.handler,a.receiver,a.value)},E.prototype._settlePromise0=function(a,b,c){var d=this._promise0,e=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(d,a,e,b)},E.prototype._clearCallbackDataAtIndex=function(a){var b=4*a-4;this[b+2]=this[b+3]=this[b+0]=this[b+1]=void 0},E.prototype._fulfill=function(a){var b=this._bitField;if(!((117506048&b)>>>16)){if(a===this){var d=c();return this._attachExtraTrace(d),this._reject(d)}this._setFulfilled(),this._rejectionHandler0=a,(65535&b)>0&&(0!==(134217728&b)?this._settlePromises():l.settlePromises(this))}},E.prototype._reject=function(a){var b=this._bitField;if(!((117506048&b)>>>16))return this._setRejected(),this._fulfillmentHandler0=a,this._isFinal()?l.fatalError(a,h.isNode):void((65535&b)>0?l.settlePromises(this):this._ensurePossibleRejectionHandled())},E.prototype._fulfillPromises=function(a,b){for(var c=1;c<a;c++){var d=this._fulfillmentHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c);this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)}},E.prototype._rejectPromises=function(a,b){for(var c=1;c<a;c++){var d=this._rejectionHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c);this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)}},E.prototype._settlePromises=function(){var a=this._bitField,b=65535&a;if(b>0){if(0!==(16842752&a)){var c=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,c,a),this._rejectPromises(b,c)}else{var d=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,d,a),this._fulfillPromises(b,d)}this._setLength(0)}this._clearCancellationData()},E.prototype._settledValue=function(){var a=this._bitField;return 0!==(33554432&a)?this._rejectionHandler0:0!==(16777216&a)?this._fulfillmentHandler0:void 0},E.defer=E.pending=function(){w.deprecated("Promise.defer","new Promise");var a=new E(p);return{promise:a,resolve:F,reject:G}},h.notEnumerableProp(E,"_makeSelfResolutionError",c),a("./method")(E,p,s,e,w),a("./bind")(E,p,s,w),a("./cancel")(E,t,e,w),a("./direct_resolve")(E),a("./synchronous_inspection")(E),a("./join")(E,t,s,p,l,i),E.Promise=E,E.version="3.4.7",
a("./map.js")(E,t,e,s,p,w),a("./call_get.js")(E),a("./using.js")(E,e,s,v,p,w),a("./timers.js")(E,p,w),a("./generators.js")(E,e,p,s,f,w),a("./nodeify.js")(E),a("./promisify.js")(E,p),a("./props.js")(E,t,s,e),a("./race.js")(E,p,s,e),a("./reduce.js")(E,t,e,s,p,w),a("./settle.js")(E,t,w),a("./some.js")(E,t,e),a("./filter.js")(E,p),a("./each.js")(E,p),a("./any.js")(E),h.toFastProperties(E),h.toFastProperties(E.prototype),H({a:1}),H({b:2}),H({c:3}),H(1),H(function(){}),H(void 0),H(!1),H(new E(p)),w.setBounds(k.firstLineError,h.lastLineError),E}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){function i(a){switch(a){case-2:return[];case-3:return{}}}function j(a){var d=this._promise=new b(c);a instanceof b&&d._propagateFrom(a,3),d._setOnCancel(this),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var g=a("./util");g.isArray;return g.inherits(j,f),j.prototype.length=function(){return this._length},j.prototype.promise=function(){return this._promise},j.prototype._init=function a(c,f){var h=d(this._values,this._promise);if(h instanceof b){h=h._target();var j=h._bitField;if(this._values=h,0===(50397184&j))return this._promise._setAsyncGuaranteed(),h._then(a,this._reject,void 0,this,f);if(0===(33554432&j))return 0!==(16777216&j)?this._reject(h._reason()):this._cancel();h=h._value()}if(h=g.asArray(h),null===h){var k=e("expecting an array or an iterable object but got "+g.classString(h)).reason();return void this._promise._rejectCallback(k,!1)}return 0===h.length?void(f===-5?this._resolveEmptyArray():this._resolve(i(f))):void this._iterate(h)},j.prototype._iterate=function(a){var c=this.getActualLength(a.length);this._length=c,this._values=this.shouldCopyValues()?new Array(c):this._values;for(var e=this._promise,f=!1,g=null,h=0;h<c;++h){var i=d(a[h],e);i instanceof b?(i=i._target(),g=i._bitField):g=null,f?null!==g&&i.suppressUnhandledRejections():null!==g?0===(50397184&g)?(i._proxy(this,h),this._values[h]=i):f=0!==(33554432&g)?this._promiseFulfilled(i._value(),h):0!==(16777216&g)?this._promiseRejected(i._reason(),h):this._promiseCancelled(h):f=this._promiseFulfilled(i,h)}f||e._setAsyncGuaranteed()},j.prototype._isResolved=function(){return null===this._values},j.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},j.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},j.prototype._reject=function(a){this._values=null,this._promise._rejectCallback(a,!1)},j.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;return c>=this._length&&(this._resolve(this._values),!0)},j.prototype._promiseCancelled=function(){return this._cancel(),!0},j.prototype._promiseRejected=function(a){return this._totalResolved++,this._reject(a),!0},j.prototype._resultCancelled=function(){if(!this._isResolved()){var a=this._values;if(this._cancel(),a instanceof b)a.cancel();else for(var c=0;c<a.length;++c)a[c]instanceof b&&a[c].cancel()}},j.prototype.shouldCopyValues=function(){return!0},j.prototype.getActualLength=function(a){return a},j}},{"./util":36}],24:[function(a,b,c){"use strict";b.exports=function(b,c){function p(a){return!n.test(a)}function q(a){try{return a.__isPromisified__===!0}catch(a){return!1}}function r(a,b,c){var d=e.getDataPropertyOrDefault(a,b+c,l);return!!d&&q(d)}function s(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new j("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",b))}}function t(a,b,c,d){for(var f=e.inheritedDataKeys(a),g=[],h=0;h<f.length;++h){var i=f[h],j=a[i],k=d===o||o(i,j,a);"function"!=typeof j||q(j)||r(a,i,b)||!d(i,j,a,k)||g.push(i,j)}return s(g,b,c),g}function A(a,i,j,k,l,m){function p(){var e=i;i===d&&(e=this);var j=new b(c);j._captureStackTrace();var k="string"==typeof o&&this!==n?this[o]:a,l=f(j,m);try{k.apply(e,g(arguments,l))}catch(a){j._rejectCallback(h(a),!0,!0)}return j._isFateSealed()||j._setAsyncGuaranteed(),j}var n=function(){return this}(),o=a;return"string"==typeof o&&(a=k),e.notEnumerableProp(p,"__isPromisified__",!0),p}function C(a,b,c,f,g){for(var h=new RegExp(u(b)+"$"),i=t(a,b,h,c),j=0,k=i.length;j<k;j+=2){var l=i[j],m=i[j+1],n=l+b;if(f===B)a[n]=B(l,d,l,m,b,g);else{var o=f(m,function(){return B(l,d,l,m,b,g)});e.notEnumerableProp(o,"__isPromisified__",!0),a[n]=o}}return e.toFastProperties(a),a}function D(a,b,c){return B(a,b,void 0,a,null,c)}var v,d={},e=a("./util"),f=a("./nodeback"),g=e.withAppended,h=e.maybeWrapAsError,i=e.canEvaluate,j=a("./errors").TypeError,k="Async",l={__isPromisified__:!0},m=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],n=new RegExp("^(?:"+m.join("|")+")$"),o=function(a){return e.isIdentifier(a)&&"_"!==a.charAt(0)&&"constructor"!==a},u=function(a){return a.replace(/([$])/,"\\$")},B=i?v:A;b.promisify=function(a,b){if("function"!=typeof a)throw new j("expecting a function but got "+e.classString(a));if(q(a))return a;b=Object(b);var c=void 0===b.context?d:b.context,f=!!b.multiArgs,g=D(a,c,f);return e.copyDescriptors(a,g,p),g},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new j("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");b=Object(b);var c=!!b.multiArgs,d=b.suffix;"string"!=typeof d&&(d=k);var f=b.filter;"function"!=typeof f&&(f=o);var g=b.promisifier;if("function"!=typeof g&&(g=B),!e.isIdentifier(d))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var h=e.inheritedDataKeys(a),i=0;i<h.length;++i){var l=a[h[i]];"constructor"!==h[i]&&e.isClass(l)&&(C(l.prototype,d,f,g,c),C(l,d,f,g,c))}return C(a,d,f,g,c)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function l(a){var c,b=!1;if(void 0!==i&&a instanceof i)c=j(a),b=!0;else{var d=h.keys(a),e=d.length;c=new Array(2*e);for(var f=0;f<e;++f){var g=d[f];c[f]=a[g],c[f+e]=g}}this.constructor$(c),this._isMap=b,this._init$(void 0,-3)}function m(a){var c,f=d(a);return g(f)?(c=f instanceof b?f._then(b.props,void 0,void 0,void 0,void 0):new l(f).promise(),f instanceof b&&c._propagateFrom(f,2),c):e("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var i,f=a("./util"),g=f.isObject,h=a("./es5");"function"==typeof Map&&(i=Map);var j=function(){function c(c,d){this[a]=c,this[a+b]=d,a++}var a=0,b=0;return function(e){b=e.size,a=0;var f=new Array(2*e.size);return e.forEach(c,f),f}}(),k=function(a){for(var b=new i,c=a.length/2|0,d=0;d<c;++d){var e=a[c+d],f=a[d];b.set(e,f)}return b};f.inherits(l,c),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){var d;if(this._isMap)d=k(this._values);else{d={};for(var e=this.length(),f=0,g=this.length();f<g;++f)d[this._values[f+e]]=this._values[f]}return this._resolve(d),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return m(this)},b.props=function(a){return m(a)}}},{"./es5":13,"./util":36}],26:[function(a,b,c){"use strict";function d(a,b,c,d,e){for(var f=0;f<e;++f)c[f+d]=a[f+b],a[f+b]=void 0}function e(a){this._capacity=a,this._length=0,this._front=0}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},e.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<1)},e.prototype._resizeTo=function(a){var b=this._capacity;this._capacity=a;var c=this._front,e=this._length,f=c+e&b-1;d(this,0,this,b,f)},b.exports=e},{}],27:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function h(a,h){var i=d(a);if(i instanceof b)return g(i);if(a=f.asArray(a),null===a)return e("expecting an array or an iterable object but got "+f.classString(a));var j=new b(c);void 0!==h&&j._propagateFrom(h,3);for(var k=j._fulfill,l=j._reject,m=0,n=a.length;m<n;++m){var o=a[m];(void 0!==o||m in a)&&b.cast(o)._then(k,l,void 0,j,null)}return j}var f=a("./util"),g=function(a){return a.then(function(b){return h(b,a)})};b.race=function(a){return h(a,void 0)},b.prototype.race=function(){return h(this,void 0)}}},{"./util":36}],28:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function k(a,c,d,e){this.constructor$(a);var g=h();this._fn=null===g?c:i.domainBind(g,c),void 0!==d&&(d=b.resolve(d),d._attachCancellationCallback(this)),this._initialValue=d,this._currentCancellable=null,e===f?this._eachValues=Array(this._length):0===e?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(a,b){this.isFulfilled()?b._resolve(a):b._reject(a)}function m(a,b,c,e){if("function"!=typeof b)return d("expecting a function but got "+i.classString(b));var f=new k(a,b,c,e);return f.promise()}function n(a){this.accum=a,this.array._gotAccum(a);var c=e(this.value,this.array._promise);return c instanceof b?(this.array._currentCancellable=c,c._then(o,void 0,void 0,this,void 0)):o.call(this,c)}function o(a){var c=this.array,d=c._promise,e=j(c._fn);d._pushContext();var f;f=void 0!==c._eachValues?e.call(d._boundValue(),a,this.index,this.length):e.call(d._boundValue(),this.accum,a,this.index,this.length),f instanceof b&&(c._currentCancellable=f);var h=d._popContext();return g.checkForgottenReturns(f,h,void 0!==c._eachValues?"Promise.each":"Promise.reduce",d),f}var h=b._getDomain,i=a("./util"),j=i.tryCatch;i.inherits(k,c),k.prototype._gotAccum=function(a){void 0!==this._eachValues&&null!==this._eachValues&&a!==f&&this._eachValues.push(a)},k.prototype._eachComplete=function(a){return null!==this._eachValues&&this._eachValues.push(a),this._eachValues},k.prototype._init=function(){},k.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},k.prototype.shouldCopyValues=function(){return!1},k.prototype._resolve=function(a){this._promise._resolveCallback(a),this._values=null},k.prototype._resultCancelled=function(a){return a===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof b&&this._currentCancellable.cancel(),this._initialValue instanceof b&&this._initialValue.cancel()))},k.prototype._iterate=function(a){this._values=a;var c,d,e=a.length;if(void 0!==this._initialValue?(c=this._initialValue,d=0):(c=b.resolve(a[0]),d=1),this._currentCancellable=c,!c.isRejected())for(;d<e;++d){var f={accum:null,value:a[d],index:d,length:e,array:this};c=c._then(n,void 0,void 0,f,void 0)}void 0!==this._eachValues&&(c=c._then(this._eachComplete,void 0,void 0,this,void 0)),c._then(l,l,void 0,c,this)},b.prototype.reduce=function(a,b){return m(this,a,b,null)},b.reduce=function(a,b,c,d){return m(a,b,c,d)}}},{"./util":36}],29:[function(a,b,c){"use strict";var e,d=a("./util"),f=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},g=d.getNativePromise();if(d.isNode&&"undefined"==typeof MutationObserver){var h=global.setImmediate,i=process.nextTick;e=d.isRecentNode?function(a){h.call(global,a)}:function(a){i.call(process,a)}}else if("function"==typeof g&&"function"==typeof g.resolve){var j=g.resolve();e=function(a){j.then(a)}}else e="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:f:function(){var a=document.createElement("div"),b={attributes:!0},c=!1,d=document.createElement("div"),e=new MutationObserver(function(){a.classList.toggle("foo"),c=!1});e.observe(d,b);var f=function(){c||(c=!0,d.classList.toggle("foo"))};return function(d){var e=new MutationObserver(function(){e.disconnect(),d()});e.observe(a,b),f()}}();b.exports=e},{"./util":36}],30:[function(a,b,c){"use strict";b.exports=function(b,c,d){function g(a){this.constructor$(a)}var e=b.PromiseInspection,f=a("./util");f.inherits(g,c),g.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;return c>=this._length&&(this._resolve(this._values),!0)},g.prototype._promiseFulfilled=function(a,b){var c=new e;return c._bitField=33554432,c._settledValueField=a,this._promiseResolved(b,c)},g.prototype._promiseRejected=function(a,b){var c=new e;return c._bitField=16777216,c._settledValueField=a,this._promiseResolved(b,c)},b.settle=function(a){return d.deprecated(".settle()",".reflect()"),new g(a).promise()},b.prototype.settle=function(){return b.settle(this)}}},{"./util":36}],31:[function(a,b,c){"use strict";b.exports=function(b,c,d){function j(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function k(a,b){if((0|b)!==b||b<0)return d("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var c=new j(a),e=c.promise();return c.setHowMany(b),c.init(),e}var e=a("./util"),f=a("./errors").RangeError,g=a("./errors").AggregateError,h=e.isArray,i={};e.inherits(j,c),j.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=h(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},j.prototype.init=function(){this._initialized=!0,this._init()},j.prototype.setUnwrap=function(){this._unwrap=!0},j.prototype.howMany=function(){return this._howMany},j.prototype.setHowMany=function(a){this._howMany=a},j.prototype._promiseFulfilled=function(a){return this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},j.prototype._promiseRejected=function(a){return this._addRejected(a),this._checkOutcome()},j.prototype._promiseCancelled=function(){return this._values instanceof b||null==this._values?this._cancel():(this._addRejected(i),this._checkOutcome())},j.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var a=new g,b=this.length();b<this._values.length;++b)this._values[b]!==i&&a.push(this._values[b]);return a.length>0?this._reject(a):this._cancel(),!0}return!1},j.prototype._fulfilled=function(){return this._totalResolved},j.prototype._rejected=function(){return this._values.length-this.length()},j.prototype._addRejected=function(a){this._values.push(a)},j.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},j.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},j.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new f(b)},j.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return k(a,b)},b.prototype.some=function(a){return k(this,a)},b._SomePromiseArray=j}},{"./errors":12,"./util":36}],32:[function(a,b,c){"use strict";b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValueField=a._isFateSealed()?a._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}b.prototype._settledValue=function(){return this._settledValueField};var c=b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},d=b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},e=b.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},f=b.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},g=b.prototype.isPending=function(){return 0===(50397184&this._bitField)},h=b.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};b.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},a.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},a.prototype._isCancelled=function(){return this._target().__isCancelled()},a.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},a.prototype.isPending=function(){return g.call(this._target())},a.prototype.isRejected=function(){return f.call(this._target())},a.prototype.isFulfilled=function(){return e.call(this._target())},a.prototype.isResolved=function(){return h.call(this._target())},a.prototype.value=function(){return c.call(this._target())},a.prototype.reason=function(){var a=this._target();return a._unsetRejectionIsUnhandled(),d.call(a)},a.prototype._value=function(){return this._settledValue()},a.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},a.PromiseInspection=b}},{}],33:[function(a,b,c){"use strict";b.exports=function(b,c){function g(a,d){if(f(a)){if(a instanceof b)return a;var g=i(a);if(g===e){d&&d._pushContext();var h=b.reject(g.e);return d&&d._popContext(),h}if("function"==typeof g){if(k(a)){var h=new b(c);return a._then(h._fulfill,h._reject,void 0,h,null),h}return l(a,g,d)}}return a}function h(a){return a.then}function i(a){try{return h(a)}catch(a){return e.e=a,e}}function k(a){try{return j.call(a,"_promise0")}catch(a){return!1}}function l(a,f,g){function l(a){h&&(h._resolveCallback(a),h=null)}function m(a){h&&(h._rejectCallback(a,j,!0),h=null)}var h=new b(c),i=h;g&&g._pushContext(),h._captureStackTrace(),g&&g._popContext();var j=!0,k=d.tryCatch(f).call(a,l,m);return j=!1,h&&k===e&&(h._rejectCallback(k.e,!0,!0),h=null),i}var d=a("./util"),e=d.errorObj,f=d.isObject,j={}.hasOwnProperty;return g}},{"./util":36}],34:[function(a,b,c){"use strict";b.exports=function(b,c,d){function g(a){this.handle=a}function k(a){return clearTimeout(this.handle),a}function l(a){throw clearTimeout(this.handle),a}var e=a("./util"),f=b.TimeoutError;g.prototype._resultCancelled=function(){clearTimeout(this.handle)};var h=function(a){return i(+this).thenReturn(a)},i=b.delay=function(a,e){var f,i;return void 0!==e?(f=b.resolve(e)._then(h,null,null,a,void 0),d.cancellation()&&e instanceof b&&f._setOnCancel(e)):(f=new b(c),i=setTimeout(function(){f._fulfill()},+a),d.cancellation()&&f._setOnCancel(new g(i)),f._captureStackTrace()),f._setAsyncGuaranteed(),f};b.prototype.delay=function(a){return i(a,this)};var j=function(a,b,c){var d;d="string"!=typeof b?b instanceof Error?b:new f("operation timed out"):new f(b),e.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._reject(d),null!=c&&c.cancel()};b.prototype.timeout=function(a,b){a=+a;var c,e,f=new g(setTimeout(function(){c.isPending()&&j(c,b,e)},a));return d.cancellation()?(e=this.then(),c=e._then(k,l,void 0,f,void 0),c._setOnCancel(f)):c=this._then(k,l,void 0,f,void 0),c}}},{"./util":36}],35:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function n(a){setTimeout(function(){throw a},0)}function o(a){var b=d(a);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function p(a,c){function i(){if(e>=g)return h._fulfill();var f=o(a[e++]);if(f instanceof b&&f._isDisposable()){try{f=d(f._getDisposer().tryDispose(c),a.promise)}catch(a){return n(a)}if(f instanceof b)return f._then(i,n,null,null,null)}i()}var e=0,g=a.length,h=new b(f);return i(),h}function q(a,b,c){this._data=a,this._promise=b,this._context=c}function r(a,b,c){this.constructor$(a,b,c)}function s(a){return q.isDisposer(a)?(this.resources[this.index]._setDisposable(a),a.promise()):a}function t(a){this.length=a,this.promise=null,this[a-1]=null}var h=a("./util"),i=a("./errors").TypeError,j=a("./util").inherits,k=h.errorObj,l=h.tryCatch,m={};q.prototype.data=function(){return this._data},q.prototype.promise=function(){return this._promise},q.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():m},q.prototype.tryDispose=function(a){var b=this.resource(),c=this._context;void 0!==c&&c._pushContext();var d=b!==m?this.doDispose(b,a):null;return void 0!==c&&c._popContext(),this._promise._unsetDisposable(),this._data=null,d},q.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},j(r,q),r.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},t.prototype._resultCancelled=function(){for(var a=this.length,c=0;c<a;++c){var d=this[c];d instanceof b&&d.cancel()}},b.using=function(){var a=arguments.length;if(a<2)return c("you must pass at least 2 arguments to Promise.using");var e=arguments[a-1];if("function"!=typeof e)return c("expecting a function but got "+h.classString(e));var f,i=!0;2===a&&Array.isArray(arguments[0])?(f=arguments[0],a=f.length,i=!1):(f=arguments,a--);for(var j=new t(a),m=0;m<a;++m){var n=f[m];if(q.isDisposer(n)){var o=n;n=n.promise(),n._setDisposable(o)}else{var r=d(n);r instanceof b&&(n=r._then(s,null,null,{resources:j,index:m},void 0))}j[m]=n}for(var u=new Array(j.length),m=0;m<u.length;++m)u[m]=b.resolve(j[m]).reflect();var v=b.all(u).then(function(a){for(var b=0;b<a.length;++b){var c=a[b];if(c.isRejected())return k.e=c.error(),k;if(!c.isFulfilled())return void v.cancel();a[b]=c.value()}w._pushContext(),e=l(e);var d=i?e.apply(void 0,a):e(a),f=w._popContext();return g.checkForgottenReturns(d,f,"Promise.using",w),d}),w=v.lastly(function(){var a=new b.PromiseInspection(v);return p(j,a)});return j.promise=w,w._setOnCancel(j),w},b.prototype._setDisposable=function(a){this._bitField=131072|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(131072&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new r(a,this,e());throw new i}}},{"./errors":12,"./util":36}],36:[function(_dereq_,module,exports){"use strict";function tryCatcher(){try{var a=tryCatchTarget;return tryCatchTarget=null,a.apply(this,arguments)}catch(a){return errorObj.e=a,errorObj}}function tryCatch(a){return tryCatchTarget=a,tryCatcher}function isPrimitive(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function isObject(a){return"function"==typeof a||"object"==typeof a&&null!==a}function maybeWrapAsError(a){return isPrimitive(a)?new Error(safeToString(a)):a}function withAppended(a,b){var e,c=a.length,d=new Array(c+1);for(e=0;e<c;++e)d[e]=a[e];return d[e]=b,d}function getDataPropertyOrDefault(a,b,c){if(!es5.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function notEnumerableProp(a,b,c){if(isPrimitive(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(a,b,d),a}function thrower(a){throw a}function isClass(a){try{if("function"==typeof a){var b=es5.names(a.prototype),c=es5.isES5&&b.length>1,d=b.length>0&&!(1===b.length&&"constructor"===b[0]),e=thisAssignmentPattern.test(a+"")&&es5.names(a).length>0;if(c||d||e)return!0}return!1}catch(a){return!1}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;for(var l=8;l--;)new FakeConstructor;return obj}function isIdentifier(a){return rident.test(a)}function filledRange(a,b,c){for(var d=new Array(a),e=0;e<a;++e)d[e]=b+e+c;return d}function safeToString(a){try{return a+""}catch(a){return"[no string representation]"}}function isError(a){return null!==a&&"object"==typeof a&&"string"==typeof a.message&&"string"==typeof a.name}function markAsOriginatingFromRejection(a){try{notEnumerableProp(a,"isOperational",!0)}catch(a){}}function originatesFromRejection(a){return null!=a&&(a instanceof Error.__BluebirdErrorTypes__.OperationalError||a.isOperational===!0)}function canAttachTrace(a){return isError(a)&&es5.propertyIsWritable(a,"stack")}function classString(a){return{}.toString.call(a)}function copyDescriptors(a,b,c){for(var d=es5.names(a),e=0;e<d.length;++e){var f=d[e];if(c(f))try{es5.defineProperty(b,f,es5.getDescriptor(a,f))}catch(a){}}}function env(a){return hasEnvVariables?process.env[a]:void 0}function getNativePromise(){if("function"==typeof Promise)try{var a=new Promise(function(){});if("[object Promise]"==={}.toString.call(a))return Promise}catch(a){}}function domainBind(a,b){return a.bind(b)}var es5=_dereq_("./es5"),canEvaluate="undefined"==typeof navigator,errorObj={e:{}},tryCatchTarget,globalObject="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,inherits=function(a,b){function d(){this.constructor=a,this.constructor$=b;for(var d in b.prototype)c.call(b.prototype,d)&&"$"!==d.charAt(d.length-1)&&(this[d+"$"]=b.prototype[d])}var c={}.hasOwnProperty;return d.prototype=b.prototype,a.prototype=new d,a.prototype},inheritedDataKeys=function(){var a=[Array.prototype,Object.prototype,Function.prototype],b=function(b){for(var c=0;c<a.length;++c)if(a[c]===b)return!0;return!1};if(es5.isES5){var c=Object.getOwnPropertyNames;return function(a){for(var d=[],e=Object.create(null);null!=a&&!b(a);){var f;try{f=c(a)}catch(a){return d}for(var g=0;g<f.length;++g){var h=f[g];if(!e[h]){e[h]=!0;var i=Object.getOwnPropertyDescriptor(a,h);null!=i&&null==i.get&&null==i.set&&d.push(h)}}a=es5.getPrototypeOf(a)}return d}}var d={}.hasOwnProperty;return function(c){if(b(c))return[];var e=[];a:for(var f in c)if(d.call(c,f))e.push(f);else{for(var g=0;g<a.length;++g)if(d.call(a[g],f))continue a;e.push(f)}return e}}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/,rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(a){return canAttachTrace(a)?a:new Error(safeToString(a))}:function(a){if(canAttachTrace(a))return a;try{throw new Error(safeToString(a))}catch(a){return a}}}(),asArray=function(a){return es5.isArray(a)?a:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var ArrayFrom="function"==typeof Array.from?function(a){return Array.from(a)}:function(a){for(var d,b=[],c=a[Symbol.iterator]();!(d=c.next()).done;)b.push(d.value);return b};asArray=function(a){return es5.isArray(a)?a:null!=a&&"function"==typeof a[Symbol.iterator]?ArrayFrom(a):null}}var isNode="undefined"!=typeof process&&"[object process]"===classString(process).toLowerCase(),hasEnvVariables="undefined"!=typeof process&&"undefined"!=typeof process.env,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,asArray:asArray,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,isError:isError,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:isNode,hasEnvVariables:hasEnvVariables,env:env,global:globalObject,getNativePromise:getNativePromise,domainBind:domainBind};ret.isRecentNode=ret.isNode&&function(){var a=process.versions.node.split(".").map(Number);return 0===a[0]&&a[1]>10||a[0]>0}(),ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(a){ret.lastLineError=a}module.exports=ret},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,_dereq_("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:178}],36:[function(a,b,c){(function(){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=[].slice;e=10,d=5,c=function(){function c(a,b,d,e,g){this.maxNb=null!=a?a:0,this.minTime=null!=b?b:0,this.highWater=null!=d?d:-1,this.strategy=null!=e?e:c.prototype.strategy.LEAK,this.rejectOnDrop=null!=g&&g,this.schedulePriority=f(this.schedulePriority,this),this.submitPriority=f(this.submitPriority,this),this.submit=f(this.submit,this),this._nextRequest=Date.now(),this._nbRunning=0,this._queues=this._makeQueues(),this._running={},this._nextIndex=0,this._unblockTime=0,this.penalty=15*this.minTime||5e3,this.interrupt=!1,this.reservoir=null,this.limiter=null,this.events={}}var b;return c.strategy=c.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},c.Cluster=c.prototype.Cluster=a("./Cluster"),c.DLList=c.prototype.DLList=a("./DLList"),c.Promise=c.prototype.Promise=function(){try{return a("bluebird")}catch(a){return b=a,"undefined"!=typeof Promise&&null!==Promise?Promise:function(){throw new Error("Bottleneck: install 'bluebird' or use Node 0.12 or higher for Promise support")}}}(),c.prototype._trigger=function(a,b){return this.rejectOnDrop&&"dropped"===a&&b[0].cb.apply({},[new Error("This job has been dropped by Bottleneck")]),setTimeout(function(c){return function(){var d;return null!=(d=c.events[a])?d.forEach(function(a){return a.apply({},b)}):void 0}}(this),0)},c.prototype._makeQueues=function(){var a,b,d,f;for(f=[],a=b=1,d=e;1<=d?b<=d:b>=d;a=1<=d?++b:--b)f.push(new c.prototype.DLList);return f},c.prototype.chain=function(a){return this.limiter=a,this},c.prototype.isBlocked=function(){return this._unblockTime>=Date.now()},c.prototype._sanitizePriority=function(a){var b;return b=~~a!==a?d:a,b<0?0:b>e-1?e-1:b},c.prototype._find=function(a,b){var c,d,e,f;for(c=d=0,e=a.length;d<e;c=++d)if(f=a[c],b(f))return f;return[]},c.prototype.nbQueued=function(a){return null!=a?this._queues[this._sanitizePriority(a)].length:this._queues.reduce(function(a,b){return a+b.length},0)},c.prototype.nbRunning=function(){return this._nbRunning},c.prototype._getFirst=function(a){return this._find(a,function(a){return a.length>0})},c.prototype._conditionsCheck=function(){return(this.nbRunning()<this.maxNb||this.maxNb<=0)&&(null==this.reservoir||this.reservoir>0)},c.prototype.check=function(){return this._conditionsCheck()&&this._nextRequest-Date.now()<=0},c.prototype._tryToRun=function(){var a,b,c,d,e;return!!(this._conditionsCheck()&&(d=this.nbQueued())>0)&&(this._nbRunning++,null!=this.reservoir&&this.reservoir--,e=Math.max(this._nextRequest-Date.now(),0),this._nextRequest=Date.now()+e+this.minTime,c=this._getFirst(this._queues).shift(),1===d&&this._trigger("empty",[]),a=!1,b=this._nextIndex++,this._running[b]={
timeout:setTimeout(function(d){return function(){var e;return e=function(){var e;if(!a&&(a=!0,delete d._running[b],d._nbRunning--,d._tryToRun(),0===d.nbRunning()&&0===d.nbQueued()&&d._trigger("idle",[]),!d.interrupt))return null!=(e=c.cb)?e.apply({},Array.prototype.slice.call(arguments,0)):void 0},null!=d.limiter?d.limiter.submit.apply(d.limiter,Array.prototype.concat(c.task,c.args,e)):c.task.apply({},c.args.concat(e))}}(this),e),job:c},!0)},c.prototype.submit=function(){var a;return a=1<=arguments.length?g.call(arguments,0):[],this.submitPriority.apply({},Array.prototype.concat(d,a))},c.prototype.submitPriority=function(){var a,b,d,e,f,h,i,j;return f=arguments[0],j=arguments[1],a=4<=arguments.length?g.call(arguments,2,d=arguments.length-1):(d=2,[]),b=arguments[d++],e={task:j,args:a,cb:b},f=this._sanitizePriority(f),h=this.highWater>=0&&this.nbQueued()===this.highWater&&!this.check(),this.strategy===c.prototype.strategy.BLOCK&&(h||this.isBlocked())?(this._unblockTime=Date.now()+this.penalty,this._nextRequest=this._unblockTime+this.minTime,this._queues=this._makeQueues(),this._trigger("dropped",[e]),!0):h&&(i=this.strategy===c.prototype.strategy.LEAK?this._getFirst(this._queues.slice(f).reverse()).shift():this.strategy===c.prototype.strategy.OVERFLOW_PRIORITY?this._getFirst(this._queues.slice(f+1).reverse()).shift():this.strategy===c.prototype.strategy.OVERFLOW?e:void 0,null!=i&&this._trigger("dropped",[i]),null==i||this.strategy===c.prototype.strategy.OVERFLOW)?h:(this._queues[f].push(e),this._tryToRun(),h)},c.prototype.schedule=function(){var a;return a=1<=arguments.length?g.call(arguments,0):[],this.schedulePriority.apply({},Array.prototype.concat(d,a))},c.prototype.schedulePriority=function(){var a,b,d,e;return b=arguments[0],d=arguments[1],a=3<=arguments.length?g.call(arguments,2):[],e=function(){var a,b,c;return a=2<=arguments.length?g.call(arguments,0,c=arguments.length-1):(c=0,[]),b=arguments[c++],d.apply({},a).then(function(){var a;return a=1<=arguments.length?g.call(arguments,0):[],b.apply({},Array.prototype.concat(null,a))}).catch(function(){var a;return a=1<=arguments.length?g.call(arguments,0):[],b.apply({},a)})},new c.prototype.Promise(function(c){return function(d,f){return c.submitPriority.apply({},Array.prototype.concat(b,e,a,function(){var a;return a=1<=arguments.length?g.call(arguments,0):[],(null!=a[0]?f:(a.shift(),d)).apply({},a)}))}}(this))},c.prototype.changeSettings=function(a,b,c,d,e){for(this.maxNb=null!=a?a:this.maxNb,this.minTime=null!=b?b:this.minTime,this.highWater=null!=c?c:this.highWater,this.strategy=null!=d?d:this.strategy,this.rejectOnDrop=null!=e?e:this.rejectOnDrop;this._tryToRun(););return this},c.prototype.changePenalty=function(a){return this.penalty=null!=a?a:this.penalty,this},c.prototype.changeReservoir=function(a){for(this.reservoir=a;this._tryToRun(););return this},c.prototype.incrementReservoir=function(a){return null==a&&(a=0),this.changeReservoir(this.reservoir+a),this},c.prototype.on=function(a,b){return null!=this.events[a]?this.events[a].push(b):this.events[a]=[b],this},c.prototype.removeAllListeners=function(a){return null==a&&(a=null),null!=a?delete this.events[a]:this.events={},this},c.prototype.stopAll=function(a){var b,c,d,e,f,h,i;for(this.interrupt=null!=a?a:this.interrupt,e=Object.keys(this._running),b=0,h=e.length;b<h;b++)d=e[b],clearTimeout(this._running[d].timeout);if(this._tryToRun=function(){},this.check=function(){return!1},this.submit=this.submitPriority=function(){var a,b,c;return a=2<=arguments.length?g.call(arguments,0,c=arguments.length-1):(c=0,[]),(b=arguments[c++])(new Error("This limiter is stopped"))},this.schedule=this.schedulePriority=function(){return Promise.reject(new Error("This limiter is stopped"))},this.interrupt)for(f=0,i=e.length;f<i;f++)d=e[f],this._trigger("dropped",[this._running[d].job]);for(;c=this._getFirst(this._queues).shift();)this._trigger("dropped",[c]);return this._trigger("empty",[]),0===this.nbRunning()&&this._trigger("idle",[]),this},c}(),b.exports=c}).call(this)},{"./Cluster":37,"./DLList":38,bluebird:35}],37:[function(a,b,c){(function(){var c,d={}.hasOwnProperty;c=function(){function b(b,c,d,e,f){this.maxNb=b,this.minTime=c,this.highWater=d,this.strategy=e,this.rejectOnDrop=f,this.limiters={},this.Bottleneck=a("./Bottleneck"),this.startAutoCleanup()}return b.prototype.key=function(a){var b;return null==a&&(a=""),null!=(b=this.limiters[a])?b:this.limiters[a]=new this.Bottleneck(this.maxNb,this.minTime,this.highWater,this.strategy,this.rejectOnDrop)},b.prototype.deleteKey=function(a){return null==a&&(a=""),delete this.limiters[a]},b.prototype.all=function(a){var b,c,e,f;c=this.limiters,e=[];for(b in c)d.call(c,b)&&(f=c[b],e.push(a(f)));return e},b.prototype.keys=function(){return Object.keys(this.limiters)},b.prototype.startAutoCleanup=function(){var a;return this.stopAutoCleanup(),"function"==typeof(a=this.interval=setInterval(function(a){return function(){var b,c,d,e,f;e=Date.now(),c=a.limiters,d=[];for(b in c)f=c[b],f._nextRequest+3e5<e?d.push(a.deleteKey(b)):d.push(void 0);return d}}(this),3e4)).unref?a.unref():void 0},b.prototype.stopAutoCleanup=function(){return clearInterval(this.interval)},b}(),b.exports=c}).call(this)},{"./Bottleneck":36}],38:[function(a,b,c){(function(){var a;a=function(){function a(){this._first=null,this._last=null,this.length=0}return a.prototype.push=function(a){var b;this.length++,b={value:a,next:null},null!=this._last?(this._last.next=b,this._last=b):this._first=this._last=b},a.prototype.shift=function(){var a,b;if(null!=this._first)return this.length--,b=this._first.value,this._first=null!=(a=this._first.next)?a:this._last=null,b},a.prototype.getArray=function(){var a,b,c;for(a=this._first,c=[];null!=a;)c.push((b=a,a=a.next,b.value));return c},a}(),b.exports=a}).call(this)},{}],39:[function(a,b,c){(function(c){(function(){b.exports=a("./Bottleneck"),null!=c.window&&(c.window.Bottleneck=b.exports)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Bottleneck":36}],40:[function(a,b,c){},{}],41:[function(a,b,c){a("../../modules/es6.string.iterator"),a("../../modules/es6.array.from"),b.exports=a("../../modules/_core").Array.from},{"../../modules/_core":75,"../../modules/es6.array.from":144,"../../modules/es6.string.iterator":160}],42:[function(a,b,c){a("../modules/web.dom.iterable"),a("../modules/es6.string.iterator"),b.exports=a("../modules/core.get-iterator")},{"../modules/core.get-iterator":142,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],43:[function(a,b,c){a("../modules/web.dom.iterable"),a("../modules/es6.string.iterator"),b.exports=a("../modules/core.is-iterable")},{"../modules/core.is-iterable":143,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],44:[function(a,b,c){var d=a("../../modules/_core"),e=d.JSON||(d.JSON={stringify:JSON.stringify});b.exports=function(b){return e.stringify.apply(e,arguments)}},{"../../modules/_core":75}],45:[function(a,b,c){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.map"),a("../modules/es7.map.to-json"),b.exports=a("../modules/_core").Map},{"../modules/_core":75,"../modules/es6.map":146,"../modules/es6.object.to-string":156,"../modules/es6.string.iterator":160,"../modules/es7.map.to-json":162,"../modules/web.dom.iterable":166}],46:[function(a,b,c){a("../../modules/es6.number.is-integer"),b.exports=a("../../modules/_core").Number.isInteger},{"../../modules/_core":75,"../../modules/es6.number.is-integer":147}],47:[function(a,b,c){a("../../modules/es6.object.assign"),b.exports=a("../../modules/_core").Object.assign},{"../../modules/_core":75,"../../modules/es6.object.assign":148}],48:[function(a,b,c){a("../../modules/es6.object.create");var d=a("../../modules/_core").Object;b.exports=function(b,c){return d.create(b,c)}},{"../../modules/_core":75,"../../modules/es6.object.create":149}],49:[function(a,b,c){a("../../modules/es6.object.define-properties");var d=a("../../modules/_core").Object;b.exports=function(b,c){return d.defineProperties(b,c)}},{"../../modules/_core":75,"../../modules/es6.object.define-properties":150}],50:[function(a,b,c){a("../../modules/es6.object.define-property");var d=a("../../modules/_core").Object;b.exports=function(b,c,e){return d.defineProperty(b,c,e)}},{"../../modules/_core":75,"../../modules/es6.object.define-property":151}],51:[function(a,b,c){a("../../modules/es6.object.freeze"),b.exports=a("../../modules/_core").Object.freeze},{"../../modules/_core":75,"../../modules/es6.object.freeze":152}],52:[function(a,b,c){a("../../modules/es6.object.get-prototype-of"),b.exports=a("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":75,"../../modules/es6.object.get-prototype-of":153}],53:[function(a,b,c){a("../../modules/es6.object.keys"),b.exports=a("../../modules/_core").Object.keys},{"../../modules/_core":75,"../../modules/es6.object.keys":154}],54:[function(a,b,c){a("../../modules/es6.object.set-prototype-of"),b.exports=a("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":75,"../../modules/es6.object.set-prototype-of":155}],55:[function(a,b,c){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.promise"),b.exports=a("../modules/_core").Promise},{"../modules/_core":75,"../modules/es6.object.to-string":156,"../modules/es6.promise":157,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],56:[function(a,b,c){a("../../modules/es6.reflect.construct"),b.exports=a("../../modules/_core").Reflect.construct},{"../../modules/_core":75,"../../modules/es6.reflect.construct":158}],57:[function(a,b,c){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.set"),a("../modules/es7.set.to-json"),b.exports=a("../modules/_core").Set},{"../modules/_core":75,"../modules/es6.object.to-string":156,"../modules/es6.set":159,"../modules/es6.string.iterator":160,"../modules/es7.set.to-json":163,"../modules/web.dom.iterable":166}],58:[function(a,b,c){a("../../modules/es6.symbol"),a("../../modules/es6.object.to-string"),a("../../modules/es7.symbol.async-iterator"),a("../../modules/es7.symbol.observable"),b.exports=a("../../modules/_core").Symbol},{"../../modules/_core":75,"../../modules/es6.object.to-string":156,"../../modules/es6.symbol":161,"../../modules/es7.symbol.async-iterator":164,"../../modules/es7.symbol.observable":165}],59:[function(a,b,c){a("../../modules/es6.string.iterator"),a("../../modules/web.dom.iterable"),b.exports=a("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":139,"../../modules/es6.string.iterator":160,"../../modules/web.dom.iterable":166}],60:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],61:[function(a,b,c){b.exports=function(){}},{}],62:[function(a,b,c){b.exports=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a}},{}],63:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":96}],64:[function(a,b,c){var d=a("./_for-of");b.exports=function(a,b){var c=[];return d(a,!1,c.push,c,b),c}},{"./_for-of":85}],65:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_to-length"),f=a("./_to-index");b.exports=function(a){return function(b,c,g){var k,h=d(b),i=e(h.length),j=f(g,i);if(a&&c!=c){for(;i>j;)if(k=h[j++],k!=k)return!0}else for(;i>j;j++)if((a||j in h)&&h[j]===c)return a||j||0;return!a&&-1}}},{"./_to-index":131,"./_to-iobject":133,"./_to-length":134}],66:[function(a,b,c){var d=a("./_ctx"),e=a("./_iobject"),f=a("./_to-object"),g=a("./_to-length"),h=a("./_array-species-create");b.exports=function(a,b){var c=1==a,i=2==a,j=3==a,k=4==a,l=6==a,m=5==a||l,n=b||h;return function(b,h,o){for(var v,w,p=f(b),q=e(p),r=d(h,o,3),s=g(q.length),t=0,u=c?n(b,s):i?n(b,0):void 0;s>t;t++)if((m||t in q)&&(v=q[t],w=r(v,t,p),a))if(c)u[t]=w;else if(w)switch(a){case 3:return!0;case 5:return v;case 6:return t;case 2:u.push(v)}else if(k)return!1;return l?-1:j||k?k:u}}},{"./_array-species-create":68,"./_ctx":77,"./_iobject":92,"./_to-length":134,"./_to-object":135}],67:[function(a,b,c){var d=a("./_is-object"),e=a("./_is-array"),f=a("./_wks")("species");b.exports=function(a){var b;return e(a)&&(b=a.constructor,"function"!=typeof b||b!==Array&&!e(b.prototype)||(b=void 0),d(b)&&(b=b[f],null===b&&(b=void 0))),void 0===b?Array:b}},{"./_is-array":94,"./_is-object":96,"./_wks":140}],68:[function(a,b,c){var d=a("./_array-species-constructor");b.exports=function(a,b){return new(d(a))(b)}},{"./_array-species-constructor":67}],69:[function(a,b,c){"use strict";var d=a("./_a-function"),e=a("./_is-object"),f=a("./_invoke"),g=[].slice,h={},i=function(a,b,c){if(!(b in h)){for(var d=[],e=0;e<b;e++)d[e]="a["+e+"]";h[b]=Function("F,a","return new F("+d.join(",")+")")}return h[b](a,c)};b.exports=Function.bind||function(b){var c=d(this),h=g.call(arguments,1),j=function(){var a=h.concat(g.call(arguments));return this instanceof j?i(c,a.length,a):f(c,a,b)};return e(c.prototype)&&(j.prototype=c.prototype),j}},{"./_a-function":60,"./_invoke":91,"./_is-object":96}],70:[function(a,b,c){var d=a("./_cof"),e=a("./_wks")("toStringTag"),f="Arguments"==d(function(){return arguments}()),g=function(a,b){try{return a[b]}catch(a){}};b.exports=function(a){var b,c,h;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=g(b=Object(a),e))?c:f?d(b):"Object"==(h=d(b))&&"function"==typeof b.callee?"Arguments":h}},{"./_cof":71,"./_wks":140}],71:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],72:[function(a,b,c){"use strict";var d=a("./_object-dp").f,e=a("./_object-create"),f=a("./_redefine-all"),g=a("./_ctx"),h=a("./_an-instance"),i=a("./_defined"),j=a("./_for-of"),k=a("./_iter-define"),l=a("./_iter-step"),m=a("./_set-species"),n=a("./_descriptors"),o=a("./_meta").fastKey,p=n?"_s":"size",q=function(a,b){var d,c=o(b);if("F"!==c)return a._i[c];for(d=a._f;d;d=d.n)if(d.k==b)return d};b.exports={getConstructor:function(a,b,c,k){var l=a(function(a,d){h(a,l,b,"_i"),a._i=e(null),a._f=void 0,a._l=void 0,a[p]=0,void 0!=d&&j(d,c,a[k],a)});return f(l.prototype,{clear:function(){for(var b=this,c=b._i,d=b._f;d;d=d.n)d.r=!0,d.p&&(d.p=d.p.n=void 0),delete c[d.i];b._f=b._l=void 0,b[p]=0},delete:function(a){var b=this,c=q(b,a);if(c){var d=c.n,e=c.p;delete b._i[c.i],c.r=!0,e&&(e.n=d),d&&(d.p=e),b._f==c&&(b._f=d),b._l==c&&(b._l=e),b[p]--}return!!c},forEach:function(b){h(this,l,"forEach");for(var d,c=g(b,arguments.length>1?arguments[1]:void 0,3);d=d?d.n:this._f;)for(c(d.v,d.k,this);d&&d.r;)d=d.p},has:function(b){return!!q(this,b)}}),n&&d(l.prototype,"size",{get:function(){return i(this[p])}}),l},def:function(a,b,c){var e,f,d=q(a,b);return d?d.v=c:(a._l=d={i:f=o(b,!0),k:b,v:c,p:e=a._l,n:void 0,r:!1},a._f||(a._f=d),e&&(e.n=d),a[p]++,"F"!==f&&(a._i[f]=d)),a},getEntry:q,setStrong:function(a,b,c){k(a,b,function(a,b){this._t=a,this._k=b,this._l=void 0},function(){for(var a=this,b=a._k,c=a._l;c&&c.r;)c=c.p;return a._t&&(a._l=c=c?c.n:a._t._f)?"keys"==b?l(0,c.k):"values"==b?l(0,c.v):l(0,[c.k,c.v]):(a._t=void 0,l(1))},c?"entries":"values",!c,!0),m(b)}}},{"./_an-instance":62,"./_ctx":77,"./_defined":78,"./_descriptors":79,"./_for-of":85,"./_iter-define":99,"./_iter-step":101,"./_meta":105,"./_object-create":108,"./_object-dp":109,"./_redefine-all":121,"./_set-species":124}],73:[function(a,b,c){var d=a("./_classof"),e=a("./_array-from-iterable");b.exports=function(a){return function(){if(d(this)!=a)throw TypeError(a+"#toJSON isn't generic");return e(this)}}},{"./_array-from-iterable":64,"./_classof":70}],74:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_export"),f=a("./_meta"),g=a("./_fails"),h=a("./_hide"),i=a("./_redefine-all"),j=a("./_for-of"),k=a("./_an-instance"),l=a("./_is-object"),m=a("./_set-to-string-tag"),n=a("./_object-dp").f,o=a("./_array-methods")(0),p=a("./_descriptors");b.exports=function(a,b,c,q,r,s){var t=d[a],u=t,v=r?"set":"add",w=u&&u.prototype,x={};return p&&"function"==typeof u&&(s||w.forEach&&!g(function(){(new u).entries().next()}))?(u=b(function(b,c){k(b,u,a,"_c"),b._c=new t,void 0!=c&&j(c,r,b[v],b)}),o("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(a){var b="add"==a||"set"==a;a in w&&(!s||"clear"!=a)&&h(u.prototype,a,function(c,d){if(k(this,u,a),!b&&s&&!l(c))return"get"==a&&void 0;var e=this._c[a](0===c?0:c,d);return b?this:e})}),"size"in w&&n(u.prototype,"size",{get:function(){return this._c.size}})):(u=q.getConstructor(b,a,r,v),i(u.prototype,c),f.NEED=!0),m(u,a),x[a]=u,e(e.G+e.W+e.F,x),s||q.setStrong(u,a,r),u}},{"./_an-instance":62,"./_array-methods":66,"./_descriptors":79,"./_export":83,"./_fails":84,"./_for-of":85,"./_global":86,"./_hide":88,"./_is-object":96,"./_meta":105,"./_object-dp":109,"./_redefine-all":121,"./_set-to-string-tag":125}],75:[function(a,b,c){var d=b.exports={version:"2.4.0"};"number"==typeof __e&&(__e=d)},{}],76:[function(a,b,c){"use strict";var d=a("./_object-dp"),e=a("./_property-desc");b.exports=function(a,b,c){b in a?d.f(a,b,e(0,c)):a[b]=c}},{"./_object-dp":109,"./_property-desc":120}],77:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":60}],78:[function(a,b,c){b.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}},{}],79:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":84}],80:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":86,"./_is-object":96}],81:[function(a,b,c){b.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],82:[function(a,b,c){var d=a("./_object-keys"),e=a("./_object-gops"),f=a("./_object-pie");b.exports=function(a){var b=d(a),c=e.f;if(c)for(var j,g=c(a),h=f.f,i=0;g.length>i;)h.call(a,j=g[i++])&&b.push(j);return b}},{"./_object-gops":114,"./_object-keys":117,"./_object-pie":118}],83:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var s,t,u,j=a&i.F,k=a&i.G,l=a&i.S,m=a&i.P,n=a&i.B,o=a&i.W,p=k?e:e[b]||(e[b]={}),q=p[h],r=k?d:l?d[b]:(d[b]||{})[h];k&&(c=b);for(s in c)t=!j&&r&&void 0!==r[s],t&&s in p||(u=t?r[s]:c[s],p[s]=k&&"function"!=typeof r[s]?c[s]:n&&t?f(u,d):o&&r[s]==u?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(u):m&&"function"==typeof u?f(Function.call,u):u,m&&((p.virtual||(p.virtual={}))[s]=u,a&i.R&&q&&!q[s]&&g(q,s,u)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":75,"./_ctx":77,"./_global":86,"./_hide":88}],84:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(a){return!0}}},{}],85:[function(a,b,c){var d=a("./_ctx"),e=a("./_iter-call"),f=a("./_is-array-iter"),g=a("./_an-object"),h=a("./_to-length"),i=a("./core.get-iterator-method"),j={},k={},c=b.exports=function(a,b,c,l,m){var q,r,s,t,n=m?function(){return a}:i(a),o=d(c,l,b?2:1),p=0;if("function"!=typeof n)throw TypeError(a+" is not iterable!");if(f(n)){for(q=h(a.length);q>p;p++)if(t=b?o(g(r=a[p])[0],r[1]):o(a[p]),t===j||t===k)return t}else for(s=n.call(a);!(r=s.next()).done;)if(t=e(s,o,r.value,b),t===j||t===k)return t};c.BREAK=j,c.RETURN=k},{"./_an-object":63,"./_ctx":77,"./_is-array-iter":93,"./_iter-call":97,"./_to-length":134,"./core.get-iterator-method":141}],86:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],87:[function(a,b,c){var d={}.hasOwnProperty;b.exports=function(a,b){return d.call(a,b)}},{}],88:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":79,"./_object-dp":109,"./_property-desc":120}],89:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":86}],90:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":79,"./_dom-create":80,"./_fails":84}],91:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],92:[function(a,b,c){var d=a("./_cof");b.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==d(a)?a.split(""):Object(a)}},{"./_cof":71}],93:[function(a,b,c){var d=a("./_iterators"),e=a("./_wks")("iterator"),f=Array.prototype;b.exports=function(a){return void 0!==a&&(d.Array===a||f[e]===a)}},{"./_iterators":102,"./_wks":140}],94:[function(a,b,c){var d=a("./_cof");b.exports=Array.isArray||function(b){return"Array"==d(b)}},{"./_cof":71}],95:[function(a,b,c){var d=a("./_is-object"),e=Math.floor;b.exports=function(b){return!d(b)&&isFinite(b)&&e(b)===b}},{"./_is-object":96}],96:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],97:[function(a,b,c){var d=a("./_an-object");b.exports=function(a,b,c,e){try{return e?b(d(c)[0],c[1]):b(c)}catch(b){var f=a.return;throw void 0!==f&&d(f.call(a)),b}}},{"./_an-object":63}],98:[function(a,b,c){"use strict";var d=a("./_object-create"),e=a("./_property-desc"),f=a("./_set-to-string-tag"),g={};a("./_hide")(g,a("./_wks")("iterator"),function(){return this}),b.exports=function(a,b,c){a.prototype=d(g,{next:e(1,c)}),f(a,b+" Iterator")}},{"./_hide":88,"./_object-create":108,"./_property-desc":120,"./_set-to-string-tag":125,"./_wks":140}],99:[function(a,b,c){"use strict";var d=a("./_library"),e=a("./_export"),f=a("./_redefine"),g=a("./_hide"),h=a("./_has"),i=a("./_iterators"),j=a("./_iter-create"),k=a("./_set-to-string-tag"),l=a("./_object-gpo"),m=a("./_wks")("iterator"),n=!([].keys&&"next"in[].keys()),o="@@iterator",p="keys",q="values",r=function(){return this};b.exports=function(a,b,c,s,t,u,v){j(c,b,s);var F,G,H,w=function(a){if(!n&&a in A)return A[a];switch(a){case p:return function(){return new c(this,a)};case q:return function(){return new c(this,a)}}return function(){return new c(this,a)}},x=b+" Iterator",y=t==q,z=!1,A=a.prototype,B=A[m]||A[o]||t&&A[t],C=B||w(t),D=t?y?w("entries"):C:void 0,E="Array"==b?A.entries||B:B;if(E&&(H=l(E.call(new a)),H!==Object.prototype&&(k(H,x,!0),d||h(H,m)||g(H,m,r))),y&&B&&B.name!==q&&(z=!0,C=function(){return B.call(this)}),d&&!v||!n&&!z&&A[m]||g(A,m,C),i[b]=C,i[x]=r,t)if(F={values:y?C:w(q),keys:u?C:w(p),entries:D},v)for(G in F)G in A||f(A,G,F[G]);else e(e.P+e.F*(n||z),b,F);return F}},{"./_export":83,"./_has":87,"./_hide":88,"./_iter-create":98,"./_iterators":102,"./_library":104,"./_object-gpo":115,"./_redefine":122,"./_set-to-string-tag":125,"./_wks":140}],100:[function(a,b,c){var d=a("./_wks")("iterator"),e=!1;try{var f=[7][d]();f.return=function(){e=!0},Array.from(f,function(){throw 2})}catch(a){}b.exports=function(a,b){if(!b&&!e)return!1;var c=!1;try{var f=[7],g=f[d]();g.next=function(){return{done:c=!0}},f[d]=function(){return g},a(f)}catch(a){}return c}},{"./_wks":140}],101:[function(a,b,c){b.exports=function(a,b){return{value:b,done:!!a}}},{}],102:[function(a,b,c){b.exports={}},{}],103:[function(a,b,c){var d=a("./_object-keys"),e=a("./_to-iobject");b.exports=function(a,b){for(var i,c=e(a),f=d(c),g=f.length,h=0;g>h;)if(c[i=f[h++]]===b)return i}},{"./_object-keys":117,"./_to-iobject":133}],104:[function(a,b,c){b.exports=!0},{}],105:[function(a,b,c){var d=a("./_uid")("meta"),e=a("./_is-object"),f=a("./_has"),g=a("./_object-dp").f,h=0,i=Object.isExtensible||function(){return!0},j=!a("./_fails")(function(){return i(Object.preventExtensions({}))}),k=function(a){g(a,d,{value:{i:"O"+ ++h,w:{}}})},l=function(a,b){if(!e(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!f(a,d)){if(!i(a))return"F";if(!b)return"E";k(a)}return a[d].i},m=function(a,b){if(!f(a,d)){if(!i(a))return!0;if(!b)return!1;k(a)}return a[d].w},n=function(a){return j&&o.NEED&&i(a)&&!f(a,d)&&k(a),a},o=b.exports={KEY:d,NEED:!1,fastKey:l,getWeak:m,onFreeze:n}},{"./_fails":84,"./_has":87,"./_is-object":96,"./_object-dp":109,"./_uid":137}],106:[function(a,b,c){var d=a("./_global"),e=a("./_task").set,f=d.MutationObserver||d.WebKitMutationObserver,g=d.process,h=d.Promise,i="process"==a("./_cof")(g);b.exports=function(){var a,b,c,j=function(){var d,e;for(i&&(d=g.domain)&&d.exit();a;){e=a.fn,a=a.next;try{e()}catch(d){throw a?c():b=void 0,d}}b=void 0,d&&d.enter()};if(i)c=function(){g.nextTick(j)};else if(f){var k=!0,l=document.createTextNode("");new f(j).observe(l,{characterData:!0}),c=function(){l.data=k=!k}}else if(h&&h.resolve){var m=h.resolve();c=function(){m.then(j)}}else c=function(){e.call(d,j)};return function(d){var e={fn:d,next:void 0};b&&(b.next=e),a||(a=e,c()),b=e}}},{"./_cof":71,"./_global":86,"./_task":130}],107:[function(a,b,c){"use strict";var d=a("./_object-keys"),e=a("./_object-gops"),f=a("./_object-pie"),g=a("./_to-object"),h=a("./_iobject"),i=Object.assign;b.exports=!i||a("./_fails")(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=i({},a)[c]||Object.keys(i({},b)).join("")!=d})?function(b,c){for(var i=g(b),j=arguments.length,k=1,l=e.f,m=f.f;j>k;)for(var r,n=h(arguments[k++]),o=l?d(n).concat(l(n)):d(n),p=o.length,q=0;p>q;)m.call(n,r=o[q++])&&(i[r]=n[r]);return i}:i},{"./_fails":84,"./_iobject":92,"./_object-gops":114,"./_object-keys":117,"./_object-pie":118,"./_to-object":135}],108:[function(a,b,c){var d=a("./_an-object"),e=a("./_object-dps"),f=a("./_enum-bug-keys"),g=a("./_shared-key")("IE_PROTO"),h=function(){},i="prototype",j=function(){var g,b=a("./_dom-create")("iframe"),c=f.length,d="<",e=">";for(b.style.display="none",a("./_html").appendChild(b),b.src="javascript:",g=b.contentWindow.document,g.open(),g.write(d+"script"+e+"document.F=Object"+d+"/script"+e),g.close(),j=g.F;c--;)delete j[i][f[c]];return j()};b.exports=Object.create||function(b,c){var f;return null!==b?(h[i]=d(b),f=new h,h[i]=null,f[g]=b):f=j(),void 0===c?f:e(f,c)}},{"./_an-object":63,"./_dom-create":80,"./_enum-bug-keys":81,"./_html":89,"./_object-dps":110,"./_shared-key":126}],109:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(b,c,h){if(d(b),c=f(c,!0),d(h),e)try{return g(b,c,h)}catch(a){}if("get"in h||"set"in h)throw TypeError("Accessors not supported!");return"value"in h&&(b[c]=h.value),b}},{"./_an-object":63,"./_descriptors":79,"./_ie8-dom-define":90,"./_to-primitive":136}],110:[function(a,b,c){var d=a("./_object-dp"),e=a("./_an-object"),f=a("./_object-keys");b.exports=a("./_descriptors")?Object.defineProperties:function(b,c){e(b);for(var j,g=f(c),h=g.length,i=0;h>i;)d.f(b,j=g[i++],c[j]);return b}},{"./_an-object":63,"./_descriptors":79,"./_object-dp":109,"./_object-keys":117}],111:[function(a,b,c){var d=a("./_object-pie"),e=a("./_property-desc"),f=a("./_to-iobject"),g=a("./_to-primitive"),h=a("./_has"),i=a("./_ie8-dom-define"),j=Object.getOwnPropertyDescriptor;c.f=a("./_descriptors")?j:function(b,c){if(b=f(b),c=g(c,!0),i)try{return j(b,c)}catch(a){}if(h(b,c))return e(!d.f.call(b,c),b[c])}},{"./_descriptors":79,"./_has":87,"./_ie8-dom-define":90,"./_object-pie":118,"./_property-desc":120,"./_to-iobject":133,"./_to-primitive":136}],112:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_object-gopn").f,f={}.toString,g="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],h=function(a){try{return e(a)}catch(a){return g.slice()}};b.exports.f=function(b){return g&&"[object Window]"==f.call(b)?h(b):e(d(b))}},{"./_object-gopn":113,"./_to-iobject":133}],113:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys").concat("length","prototype");c.f=Object.getOwnPropertyNames||function(b){return d(b,e)}},{"./_enum-bug-keys":81,"./_object-keys-internal":116}],114:[function(a,b,c){c.f=Object.getOwnPropertySymbols},{}],115:[function(a,b,c){var d=a("./_has"),e=a("./_to-object"),f=a("./_shared-key")("IE_PROTO"),g=Object.prototype;b.exports=Object.getPrototypeOf||function(a){return a=e(a),d(a,f)?a[f]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?g:null}},{"./_has":87,"./_shared-key":126,"./_to-object":135}],116:[function(a,b,c){var d=a("./_has"),e=a("./_to-iobject"),f=a("./_array-includes")(!1),g=a("./_shared-key")("IE_PROTO");b.exports=function(a,b){var j,c=e(a),h=0,i=[];for(j in c)j!=g&&d(c,j)&&i.push(j);for(;b.length>h;)d(c,j=b[h++])&&(~f(i,j)||i.push(j));return i}},{"./_array-includes":65,"./_has":87,"./_shared-key":126,"./_to-iobject":133}],117:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys");b.exports=Object.keys||function(b){return d(b,e)}},{"./_enum-bug-keys":81,"./_object-keys-internal":116}],118:[function(a,b,c){c.f={}.propertyIsEnumerable},{}],119:[function(a,b,c){var d=a("./_export"),e=a("./_core"),f=a("./_fails");b.exports=function(a,b){var c=(e.Object||{})[a]||Object[a],g={};g[a]=b(c),d(d.S+d.F*f(function(){c(1)}),"Object",g)}},{"./_core":75,"./_export":83,"./_fails":84}],120:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],121:[function(a,b,c){var d=a("./_hide");b.exports=function(a,b,c){for(var e in b)c&&a[e]?a[e]=b[e]:d(a,e,b[e]);return a}},{"./_hide":88}],122:[function(a,b,c){b.exports=a("./_hide")},{"./_hide":88}],123:[function(a,b,c){var d=a("./_is-object"),e=a("./_an-object"),f=function(a,b){if(e(a),!d(b)&&null!==b)throw TypeError(b+": can't set as prototype!")};b.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(b,c,d){try{d=a("./_ctx")(Function.call,a("./_object-gopd").f(Object.prototype,"__proto__").set,2),d(b,[]),c=!(b instanceof Array)}catch(a){c=!0}return function(b,e){return f(b,e),c?b.__proto__=e:d(b,e),b}}({},!1):void 0),check:f}},{"./_an-object":63,"./_ctx":77,"./_is-object":96,"./_object-gopd":111}],124:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_core"),f=a("./_object-dp"),g=a("./_descriptors"),h=a("./_wks")("species");b.exports=function(a){var b="function"==typeof e[a]?e[a]:d[a];g&&b&&!b[h]&&f.f(b,h,{configurable:!0,get:function(){return this}})}},{"./_core":75,"./_descriptors":79,"./_global":86,"./_object-dp":109,"./_wks":140}],125:[function(a,b,c){var d=a("./_object-dp").f,e=a("./_has"),f=a("./_wks")("toStringTag");b.exports=function(a,b,c){a&&!e(a=c?a:a.prototype,f)&&d(a,f,{configurable:!0,value:b})}},{"./_has":87,"./_object-dp":109,"./_wks":140}],126:[function(a,b,c){var d=a("./_shared")("keys"),e=a("./_uid");b.exports=function(a){return d[a]||(d[a]=e(a))}},{"./_shared":127,"./_uid":137}],127:[function(a,b,c){var d=a("./_global"),e="__core-js_shared__",f=d[e]||(d[e]={});b.exports=function(a){return f[a]||(f[a]={})}},{"./_global":86}],128:[function(a,b,c){var d=a("./_an-object"),e=a("./_a-function"),f=a("./_wks")("species");b.exports=function(a,b){
var g,c=d(a).constructor;return void 0===c||void 0==(g=d(c)[f])?b:e(g)}},{"./_a-function":60,"./_an-object":63,"./_wks":140}],129:[function(a,b,c){var d=a("./_to-integer"),e=a("./_defined");b.exports=function(a){return function(b,c){var i,j,f=String(e(b)),g=d(c),h=f.length;return g<0||g>=h?a?"":void 0:(i=f.charCodeAt(g),i<55296||i>56319||g+1===h||(j=f.charCodeAt(g+1))<56320||j>57343?a?f.charAt(g):i:a?f.slice(g,g+2):(i-55296<<10)+(j-56320)+65536)}}},{"./_defined":78,"./_to-integer":132}],130:[function(a,b,c){var p,q,r,d=a("./_ctx"),e=a("./_invoke"),f=a("./_html"),g=a("./_dom-create"),h=a("./_global"),i=h.process,j=h.setImmediate,k=h.clearImmediate,l=h.MessageChannel,m=0,n={},o="onreadystatechange",s=function(){var a=+this;if(n.hasOwnProperty(a)){var b=n[a];delete n[a],b()}},t=function(a){s.call(a.data)};j&&k||(j=function(b){for(var c=[],d=1;arguments.length>d;)c.push(arguments[d++]);return n[++m]=function(){e("function"==typeof b?b:Function(b),c)},p(m),m},k=function(b){delete n[b]},"process"==a("./_cof")(i)?p=function(a){i.nextTick(d(s,a,1))}:l?(q=new l,r=q.port2,q.port1.onmessage=t,p=d(r.postMessage,r,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(p=function(a){h.postMessage(a+"","*")},h.addEventListener("message",t,!1)):p=o in g("script")?function(a){f.appendChild(g("script"))[o]=function(){f.removeChild(this),s.call(a)}}:function(a){setTimeout(d(s,a,1),0)}),b.exports={set:j,clear:k}},{"./_cof":71,"./_ctx":77,"./_dom-create":80,"./_global":86,"./_html":89,"./_invoke":91}],131:[function(a,b,c){var d=a("./_to-integer"),e=Math.max,f=Math.min;b.exports=function(a,b){return a=d(a),a<0?e(a+b,0):f(a,b)}},{"./_to-integer":132}],132:[function(a,b,c){var d=Math.ceil,e=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?e:d)(a)}},{}],133:[function(a,b,c){var d=a("./_iobject"),e=a("./_defined");b.exports=function(a){return d(e(a))}},{"./_defined":78,"./_iobject":92}],134:[function(a,b,c){var d=a("./_to-integer"),e=Math.min;b.exports=function(a){return a>0?e(d(a),9007199254740991):0}},{"./_to-integer":132}],135:[function(a,b,c){var d=a("./_defined");b.exports=function(a){return Object(d(a))}},{"./_defined":78}],136:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":96}],137:[function(a,b,c){var d=0,e=Math.random();b.exports=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++d+e).toString(36))}},{}],138:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_library"),g=a("./_wks-ext"),h=a("./_object-dp").f;b.exports=function(a){var b=e.Symbol||(e.Symbol=f?{}:d.Symbol||{});"_"==a.charAt(0)||a in b||h(b,a,{value:g.f(a)})}},{"./_core":75,"./_global":86,"./_library":104,"./_object-dp":109,"./_wks-ext":139}],139:[function(a,b,c){c.f=a("./_wks")},{"./_wks":140}],140:[function(a,b,c){var d=a("./_shared")("wks"),e=a("./_uid"),f=a("./_global").Symbol,g="function"==typeof f,h=b.exports=function(a){return d[a]||(d[a]=g&&f[a]||(g?f:e)("Symbol."+a))};h.store=d},{"./_global":86,"./_shared":127,"./_uid":137}],141:[function(a,b,c){var d=a("./_classof"),e=a("./_wks")("iterator"),f=a("./_iterators");b.exports=a("./_core").getIteratorMethod=function(a){if(void 0!=a)return a[e]||a["@@iterator"]||f[d(a)]}},{"./_classof":70,"./_core":75,"./_iterators":102,"./_wks":140}],142:[function(a,b,c){var d=a("./_an-object"),e=a("./core.get-iterator-method");b.exports=a("./_core").getIterator=function(a){var b=e(a);if("function"!=typeof b)throw TypeError(a+" is not iterable!");return d(b.call(a))}},{"./_an-object":63,"./_core":75,"./core.get-iterator-method":141}],143:[function(a,b,c){var d=a("./_classof"),e=a("./_wks")("iterator"),f=a("./_iterators");b.exports=a("./_core").isIterable=function(a){var b=Object(a);return void 0!==b[e]||"@@iterator"in b||f.hasOwnProperty(d(b))}},{"./_classof":70,"./_core":75,"./_iterators":102,"./_wks":140}],144:[function(a,b,c){"use strict";var d=a("./_ctx"),e=a("./_export"),f=a("./_to-object"),g=a("./_iter-call"),h=a("./_is-array-iter"),i=a("./_to-length"),j=a("./_create-property"),k=a("./core.get-iterator-method");e(e.S+e.F*!a("./_iter-detect")(function(a){Array.from(a)}),"Array",{from:function(b){var q,r,s,t,c=f(b),e="function"==typeof this?this:Array,l=arguments.length,m=l>1?arguments[1]:void 0,n=void 0!==m,o=0,p=k(c);if(n&&(m=d(m,l>2?arguments[2]:void 0,2)),void 0==p||e==Array&&h(p))for(q=i(c.length),r=new e(q);q>o;o++)j(r,o,n?m(c[o],o):c[o]);else for(t=p.call(c),r=new e;!(s=t.next()).done;o++)j(r,o,n?g(t,m,[s.value,o],!0):s.value);return r.length=o,r}})},{"./_create-property":76,"./_ctx":77,"./_export":83,"./_is-array-iter":93,"./_iter-call":97,"./_iter-detect":100,"./_to-length":134,"./_to-object":135,"./core.get-iterator-method":141}],145:[function(a,b,c){"use strict";var d=a("./_add-to-unscopables"),e=a("./_iter-step"),f=a("./_iterators"),g=a("./_to-iobject");b.exports=a("./_iter-define")(Array,"Array",function(a,b){this._t=g(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,e(1)):"keys"==b?e(0,c):"values"==b?e(0,a[c]):e(0,[c,a[c]])},"values"),f.Arguments=f.Array,d("keys"),d("values"),d("entries")},{"./_add-to-unscopables":61,"./_iter-define":99,"./_iter-step":101,"./_iterators":102,"./_to-iobject":133}],146:[function(a,b,c){"use strict";var d=a("./_collection-strong");b.exports=a("./_collection")("Map",function(a){return function(){return a(this,arguments.length>0?arguments[0]:void 0)}},{get:function(b){var c=d.getEntry(this,b);return c&&c.v},set:function(b,c){return d.def(this,0===b?0:b,c)}},d,!0)},{"./_collection":74,"./_collection-strong":72}],147:[function(a,b,c){var d=a("./_export");d(d.S,"Number",{isInteger:a("./_is-integer")})},{"./_export":83,"./_is-integer":95}],148:[function(a,b,c){var d=a("./_export");d(d.S+d.F,"Object",{assign:a("./_object-assign")})},{"./_export":83,"./_object-assign":107}],149:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{create:a("./_object-create")})},{"./_export":83,"./_object-create":108}],150:[function(a,b,c){var d=a("./_export");d(d.S+d.F*!a("./_descriptors"),"Object",{defineProperties:a("./_object-dps")})},{"./_descriptors":79,"./_export":83,"./_object-dps":110}],151:[function(a,b,c){var d=a("./_export");d(d.S+d.F*!a("./_descriptors"),"Object",{defineProperty:a("./_object-dp").f})},{"./_descriptors":79,"./_export":83,"./_object-dp":109}],152:[function(a,b,c){var d=a("./_is-object"),e=a("./_meta").onFreeze;a("./_object-sap")("freeze",function(a){return function(c){return a&&d(c)?a(e(c)):c}})},{"./_is-object":96,"./_meta":105,"./_object-sap":119}],153:[function(a,b,c){var d=a("./_to-object"),e=a("./_object-gpo");a("./_object-sap")("getPrototypeOf",function(){return function(b){return e(d(b))}})},{"./_object-gpo":115,"./_object-sap":119,"./_to-object":135}],154:[function(a,b,c){var d=a("./_to-object"),e=a("./_object-keys");a("./_object-sap")("keys",function(){return function(b){return e(d(b))}})},{"./_object-keys":117,"./_object-sap":119,"./_to-object":135}],155:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{setPrototypeOf:a("./_set-proto").set})},{"./_export":83,"./_set-proto":123}],156:[function(a,b,c){arguments[4][40][0].apply(c,arguments)},{dup:40}],157:[function(a,b,c){"use strict";var v,w,x,d=a("./_library"),e=a("./_global"),f=a("./_ctx"),g=a("./_classof"),h=a("./_export"),i=a("./_is-object"),j=a("./_a-function"),k=a("./_an-instance"),l=a("./_for-of"),m=a("./_species-constructor"),n=a("./_task").set,o=a("./_microtask")(),p="Promise",q=e.TypeError,r=e.process,s=e[p],r=e.process,t="process"==g(r),u=function(){},y=!!function(){try{var b=s.resolve(1),c=(b.constructor={})[a("./_wks")("species")]=function(a){a(u,u)};return(t||"function"==typeof PromiseRejectionEvent)&&b.then(u)instanceof c}catch(a){}}(),z=function(a,b){return a===b||a===s&&b===x},A=function(a){var b;return!(!i(a)||"function"!=typeof(b=a.then))&&b},B=function(a){return z(s,a)?new C(a):new w(a)},C=w=function(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw q("Bad Promise constructor");b=a,c=d}),this.resolve=j(b),this.reject=j(c)},D=function(a){try{a()}catch(a){return{error:a}}},E=function(a,b){if(!a._n){a._n=!0;var c=a._c;o(function(){for(var d=a._v,e=1==a._s,f=0,g=function(b){var i,j,c=e?b.ok:b.fail,f=b.resolve,g=b.reject,h=b.domain;try{c?(e||(2==a._h&&H(a),a._h=1),c===!0?i=d:(h&&h.enter(),i=c(d),h&&h.exit()),i===b.promise?g(q("Promise-chain cycle")):(j=A(i))?j.call(i,f,g):f(i)):g(d)}catch(a){g(a)}};c.length>f;)g(c[f++]);a._c=[],a._n=!1,b&&!a._h&&F(a)})}},F=function(a){n.call(e,function(){var c,d,f,b=a._v;if(G(a)&&(c=D(function(){t?r.emit("unhandledRejection",b,a):(d=e.onunhandledrejection)?d({promise:a,reason:b}):(f=e.console)&&f.error&&f.error("Unhandled promise rejection",b)}),a._h=t||G(a)?2:1),a._a=void 0,c)throw c.error})},G=function(a){if(1==a._h)return!1;for(var d,b=a._a||a._c,c=0;b.length>c;)if(d=b[c++],d.fail||!G(d.promise))return!1;return!0},H=function(a){n.call(e,function(){var b;t?r.emit("rejectionHandled",a):(b=e.onrejectionhandled)&&b({promise:a,reason:a._v})})},I=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),E(b,!0))},J=function(a){var c,b=this;if(!b._d){b._d=!0,b=b._w||b;try{if(b===a)throw q("Promise can't be resolved itself");(c=A(a))?o(function(){var d={_w:b,_d:!1};try{c.call(a,f(J,d,1),f(I,d,1))}catch(a){I.call(d,a)}}):(b._v=a,b._s=1,E(b,!1))}catch(a){I.call({_w:b,_d:!1},a)}}};y||(s=function(b){k(this,s,p,"_h"),j(b),v.call(this);try{b(f(J,this,1),f(I,this,1))}catch(a){I.call(this,a)}},v=function(b){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},v.prototype=a("./_redefine-all")(s.prototype,{then:function(b,c){var d=B(m(this,s));return d.ok="function"!=typeof b||b,d.fail="function"==typeof c&&c,d.domain=t?r.domain:void 0,this._c.push(d),this._a&&this._a.push(d),this._s&&E(this,!1),d.promise},catch:function(a){return this.then(void 0,a)}}),C=function(){var a=new v;this.promise=a,this.resolve=f(J,a,1),this.reject=f(I,a,1)}),h(h.G+h.W+h.F*!y,{Promise:s}),a("./_set-to-string-tag")(s,p),a("./_set-species")(p),x=a("./_core")[p],h(h.S+h.F*!y,p,{reject:function(b){var c=B(this),d=c.reject;return d(b),c.promise}}),h(h.S+h.F*(d||!y),p,{resolve:function(b){if(b instanceof s&&z(b.constructor,this))return b;var c=B(this),d=c.resolve;return d(b),c.promise}}),h(h.S+h.F*!(y&&a("./_iter-detect")(function(a){s.all(a).catch(u)})),p,{all:function(b){var c=this,d=B(c),e=d.resolve,f=d.reject,g=D(function(){var a=[],d=0,g=1;l(b,!1,function(b){var h=d++,i=!1;a.push(void 0),g++,c.resolve(b).then(function(b){i||(i=!0,a[h]=b,--g||e(a))},f)}),--g||e(a)});return g&&f(g.error),d.promise},race:function(b){var c=this,d=B(c),e=d.reject,f=D(function(){l(b,!1,function(a){c.resolve(a).then(d.resolve,e)})});return f&&e(f.error),d.promise}})},{"./_a-function":60,"./_an-instance":62,"./_classof":70,"./_core":75,"./_ctx":77,"./_export":83,"./_for-of":85,"./_global":86,"./_is-object":96,"./_iter-detect":100,"./_library":104,"./_microtask":106,"./_redefine-all":121,"./_set-species":124,"./_set-to-string-tag":125,"./_species-constructor":128,"./_task":130,"./_wks":140}],158:[function(a,b,c){var d=a("./_export"),e=a("./_object-create"),f=a("./_a-function"),g=a("./_an-object"),h=a("./_is-object"),i=a("./_fails"),j=a("./_bind"),k=(a("./_global").Reflect||{}).construct,l=i(function(){function a(){}return!(k(function(){},[],a)instanceof a)}),m=!i(function(){k(function(){})});d(d.S+d.F*(l||m),"Reflect",{construct:function(b,c){f(b),g(c);var d=arguments.length<3?b:f(arguments[2]);if(m&&!l)return k(b,c,d);if(b==d){switch(c.length){case 0:return new b;case 1:return new b(c[0]);case 2:return new b(c[0],c[1]);case 3:return new b(c[0],c[1],c[2]);case 4:return new b(c[0],c[1],c[2],c[3])}var i=[null];return i.push.apply(i,c),new(j.apply(b,i))}var n=d.prototype,o=e(h(n)?n:Object.prototype),p=Function.apply.call(b,o,c);return h(p)?p:o}})},{"./_a-function":60,"./_an-object":63,"./_bind":69,"./_export":83,"./_fails":84,"./_global":86,"./_is-object":96,"./_object-create":108}],159:[function(a,b,c){"use strict";var d=a("./_collection-strong");b.exports=a("./_collection")("Set",function(a){return function(){return a(this,arguments.length>0?arguments[0]:void 0)}},{add:function(b){return d.def(this,b=0===b?0:b,b)}},d)},{"./_collection":74,"./_collection-strong":72}],160:[function(a,b,c){"use strict";var d=a("./_string-at")(!0);a("./_iter-define")(String,"String",function(a){this._t=String(a),this._i=0},function(){var c,a=this._t,b=this._i;return b>=a.length?{value:void 0,done:!0}:(c=d(a,b),this._i+=c.length,{value:c,done:!1})})},{"./_iter-define":99,"./_string-at":129}],161:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_has"),f=a("./_descriptors"),g=a("./_export"),h=a("./_redefine"),i=a("./_meta").KEY,j=a("./_fails"),k=a("./_shared"),l=a("./_set-to-string-tag"),m=a("./_uid"),n=a("./_wks"),o=a("./_wks-ext"),p=a("./_wks-define"),q=a("./_keyof"),r=a("./_enum-keys"),s=a("./_is-array"),t=a("./_an-object"),u=a("./_to-iobject"),v=a("./_to-primitive"),w=a("./_property-desc"),x=a("./_object-create"),y=a("./_object-gopn-ext"),z=a("./_object-gopd"),A=a("./_object-dp"),B=a("./_object-keys"),C=z.f,D=A.f,E=y.f,F=d.Symbol,G=d.JSON,H=G&&G.stringify,I="prototype",J=n("_hidden"),K=n("toPrimitive"),L={}.propertyIsEnumerable,M=k("symbol-registry"),N=k("symbols"),O=k("op-symbols"),P=Object[I],Q="function"==typeof F,R=d.QObject,S=!R||!R[I]||!R[I].findChild,T=f&&j(function(){return 7!=x(D({},"a",{get:function(){return D(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=C(P,b);d&&delete P[b],D(a,b,c),d&&a!==P&&D(P,b,d)}:D,U=function(a){var b=N[a]=x(F[I]);return b._k=a,b},V=Q&&"symbol"==typeof F.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof F},W=function(b,c,d){return b===P&&W(O,c,d),t(b),c=v(c,!0),t(d),e(N,c)?(d.enumerable?(e(b,J)&&b[J][c]&&(b[J][c]=!1),d=x(d,{enumerable:w(0,!1)})):(e(b,J)||D(b,J,w(1,{})),b[J][c]=!0),T(b,c,d)):D(b,c,d)},X=function(b,c){t(b);for(var g,d=r(c=u(c)),e=0,f=d.length;f>e;)W(b,g=d[e++],c[g]);return b},Y=function(b,c){return void 0===c?x(b):X(x(b),c)},Z=function(b){var c=L.call(this,b=v(b,!0));return!(this===P&&e(N,b)&&!e(O,b))&&(!(c||!e(this,b)||!e(N,b)||e(this,J)&&this[J][b])||c)},$=function(b,c){if(b=u(b),c=v(c,!0),b!==P||!e(N,c)||e(O,c)){var d=C(b,c);return!d||!e(N,c)||e(b,J)&&b[J][c]||(d.enumerable=!0),d}},_=function(b){for(var g,c=E(u(b)),d=[],f=0;c.length>f;)e(N,g=c[f++])||g==J||g==i||d.push(g);return d},aa=function(b){for(var h,c=b===P,d=E(c?O:u(b)),f=[],g=0;d.length>g;)!e(N,h=d[g++])||c&&!e(P,h)||f.push(N[h]);return f};Q||(F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor!");var b=m(arguments.length>0?arguments[0]:void 0),c=function(a){this===P&&c.call(O,a),e(this,J)&&e(this[J],b)&&(this[J][b]=!1),T(this,b,w(1,a))};return f&&S&&T(P,b,{configurable:!0,set:c}),U(b)},h(F[I],"toString",function(){return this._k}),z.f=$,A.f=W,a("./_object-gopn").f=y.f=_,a("./_object-pie").f=Z,a("./_object-gops").f=aa,f&&!a("./_library")&&h(P,"propertyIsEnumerable",Z,!0),o.f=function(a){return U(n(a))}),g(g.G+g.W+g.F*!Q,{Symbol:F});for(var ba="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ca=0;ba.length>ca;)n(ba[ca++]);for(var ba=B(n.store),ca=0;ba.length>ca;)p(ba[ca++]);g(g.S+g.F*!Q,"Symbol",{for:function(a){return e(M,a+="")?M[a]:M[a]=F(a)},keyFor:function(b){if(V(b))return q(M,b);throw TypeError(b+" is not a symbol!")},useSetter:function(){S=!0},useSimple:function(){S=!1}}),g(g.S+g.F*!Q,"Object",{create:Y,defineProperty:W,defineProperties:X,getOwnPropertyDescriptor:$,getOwnPropertyNames:_,getOwnPropertySymbols:aa}),G&&g(g.S+g.F*(!Q||j(function(){var a=F();return"[null]"!=H([a])||"{}"!=H({a:a})||"{}"!=H(Object(a))})),"JSON",{stringify:function(b){if(void 0!==b&&!V(b)){for(var e,f,c=[b],d=1;arguments.length>d;)c.push(arguments[d++]);return e=c[1],"function"==typeof e&&(f=e),!f&&s(e)||(e=function(a,b){if(f&&(b=f.call(this,a,b)),!V(b))return b}),c[1]=e,H.apply(G,c)}}}),F[I][K]||a("./_hide")(F[I],K,F[I].valueOf),l(F,"Symbol"),l(Math,"Math",!0),l(d.JSON,"JSON",!0)},{"./_an-object":63,"./_descriptors":79,"./_enum-keys":82,"./_export":83,"./_fails":84,"./_global":86,"./_has":87,"./_hide":88,"./_is-array":94,"./_keyof":103,"./_library":104,"./_meta":105,"./_object-create":108,"./_object-dp":109,"./_object-gopd":111,"./_object-gopn":113,"./_object-gopn-ext":112,"./_object-gops":114,"./_object-keys":117,"./_object-pie":118,"./_property-desc":120,"./_redefine":122,"./_set-to-string-tag":125,"./_shared":127,"./_to-iobject":133,"./_to-primitive":136,"./_uid":137,"./_wks":140,"./_wks-define":138,"./_wks-ext":139}],162:[function(a,b,c){var d=a("./_export");d(d.P+d.R,"Map",{toJSON:a("./_collection-to-json")("Map")})},{"./_collection-to-json":73,"./_export":83}],163:[function(a,b,c){var d=a("./_export");d(d.P+d.R,"Set",{toJSON:a("./_collection-to-json")("Set")})},{"./_collection-to-json":73,"./_export":83}],164:[function(a,b,c){a("./_wks-define")("asyncIterator")},{"./_wks-define":138}],165:[function(a,b,c){a("./_wks-define")("observable")},{"./_wks-define":138}],166:[function(a,b,c){a("./es6.array.iterator");for(var d=a("./_global"),e=a("./_hide"),f=a("./_iterators"),g=a("./_wks")("toStringTag"),h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var j=h[i],k=d[j],l=k&&k.prototype;l&&!l[g]&&e(l,g,j),f[j]=f.Array}},{"./_global":86,"./_hide":88,"./_iterators":102,"./_wks":140,"./es6.array.iterator":145}],167:[function(a,b,c){b.exports=a("./lib")},{"./lib":168}],168:[function(a,b,c){function e(a){return void 0===a?0:parseInt(a,10)}var d=/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/;c.fromSeconds=function(a){if("number"!=typeof a)throw new TypeError("Argument `seconds` must be a number");var b=a%60,c=(a-b)%3600;return{hours:(a-b-c)/3600,minutes:c/60,seconds:b}},c.fromString=function(a){if("string"!=typeof a)throw new TypeError("Argument `string` must be a string");var b=a.match(d);if(null===b||void 0===b[1]&&void 0===b[2]&&void 0===b[3])throw new Error('Could not parse "'+a+'" as a duration.');return{hours:e(b[1]),minutes:e(b[2]),seconds:e(b[3])}},c.toString=function(a){"number"==typeof a&&(a=c.fromSeconds(a));var b="PT";return a.hours>0&&(b+=a.hours+"H"),a.minutes>0&&(b+=a.minutes+"M"),a.seconds>0&&(b+=a.seconds+"S"),"PT"===b&&(b+="0S"),b},c.toSeconds=function(a){var b=a;return"string"==typeof a&&(b=c.fromString(a)),3600*b.hours+60*b.minutes+b.seconds}},{}],169:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function d(){this.removeListener(a,d),c||(c=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var c=!1;return d.listener=b,this.on(a,d),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],170:[function(a,b,c){!function(){var a={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(b,c){var d="string"==typeof b.initial?{state:b.initial}:b.initial,e=b.terminal||b.final,f=c||b.target||{},g=b.events||[],h=b.callbacks||{},i={},j={},k=function(b){var c=Array.isArray(b.from)?b.from:b.from?[b.from]:[a.WILDCARD];i[b.name]=i[b.name]||{};for(var d=0;d<c.length;d++)j[c[d]]=j[c[d]]||[],j[c[d]].push(b.name),i[b.name][c[d]]=b.to||c[d];b.to&&(j[b.to]=j[b.to]||[])};d&&(d.event=d.event||"startup",k({name:d.event,from:"none",to:d.state}));for(var l=0;l<g.length;l++)k(g[l]);for(var m in i)i.hasOwnProperty(m)&&(f[m]=a.buildEvent(m,i[m]));for(var m in h)h.hasOwnProperty(m)&&(f[m]=h[m]);return f.current="none",f.is=function(a){return Array.isArray(a)?a.indexOf(this.current)>=0:this.current===a},f.can=function(b){return!this.transition&&void 0!==i[b]&&(i[b].hasOwnProperty(this.current)||i[b].hasOwnProperty(a.WILDCARD))},f.cannot=function(a){return!this.can(a)},f.transitions=function(){return(j[this.current]||[]).concat(j[a.WILDCARD]||[])},f.isFinished=function(){return this.is(e)},f.error=b.error||function(a,b,c,d,e,f,g){throw g||f},f.states=function(){return Object.keys(j).sort()},d&&!d.defer&&f[d.event](),f},doCallback:function(b,c,d,e,f,g){if(c)try{return c.apply(b,[d,e,f].concat(g))}catch(c){return b.error(d,e,f,g,a.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",c)}},beforeAnyEvent:function(b,c,d,e,f){return a.doCallback(b,b.onbeforeevent,c,d,e,f)},afterAnyEvent:function(b,c,d,e,f){return a.doCallback(b,b.onafterevent||b.onevent,c,d,e,f)},leaveAnyState:function(b,c,d,e,f){return a.doCallback(b,b.onleavestate,c,d,e,f)},enterAnyState:function(b,c,d,e,f){return a.doCallback(b,b.onenterstate||b.onstate,c,d,e,f)},changeState:function(b,c,d,e,f){return a.doCallback(b,b.onchangestate,c,d,e,f)},beforeThisEvent:function(b,c,d,e,f){return a.doCallback(b,b["onbefore"+c],c,d,e,f)},afterThisEvent:function(b,c,d,e,f){return a.doCallback(b,b["onafter"+c]||b["on"+c],c,d,e,f)},leaveThisState:function(b,c,d,e,f){return a.doCallback(b,b["onleave"+d],c,d,e,f)},enterThisState:function(b,c,d,e,f){return a.doCallback(b,b["onenter"+e]||b["on"+e],c,d,e,f)},beforeEvent:function(b,c,d,e,f){if(!1===a.beforeThisEvent(b,c,d,e,f)||!1===a.beforeAnyEvent(b,c,d,e,f))return!1},afterEvent:function(b,c,d,e,f){a.afterThisEvent(b,c,d,e,f),a.afterAnyEvent(b,c,d,e,f)},leaveState:function(b,c,d,e,f){var g=a.leaveThisState(b,c,d,e,f),h=a.leaveAnyState(b,c,d,e,f);return!1!==g&&!1!==h&&(a.ASYNC===g||a.ASYNC===h?a.ASYNC:void 0)},enterState:function(b,c,d,e,f){a.enterThisState(b,c,d,e,f),a.enterAnyState(b,c,d,e,f)},buildEvent:function(b,c){return function(){var d=this.current,e=c[d]||(c[a.WILDCARD]!=a.WILDCARD?c[a.WILDCARD]:d)||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(b,d,e,f,a.Error.PENDING_TRANSITION,"event "+b+" inappropriate because previous transition did not complete");if(this.cannot(b))return this.error(b,d,e,f,a.Error.INVALID_TRANSITION,"event "+b+" inappropriate in current state "+this.current);if(!1===a.beforeEvent(this,b,d,e,f))return a.Result.CANCELLED;if(d===e)return a.afterEvent(this,b,d,e,f),a.Result.NOTRANSITION;var g=this;this.transition=function(){return g.transition=null,g.current=e,a.enterState(g,b,d,e,f),a.changeState(g,b,d,e,f),a.afterEvent(g,b,d,e,f),a.Result.SUCCEEDED},this.transition.cancel=function(){g.transition=null,a.afterEvent(g,b,d,e,f)};var h=a.leaveState(this,b,d,e,f);return!1===h?(this.transition=null,a.Result.CANCELLED):a.ASYNC===h?a.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=a),c.StateMachine=a):"function"==typeof define&&define.amd?define(function(b){return a}):"undefined"!=typeof window?window.StateMachine=a:"undefined"!=typeof self&&(self.StateMachine=a)}()},{}],171:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=l(d),f=a("babel-runtime/core-js/symbol/iterator"),g=l(f),h=a("babel-runtime/helpers/classCallCheck"),i=l(h),j=a("babel-runtime/helpers/createClass"),k=l(j),m=function(){function a(b,c){(0,i.default)(this,a),this.balanceFactor=0,this.key=b,this.value=c,this.parent=null,this.left=null,this.right=null}return(0,k.default)(a,[{key:"update",value:function(b){this.value=b}},{key:"replace",value:function(b,c){b&&(this.left===c?this.left=c:this.right===c&&(this.right=c))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),a}(),n=function(){function a(b,c){(0,i.default)(this,a),this.isLessThan=b||function(a,b){return a<b},this.isEqual=c||function(a,b){return a===b},this.root=null,this.count=null}return(0,k.default)(a,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(b,c){var d=this.getNode(b);d?d.update(c):this.insert(b,c)}},{key:"insert",value:function(b,c){var d=new m(b,c);if(this.count++,!this.root)return void(this.root=d);for(var e=this.root;;)if(this.isLessThan(b,e.key)){if(!e.left){e.left=d;break}e=e.left}else{if(!e.right){e.right=d;break}e=e.right}for(d.parent=e,e=d;e.parent;){var f=e.parent,g=f.balanceFactor;if(e.isLeftChild?f.balanceFactor++:f.balanceFactor--,Math.abs(f.balanceFactor)<Math.abs(g))break;if(f.balanceFactor<-1||f.balanceFactor>1){this.rebalance(f);break}e=f}}},{key:"get",value:function(b){for(var c=this.root;c;){if(this.isEqual(b,c.key))return c.value;c=this.isLessThan(b,c.key)?c.left:c.right}return null}},{key:"delete",value:function(b){var c=this.getNode(b);if(!c||c.key!==b)return null;var d=c.parent,e=c.left,f=c.right;if(!!e!=!!f){var g=e||f;d||g?d&&!g?this.root=g:(d.replace(c,null),this.rebalance(d)):this.root=null}else{for(var h=c.left;h.right;)h=h.right;if(c.left===h)c.isRoot?(this.root=h,h.parent=null):(c.isLeftChild?c.parent.left=h:c.parent.right=h,h.parent=c.parent),h.right=c.right,h.right.parent=h,h.balanceFactor=c.balanceFactor,c={parent:h,isLeftChild:!0};else{var i=h.parent,j=h.left;i.right=j,j&&(j.parent=i),c.isRoot?(this.root=h,h.parent=null):(c.isLeftChild?c.parent.left=h:c.parent.right=h,h.parent=c.parent),h.right=c.right,h.right.parent=h,h.left=c.left,h.left.parent=h,h.balanceFactor=c.balanceFactor,c={parent:i,isLeftChild:!1}}}for(this.count--;c.parent;){var k=c.parent,l=k.balanceFactor;if(c.isLeftChild?k.balanceFactor-=1:k.balanceFactor+=1,Math.abs(k.balanceFactor)>Math.abs(l)){if(!(k.balanceFactor<-1||k.balanceFactor>1))break;if(this.rebalance(k),0!==k.parent.balanceFactor)break;c=k.parent}else c=k}return null}},{key:"getNode",value:function(b){for(var c=this.root;c;){if(this.isEqual(b,c.key))return c;c=this.isLessThan(b,c.key)?c.left:c.right}return null}},{key:"rebalance",value:function(b){b.balanceFactor<0?b.right.balanceFactor>0?(this.rotateRight(b.right),this.rotateLeft(b)):this.rotateLeft(b):b.balanceFactor>0&&(b.left.balanceFactor<0?(this.rotateLeft(b.left),this.rotateRight(b)):this.rotateRight(b))}},{key:"rotateLeft",value:function(b){var c=b.right;b.right=c.left,null!==c.left&&(c.left.parent=b),c.parent=b.parent,null===c.parent?this.root=c:b.isLeftChild?c.parent.left=c:c.parent.right=c,c.left=b,b.parent=c,b.balanceFactor=b.balanceFactor+1-Math.min(c.balanceFactor,0),c.balanceFactor=c.balanceFactor+1-Math.max(b.balanceFactor,0)}},{key:"rotateRight",value:function(b){var c=b.left;b.left=c.right,null!==c.right&&(c.right.parent=b),c.parent=b.parent,null===c.parent?this.root=c:b.isLeftChild?c.parent.left=c:c.parent.right=c,c.right=b,b.parent=c,b.balanceFactor=b.balanceFactor-1-Math.min(c.balanceFactor,0),c.balanceFactor=c.balanceFactor-1-Math.max(b.balanceFactor,0)}},{key:g.default,value:e.default.mark(function a(){var b,c;return e.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.root){d.next=2;break}return d.abrupt("return",null);case 2:for(b=!0,c=this.root;c.left;)c=c.left;case 5:if(!b){d.next=23;break}return d.next=8,[c.key,c.value];case 8:if(b=!1,!c.right){d.next=15;break}for(c=c.right;c.left;)c=c.left;b=!0,d.next=21;break;case 15:if(!c.parent){d.next=20;break}b=c.parent.left===c,c=c.parent,d.next=21;break;case 20:return d.abrupt("break",31);case 21:d.next=29;break;case 23:if(!c.parent){d.next=28;break}b=c.parent.left===c,c=c.parent,d.next=29;break;case 28:return d.abrupt("break",31);case 29:d.next=5;break;case 31:return d.abrupt("return",null);case 32:case"end":return d.stop()}},a,this)})},{key:"getIterator",value:e.default.mark(function a(b){var c,d;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=this.root;case 1:if(!c){e.next=7;break}if(!this.isEqual(b,c.key)){e.next=4;break}return e.abrupt("break",7);case 4:c=this.isLessThan(b,c.key)?c.left:c.right,e.next=1;break;case 7:d=!0;case 8:if(!d){e.next=26;break}return e.next=11,[c.key,c.value];case 11:if(d=!1,!c.right){e.next=18;break}for(c=c.right;c.left;)c=c.left;d=!0,e.next=24;break;case 18:if(!c.parent){e.next=23;break}d=c.parent.left===c,c=c.parent,e.next=24;break;case 23:return e.abrupt("break",34);case 24:e.next=32;break;case 26:if(!c.parent){e.next=31;break}d=c.parent.left===c,c=c.parent,e.next=32;break;case 31:return e.abrupt("break",34);case 32:e.next=8;break;case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}},a,this)})},{key:"getReverseIterator",value:e.default.mark(function a(b){var c,d;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=this.root;case 1:if(!c){e.next=7;
break}if(!this.isEqual(b,c.key)){e.next=4;break}return e.abrupt("break",7);case 4:c=this.isLessThan(b,c.key)?c.right:c.left,e.next=1;break;case 7:d=!0;case 8:if(!d){e.next=26;break}return e.next=11,[c.key,c.value];case 11:if(d=!1,!c.left){e.next=18;break}for(c=c.left;c.right;)c=c.right;d=!0,e.next=24;break;case 18:if(!c.parent){e.next=23;break}d=c.parent.right===c,c=c.parent,e.next=24;break;case 23:return e.abrupt("break",34);case 24:e.next=32;break;case 26:if(!c.parent){e.next=31;break}d=c.parent.right===c,c=c.parent,e.next=32;break;case 31:return e.abrupt("break",34);case 32:e.next=8;break;case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}},a,this)})},{key:"size",get:function(){return this.count}}]),a}();c.TreeMap=n},{"babel-runtime/core-js/symbol/iterator":19,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],172:[function(a,b,c){!function(a,c){"use strict";"function"==typeof define&&define.amd?define(c):"object"==typeof b&&b.exports?b.exports=c():a.log=c()}(this,function(){"use strict";function c(c){return typeof console!==b&&(void 0!==console[c]?d(console,c):void 0!==console.log?d(console,"log"):a)}function d(a,b){var c=a[b];if("function"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(b){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function e(a,c,d){return function(){typeof console!==b&&(f.call(this,c,d),this[a].apply(this,arguments))}}function f(b,c){for(var d=0;d<h.length;d++){var e=h[d];this[e]=d<b?a:this.methodFactory(e,b,c)}}function g(a,b,d){return c(a)||e.apply(this,arguments)}function i(a,c,d){function k(a){var b=(h[a]||"silent").toUpperCase();try{return void(window.localStorage[j]=b)}catch(a){}try{window.document.cookie=encodeURIComponent(j)+"="+b+";"}catch(a){}}function l(){var a;try{a=window.localStorage[j]}catch(a){}if(typeof a===b)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(j)+"=");d&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(a){}return void 0===e.levels[a]&&(a=void 0),a}var i,e=this,j="loglevel";a&&(j+=":"+a),e.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},e.methodFactory=d||g,e.getLevel=function(){return i},e.setLevel=function(c,d){if("string"==typeof c&&void 0!==e.levels[c.toUpperCase()]&&(c=e.levels[c.toUpperCase()]),!("number"==typeof c&&c>=0&&c<=e.levels.SILENT))throw"log.setLevel() called with invalid level: "+c;if(i=c,d!==!1&&k(c),f.call(e,c,a),typeof console===b&&c<e.levels.SILENT)return"No console available for logging"},e.setDefaultLevel=function(a){l()||e.setLevel(a,!1)},e.enableAll=function(a){e.setLevel(e.levels.TRACE,a)},e.disableAll=function(a){e.setLevel(e.levels.SILENT,a)};var m=l();null==m&&(m=null==c?"WARN":c),e.setLevel(m,!1)}var a=function(){},b="undefined",h=["trace","debug","info","warn","error"],j=new i,k={};j.getLogger=function(b){if("string"!=typeof b||""===b)throw new TypeError("You must supply a name when creating a logger.");var c=k[b];return c||(c=k[b]=new i(b,j.getLevel(),j.methodFactory)),c};var l=typeof window!==b?window.log:void 0;return j.noConflict=function(){return typeof window!==b&&window.log===j&&(window.log=l),j},j})},{}],173:[function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},e=a("events"),f=function(a){function b(b){var c=a.call(this)||this;return c.minDelay=b.min,c.maxDelay=b.max,c.initialDelay=b.initial||0,c.maxAttemptsCount=b.maxAttemptsCount||0,c.maxAttemptsTime=b.maxAttemptsTime||0,c.inProgress=!1,c.attemptNum=0,c.prevDelay=0,c.currDelay=0,c}return d(b,a),b.prototype.attempt=function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt")},b.prototype.nextDelay=function(){if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var a=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=a,a},b.prototype.scheduleAttempt=function(){var a=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var b=this.nextDelay();this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+b&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return a.attempt()},b)},b.prototype.cleanup=function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0},b.prototype.start=function(){var a=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(function(b,c){a.resolve=b,a.reject=c,a.startTimestamp=Date.now(),a.scheduleAttempt()})},b.prototype.cancel=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))},b.prototype.succeeded=function(a){this.emit("succeeded",a),this.resolve(a)},b.prototype.failed=function(a){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt()},b.prototype.run=function(a){var b=this;return this.on("attempt",function(){a().then(function(a){return b.succeeded(a)}).catch(function(a){return b.failed(a)})}),this.start()},b}(e.EventEmitter);Object.defineProperty(c,"__esModule",{value:!0}),c.default=f},{events:169}],174:[function(a,b,c){(function(a){(function(){"use strict";function p(a){return a=String(a),a.charAt(0).toUpperCase()+a.slice(1)}function q(a,b,c){var d={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return b&&c&&/^Win/i.test(a)&&!/^Windows Phone /i.test(a)&&(d=d[/[\d.]+$/.exec(a)])&&(a="Windows "+d),a=String(a),b&&c&&(a=a.replace(RegExp(b,"i"),c)),a=s(a.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function r(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d&&d>-1&&d<=j)for(;++c<d;)b(a[c],c,a);else t(a,b)}function s(a){return a=y(a),/^(?:webOS|i(?:OS|P))/.test(a)?a:p(a)}function t(a,b){for(var c in a)n.call(a,c)&&b(a[c],c,a)}function u(a){return null==a?p(a):o.call(a).slice(8,-1)}function v(a,b){var c=null!=a?typeof a[b]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(c)||"object"==c&&!a[b])}function w(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function x(a,b){var c=null;return r(a,function(d,e){c=b(c,d,e,a)}),c}function y(a){return String(a).replace(/^ +| +$/g,"")}function z(a){function T(b){return x(b,function(b,c){return b||RegExp("\\b"+(c.pattern||w(c))+"\\b","i").exec(a)&&(c.label||c)})}function U(b){return x(b,function(b,c,d){return b||(c[Q]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Q)]||RegExp("\\b"+w(d)+"(?:\\b|\\w*\\d)","i").exec(a))&&d})}function V(b){return x(b,function(b,c){return b||RegExp("\\b"+(c.pattern||w(c))+"\\b","i").exec(a)&&(c.label||c)})}function W(b){return x(b,function(b,c){var d=c.pattern||w(c);return!b&&(b=RegExp("\\b"+d+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(b=q(b,d,c.label||c)),b})}function X(b){return x(b,function(b,c){var d=c.pattern||w(c);return!b&&(b=RegExp("\\b"+d+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+d+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((b=String(c.label&&!RegExp(d,"i").test(c.label)?c.label:b).split("/"))[1]&&!/[\d.]+/.test(b[0])&&(b[0]+=" "+b[1]),c=c.label||c,b=s(b[0].replace(RegExp(d,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),b})}function Y(b){return x(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}function Z(){return this.description||""}var b=e,c=a&&"object"==typeof a&&"String"!=u(a);c&&(b=a,a=null);var d=b.navigator||{},g=d.userAgent||"";a||(a=g);var H,N,h=c||l==f,i=c?!!d.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(o.toString()),j="Object",m=c?j:"ScriptBridgingProxyObject",n=c?j:"Environment",p=c&&b.java?"JavaPackage":u(b.java),r=c?j:"RuntimeObject",A=/\bJava/.test(p)&&b.java,B=A&&u(b.environment)==n,C=A?"a":"α",D=A?"b":"β",E=b.document||{},F=b.operamini||b.opera,G=k.test(G=c&&F?F["[[Class]]"]:u(F))?G:F=null,I=a,J=[],K=null,L=a==g,M=L&&F&&"function"==typeof F.version&&F.version(),O=T([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),P=V(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Q=X([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),R=U({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),S=W(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(O&&(O=[O]),R&&!Q&&(Q=X([R])),(H=/\bGoogle TV\b/.exec(Q))&&(Q=H[0]),/\bSimulator\b/i.test(a)&&(Q=(Q?Q+" ":"")+"Simulator"),"Opera Mini"==P&&/\bOPiOS\b/.test(a)&&J.push("running in Turbo/Uncompressed mode"),"IE"==P&&/\blike iPhone OS\b/.test(a)?(H=z(a.replace(/like iPhone OS/,"")),R=H.manufacturer,Q=H.product):/^iP/.test(Q)?(P||(P="Safari"),S="iOS"+((H=/ OS ([\d_]+)/i.exec(a))?" "+H[1].replace(/_/g,"."):"")):"Konqueror"!=P||/buntu/i.test(S)?R&&"Google"!=R&&(/Chrome/.test(P)&&!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(Q))||/\bAndroid\b/.test(S)&&/^Chrome/.test(P)&&/\bVersion\//i.test(a)?(P="Android Browser",S=/\bAndroid\b/.test(S)?S:"Android"):"Silk"==P?(/\bMobi/i.test(a)||(S="Android",J.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&J.unshift("accelerated")):"PaleMoon"==P&&(H=/\bFirefox\/([\d.]+)\b/.exec(a))?J.push("identifying as Firefox "+H[1]):"Firefox"==P&&(H=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(S||(S="Firefox OS"),Q||(Q=H[1])):P&&!(H=!/\bMinefield\b/i.test(a)&&/\b(?:Firefox|Safari)\b/.exec(P))||(P&&!Q&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(H+"/")+8))&&(P=null),(H=Q||R||S)&&(Q||R||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(S))&&(P=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(S)?S:H)+" Browser")):S="Kubuntu",M||(M=Y(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",w(P),"(?:Firefox|Minefield|NetFront)"])),(H="iCab"==O&&parseFloat(M)>3&&"WebKit"||/\bOpera\b/.test(P)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(O)&&"WebKit"||!O&&/\bMSIE\b/i.test(a)&&("Mac OS"==S?"Tasman":"Trident")||"WebKit"==O&&/\bPlayStation\b(?! Vita\b)/i.test(P)&&"NetFront")&&(O=[H]),"IE"==P&&(H=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(P+=" Mobile",S="Windows Phone "+(/\+$/.test(H)?H:H+".x"),J.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(P="IE Mobile",S="Windows Phone 8.x",J.unshift("desktop mode"),M||(M=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=P&&"Trident"==O&&(H=/\brv:([\d.]+)/.exec(a))&&(P&&J.push("identifying as "+P+(M?" "+M:"")),P="IE",M=H[1]),L){if(v(b,"global"))if(A&&(H=A.lang.System,I=H.getProperty("os.arch"),S=S||H.getProperty("os.name")+" "+H.getProperty("os.version")),h&&v(b,"system")&&(H=[b.system])[0]){S||(S=H[0].os||null);try{H[1]=b.require("ringo/engine").version,M=H[1].join("."),P="RingoJS"}catch(a){H[0].global.system==b.system&&(P="Narwhal")}}else"object"==typeof b.process&&!b.process.browser&&(H=b.process)?(P="Node.js",I=H.arch,S=H.platform,M=/[\d.]+/.exec(H.version)[0]):B&&(P="Rhino");else u(H=b.runtime)==m?(P="Adobe AIR",S=H.flash.system.Capabilities.os):u(H=b.phantom)==r?(P="PhantomJS",M=(H=H.version||null)&&H.major+"."+H.minor+"."+H.patch):"number"==typeof E.documentMode&&(H=/\bTrident\/(\d+)/i.exec(a))&&(M=[M,E.documentMode],(H=+H[1]+4)!=M[1]&&(J.push("IE "+M[1]+" mode"),O&&(O[1]=""),M[1]=H),M="IE"==P?String(M[1].toFixed(1)):M[0]);S=S&&s(S)}M&&(H=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(M)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(L&&d.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(K=/b/i.test(H)?"beta":"alpha",M=M.replace(RegExp(H+"\\+?$"),"")+("beta"==K?D:C)+(/\d+\+?/.exec(H)||"")),"Fennec"==P||"Firefox"==P&&/\b(?:Android|Firefox OS)\b/.test(S)?P="Firefox Mobile":"Maxthon"==P&&M?M=M.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(Q)?(S=null,"Xbox 360"==Q&&/\bIEMobile\b/.test(a)&&J.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(P)&&(!P||Q||/Browser|Mobi/.test(P))||"Windows CE"!=S&&!/Mobi/i.test(a)?"IE"==P&&L&&null===b.external?J.unshift("platform preview"):(/\bBlackBerry\b/.test(Q)||/\bBB10\b/.test(a))&&(H=(RegExp(Q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||M)?(H=[H,/BB10/.test(a)],S=(H[1]?(Q=null,R="BlackBerry"):"Device Software")+" "+H[0],M=null):this!=t&&"Wii"!=Q&&(L&&F||/Opera/.test(P)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==P&&/\bOS X (?:\d+\.){2,}/.test(S)||"IE"==P&&(S&&!/^Win/.test(S)&&M>5.5||/\bWindows XP\b/.test(S)&&M>8||8==M&&!/\bTrident\b/.test(a)))&&!k.test(H=z.call(t,a.replace(k,"")+";"))&&H.name&&(H="ing as "+H.name+((H=H.version)?" "+H:""),k.test(P)?(/\bIE\b/.test(H)&&"Mac OS"==S&&(S=null),H="identify"+H):(H="mask"+H,P=G?s(G.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(H)&&(S=null),L||(M=null)),O=["Presto"],J.push(H)):P+=" Mobile",(H=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(H=[parseFloat(H.replace(/\.(\d)$/,".0$1")),H],"Safari"==P&&"+"==H[1].slice(-1)?(P="WebKit Nightly",K="alpha",M=H[1].slice(0,-1)):M!=H[1]&&M!=(H[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1])||(M=null),H[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1],537.36==H[0]&&537.36==H[2]&&parseFloat(H[1])>=28&&"WebKit"==O&&(O=["Blink"]),L&&(i||H[1])?(O&&(O[1]="like Chrome"),H=H[1]||(H=H[0],H<530?1:H<532?2:H<532.05?3:H<533?4:H<534.03?5:H<534.07?6:H<534.1?7:H<534.13?8:H<534.16?9:H<534.24?10:H<534.3?11:H<535.01?12:H<535.02?"13+":H<535.07?15:H<535.11?16:H<535.19?17:H<536.05?18:H<536.1?19:H<537.01?20:H<537.11?"21+":H<537.13?23:H<537.18?24:H<537.24?25:H<537.36?26:"Blink"!=O?"27":"28")):(O&&(O[1]="like Safari"),H=H[0],H=H<400?1:H<500?2:H<526?3:H<533?4:H<534?"4+":H<535?5:H<537?6:H<538?7:H<601?8:"8"),O&&(O[1]+=" "+(H+="number"==typeof H?".x":/[.+]/.test(H)?"":"+")),"Safari"==P&&(!M||parseInt(M)>45)&&(M=H)),"Opera"==P&&(H=/\bzbov|zvav$/.exec(S))?(P+=" ",J.unshift("desktop mode"),"zvav"==H?(P+="Mini",M=null):P+="Mobile",S=S.replace(RegExp(" *"+H+"$"),"")):"Safari"==P&&/\bChrome\b/.exec(O&&O[1])&&(J.unshift("desktop mode"),P="Chrome Mobile",M=null,/\bOS X\b/.test(S)?(R="Apple",S="iOS 4.3+"):S=null),M&&0==M.indexOf(H=/[\d.]+$/.exec(S))&&a.indexOf("/"+H+"-")>-1&&(S=y(S.replace(H,""))),O&&!/\b(?:Avant|Nook)\b/.test(P)&&(/Browser|Lunascape|Maxthon/.test(P)||"Safari"!=P&&/^iOS/.test(S)&&/\bSafari\b/.test(O[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(P)&&O[1])&&(H=O[O.length-1])&&J.push(H),J.length&&(J=["("+J.join("; ")+")"]),R&&Q&&Q.indexOf(R)<0&&J.push("on "+R),Q&&J.push((/^on /.test(J[J.length-1])?"":"on ")+Q),S&&(H=/ ([\d.+]+)$/.exec(S),N=H&&"/"==S.charAt(S.length-H[0].length-1),S={architecture:32,family:H&&!N?S.replace(H[0],""):S,version:H?H[1]:null,toString:function(){var a=this.version;return this.family+(a&&!N?" "+a:"")+(64==this.architecture?" 64-bit":"")}}),(H=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(I))&&!/\bi686\b/i.test(I)?(S&&(S.architecture=64,S.family=S.family.replace(RegExp(" *"+H),"")),P&&(/\bWOW64\b/i.test(a)||L&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(a))&&J.unshift("32-bit")):S&&/^OS X/.test(S.family)&&"Chrome"==P&&parseFloat(M)>=39&&(S.architecture=64),a||(a=null);var $={};return $.description=a,$.layout=O&&O[0],$.manufacturer=R,$.name=P,$.prerelease=K,$.product=Q,$.ua=a,$.version=P&&M,$.os=S||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=z,$.toString=Z,$.version&&J.unshift(M),$.name&&J.unshift(P),S&&P&&(S!=String(S).split(" ")[0]||S!=P.split(" ")[0]&&!Q)&&J.push(Q?"("+S+")":"on "+S),J.length&&($.description=J.join(" ")),$}var d={function:!0,object:!0},e=d[typeof window]&&window||this,f=e,g=d[typeof c]&&c,h=d[typeof b]&&b&&!b.nodeType&&b,i=g&&h&&"object"==typeof a&&a;!i||i.global!==i&&i.window!==i&&i.self!==i||(e=i);var j=Math.pow(2,53)-1,k=/\bOpera/,l=this,m=Object.prototype,n=m.hasOwnProperty,o=m.toString,A=z();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e.platform=A,define(function(){return A})):g&&h?t(A,function(a,b){g[b]=a}):e.platform=A}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],175:[function(a,b,c){b.exports=a("./lib/checks")},{"./lib/checks":176}],176:[function(a,b,c){function f(a,b,c,e){c=c||"";var f=d.format.apply(this,[c].concat(e)),g=new a(f);throw Error.captureStackTrace(g,b),g}function g(a,b,c){f(e.IllegalArgumentError,a,b,c)}function h(a,b,c){f(e.IllegalStateError,a,b,c)}function i(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array"}return b}function j(a){return function(b,c){var d=i(b);return d==a?b:void g(arguments.callee,c||'Expected "'+a+'" but got "'+d+'".',Array.prototype.slice.call(arguments,2))}}var d=a("util"),e=b.exports=a("./errors");b.exports.checkArgument=function(a,b){a||g(arguments.callee,b,Array.prototype.slice.call(arguments,2))},b.exports.checkState=function(a,b){a||h(arguments.callee,b,Array.prototype.slice.call(arguments,2))},b.exports.checkIsDef=function(a,b){return void 0!==a?a:void g(arguments.callee,b||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},b.exports.checkIsDefAndNotNull=function(a,b){return null!=a?a:void g(arguments.callee,b||'Expected value to be defined and not null but got "'+i(a)+'".',Array.prototype.slice.call(arguments,2))},b.exports.checkIsString=j("string"),b.exports.checkIsArray=j("array"),b.exports.checkIsNumber=j("number"),b.exports.checkIsBoolean=j("boolean"),b.exports.checkIsFunction=j("function"),b.exports.checkIsObject=j("object")},{"./errors":177,util:223}],177:[function(a,b,c){function e(a){Error.call(this,a),this.message=a}function f(a){Error.call(this,a),this.message=a}var d=a("util");d.inherits(e,Error),e.prototype.name="IllegalArgumentError",d.inherits(f,Error),f.prototype.name="IllegalStateError",b.exports.IllegalStateError=f,b.exports.IllegalArgumentError=e},{util:223}],178:[function(a,b,c){function g(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function i(a){if(e===setTimeout)return setTimeout(a,0);if((e===g||!e)&&setTimeout)return e=setTimeout,setTimeout(a,0);try{return e(a,0)}catch(b){try{return e.call(null,a,0)}catch(b){return e.call(this,a,0)}}}function j(a){if(f===clearTimeout)return clearTimeout(a);if((f===h||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(a);try{return f(a)}catch(b){try{return f.call(null,a)}catch(b){return f.call(this,a)}}}function o(){l&&m&&(l=!1,m.length?k=m.concat(k):n=-1,k.length&&p())}function p(){if(!l){var a=i(o);l=!0;for(var b=k.length;b;){for(m=k,k=[];++n<b;)m&&m[n].run();n=-1,b=k.length}m=null,l=!1,j(a)}}function q(a,b){this.fun=a,this.array=b}function r(){}var e,f,d=b.exports={};!function(){try{e="function"==typeof setTimeout?setTimeout:g}catch(a){e=g}try{f="function"==typeof clearTimeout?clearTimeout:h}catch(a){f=h}}();var m,k=[],l=!1,n=-1;d.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];k.push(new q(a,b)),1!==k.length||l||i(p)},q.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=r,d.addListener=r,d.once=r,d.off=r,d.removeListener=r,d.removeAllListeners=r,d.emit=r,d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],179:[function(a,b,c){(function(c){var d="object"==typeof c?c:"object"==typeof window?window:"object"==typeof self?self:this,e=d.regeneratorRuntime&&Object.getOwnPropertyNames(d).indexOf("regeneratorRuntime")>=0,f=e&&d.regeneratorRuntime;if(d.regeneratorRuntime=void 0,b.exports=a("./runtime"),e)d.regeneratorRuntime=f;else try{delete d.regeneratorRuntime}catch(a){d.regeneratorRuntime=void 0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./runtime":180}],180:[function(a,b,c){(function(a,c){!function(c){"use strict";function l(a,b,c,d){var e=b&&b.prototype instanceof s?b:s,f=Object.create(e.prototype),g=new F(d||[]);return f._invoke=B(a,c,g),f}function m(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}function s(){}function t(){}function u(){}function z(a){["next","throw","return"].forEach(function(b){a[b]=function(a){return this._invoke(b,a)}})}function A(b){function c(a,d,f,g){var h=m(b[a],b,d);if("throw"!==h.type){var i=h.arg,j=i.value;return j&&"object"==typeof j&&e.call(j,"__await")?Promise.resolve(j.__await).then(function(a){c("next",a,f,g)},function(a){c("throw",a,f,g)}):Promise.resolve(j).then(function(a){i.value=a,f(i)},g)}g(h.arg)}function f(a,b){function e(){return new Promise(function(d,e){c(a,b,d,e)})}return d=d?d.then(e,e):e()}"object"==typeof a&&a.domain&&(c=a.domain.bind(c));var d;this._invoke=f}function B(a,b,c){var d=n;return function(f,g){if(d===p)throw new Error("Generator is already running");if(d===q){if("throw"===f)throw g;return H()}for(c.method=f,c.arg=g;;){var h=c.delegate;if(h){var i=C(h,c);if(i){if(i===r)continue;return i}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(d===n)throw d=q,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);d=p;var j=m(a,b,c);if("normal"===j.type){if(d=c.done?q:o,j.arg===r)continue;return{value:j.arg,done:c.done}}"throw"===j.type&&(d=q,c.method="throw",c.arg=j.arg)}}}function C(a,b){var c=a.iterator[b.method];if(c===f){if(b.delegate=null,"throw"===b.method){if(a.iterator.return&&(b.method="return",b.arg=f,C(a,b),"throw"===b.method))return r;b.method="throw",b.arg=new TypeError("The iterator does not provide a 'throw' method")}return r}var d=m(c,a.iterator,b.arg);if("throw"===d.type)return b.method="throw",b.arg=d.arg,b.delegate=null,r;var e=d.arg;return e?e.done?(b[a.resultName]=e.value,b.next=a.nextLoc,"return"!==b.method&&(b.method="next",b.arg=f),b.delegate=null,r):e:(b.method="throw",b.arg=new TypeError("iterator result is not an object"),b.delegate=null,r)}function D(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function E(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function F(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(D,this),this.reset(!0)}function G(a){if(a){var b=a[h];if(b)return b.call(a);if("function"==typeof a.next)return a;if(!isNaN(a.length)){var c=-1,d=function b(){for(;++c<a.length;)if(e.call(a,c))return b.value=a[c],b.done=!1,b;return b.value=f,b.done=!0,b};return d.next=d}}return{next:H}}function H(){return{value:f,done:!0}}var f,d=Object.prototype,e=d.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},h=g.iterator||"@@iterator",i=g.toStringTag||"@@toStringTag",j="object"==typeof b,k=c.regeneratorRuntime;if(k)return void(j&&(b.exports=k));k=c.regeneratorRuntime=j?b.exports:{},k.wrap=l;var n="suspendedStart",o="suspendedYield",p="executing",q="completed",r={},v={};v[h]=function(){return this};var w=Object.getPrototypeOf,x=w&&w(w(G([])));x&&x!==d&&e.call(x,h)&&(v=x);var y=u.prototype=s.prototype=Object.create(v);t.prototype=y.constructor=u,u.constructor=t,u[i]=t.displayName="GeneratorFunction",k.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===t||"GeneratorFunction"===(b.displayName||b.name))},k.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,u):(a.__proto__=u,i in a||(a[i]="GeneratorFunction")),a.prototype=Object.create(y),a},k.awrap=function(a){return{__await:a}},z(A.prototype),k.AsyncIterator=A,k.async=function(a,b,c,d){var e=new A(l(a,b,c,d));return k.isGeneratorFunction(b)?e:e.next().then(function(a){return a.done?a.value:e.next()})},z(y),y[i]="Generator",y.toString=function(){return"[object Generator]"},k.keys=function(a){var b=[];for(var c in a)b.push(c);return b.reverse(),function c(){for(;b.length;){var d=b.pop();if(d in a)return c.value=d,c.done=!1,c}return c.done=!0,c}},k.values=G,F.prototype={constructor:F,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(E),!a)for(var b in this)"t"===b.charAt(0)&&e.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=f)},stop:function(){this.done=!0;var a=this.tryEntries[0],b=a.completion;if("throw"===b.type)throw b.arg;return this.rval},dispatchException:function(a){function c(c,d){return h.type="throw",h.arg=a,b.next=c,d&&(b.method="next",b.arg=f),!!d}if(this.done)throw a;for(var b=this,d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d],h=g.completion;if("root"===g.tryLoc)return c("end");if(g.tryLoc<=this.prev){var i=e.call(g,"catchLoc"),j=e.call(g,"finallyLoc");if(i&&j){if(this.prev<g.catchLoc)return c(g.catchLoc,!0);if(this.prev<g.finallyLoc)return c(g.finallyLoc)}else if(i){if(this.prev<g.catchLoc)return c(g.catchLoc,!0)}else{if(!j)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return c(g.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&e.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var f=d;break}}f&&("break"===a||"continue"===a)&&f.tryLoc<=b&&b<=f.finallyLoc&&(f=null);var g=f?f.completion:{};return g.type=a,g.arg=b,f?(this.method="next",this.next=f.finallyLoc,r):this.complete(g)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),r},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),E(c),r}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;E(c)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(a,b,c){return this.delegate={iterator:G(a),resultName:b,nextLoc:c},"next"===this.method&&(this.arg=f),r}}}("object"==typeof c?c:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:178}],181:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.rfc6902=a()}}(function(){return function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){"use strict";function g(a){var b=a.op;return"remove"===b||"replace"===b||"copy"===b||"move"===b}function h(a,b){var c={};for(var d in a)c[d]=1;for(var e in b)delete c[e];return Object.keys(c)}function i(a){var b={};a.forEach(function(a){for(var c in a)b[c]=(b[c]||0)+1});var c=a.length;for(var d in b)b[d]<c&&delete b[d];return Object.keys(b)}function j(a){return void 0===a?"undefined":null===a?"null":Array.isArray(a)?"array":typeof a}function k(a){return"add"===a.op}function l(a){return"remove"===a.op}function n(a,b,c){function h(c,d){var e=g[c+","+d];if(void 0===e){if(f(a[c-1],b[d-1]))e=h(c-1,d-1);else{var i=[];if(c>0){var j=h(c-1,d);i.push({operations:j.operations.concat({op:"remove",index:c-1}),cost:j.cost+1})}if(d>0){var k=h(c,d-1);i.push({operations:k.operations.concat({op:"add",index:c-1,value:b[d-1]}),cost:k.cost+1})}if(c>0&&d>0){var l=h(c-1,d-1);i.push({operations:l.operations.concat({op:"replace",index:c-1,original:a[c-1],value:b[d-1]}),cost:l.cost+1})}var m=i.sort(function(a,b){return a.cost-b.cost})[0];e=m}g[c+","+d]=e}return e}var g={"0,0":{operations:[],cost:0}},i=isNaN(a.length)||a.length<=0?0:a.length,j=isNaN(b.length)||b.length<=0?0:b.length,m=h(i,j).operations,n=m.reduce(function(a,b){var f=d(a,2),g=f[0],h=f[1];if(k(b)){var j=b.index+1+h,m=j<i+h?String(j):"-",n={op:b.op,path:c.add(m).toString(),value:b.value};return[g.concat(n),h+1]}if(l(b)){var n={op:b.op,path:c.add(String(b.index+h)).toString()};return[g.concat(n),h-1]}var o=c.add(String(b.index+h)),p=q(b.original,b.value,o);return[g.concat.apply(g,e(p)),h]},[[],0]),o=d(n,2),p=o[0];o[1];return p}function o(a,b,c){var d=[];return h(a,b).forEach(function(a){d.push({op:"remove",path:c.add(a).toString()})}),h(b,a).forEach(function(a){d.push({op:"add",path:c.add(a).toString(),value:b[a]})}),i([a,b]).forEach(function(f){d.push.apply(d,e(q(a[f],b[f],c.add(f))))}),d}function p(a,b,c){return f(a,b)?[]:[{op:"replace",path:c.toString(),value:b}]}function q(a,b,c){var d=j(a),e=j(b);return"array"==d&&"array"==e?n(a,b,c):"object"==d&&"object"==e?o(a,b,c):p(a,b,c)}var d=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var e,c=[],d=a[Symbol.iterator]();!(e=d.next()).done&&(c.push(e.value),
!b||c.length!==b););return c}throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)};c.isDestructive=g,c.subtract=h,c.intersection=i,c.objectType=j,c.diffArrays=n,c.diffObjects=o,c.diffValues=p,c.diffAny=q,Object.defineProperty(c,"__esModule",{value:!0});var f=a("./equal").compare},{"./equal":2}],2:[function(a,b,c){"use strict";function d(a,b){for(var c=[],d=0,e=a.length;d<e;d++)c.push([a[d],b[d]]);return c}function e(a,b){return a.length===b.length&&d(a,b).every(function(a){return g(a[0],a[1])})}function f(a,b){var c=Object.keys(a),d=Object.keys(b);return!!e(c,d)&&c.every(function(c){return g(a[c],b[c])})}function g(a,b){return a===b||(Array.isArray(a)&&Array.isArray(b)?e(a,b):Object(a)===a&&Object(b)===b&&f(a,b))}c.compare=g,Object.defineProperty(c,"__esModule",{value:!0})},{}],3:[function(a,b,c){"use strict";var d=function a(b,c,d){var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e&&e.writable)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(c,"__esModule",{value:!0});c.MissingError=function(a){function b(a){f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"Value required at path: "+a),this.path=a,this.name=this.constructor.name}return e(b,a),b}(Error),c.InvalidOperationError=function(a){function b(a){f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"Invalid operation: "+a),this.op=a,this.name=this.constructor.name}return e(b,a),b}(Error),c.TestError=function(a){function b(a,c){f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"Test failed: "+a+" != "+c),this.actual=a,this.expected=c,this.name=this.constructor.name,this.actual=a,this.expected=c}return e(b,a),b}(Error)},{}],4:[function(a,b,c){"use strict";function k(a,b){return b.map(function(b){var c=g[b.op];return void 0===c?new e(b.op):c(a,b)})}function l(a,b){var c=new f;return i(a,b,c)}function m(a,b){var c=f.fromJSON(b).evaluate(a);if(void 0!==c)return{op:"test",path:b,value:c.value}}function n(a,b){var c=new Array;return b.filter(j).forEach(function(b){var d=m(a,b.path);if(d&&c.push(d),"from"in b){var e=m(a,b.from);e&&c.push(e)}}),c}var d=function(a){return a&&a.__esModule?a:{default:a}};c.applyPatch=k,c.createPatch=l,c.createTests=n,Object.defineProperty(c,"__esModule",{value:!0});var e=a("./errors").InvalidOperationError,f=a("./pointer").Pointer,g=d(a("./patch")),h=a("./diff"),i=h.diffAny,j=h.isDestructive},{"./diff":1,"./errors":3,"./patch":5,"./pointer":6}],5:[function(a,b,c){"use strict";function i(a,b,c){Array.isArray(a)?"-"==b?a.push(c):a.splice(b,0,c):a[b]=c}function j(a,b){Array.isArray(a)?a.splice(b,1):delete a[b]}function k(a,b){var c=d.fromJSON(b.path).evaluate(a);return void 0===c.parent?new g(b.path):(i(c.parent,c.key,b.value),null)}function l(a,b){var c=d.fromJSON(b.path).evaluate(a);return void 0===c.value?new g(b.path):(j(c.parent,c.key),null)}function m(a,b){var c=d.fromJSON(b.path).evaluate(a);return void 0===c.value?new g(b.path):(c.parent[c.key]=b.value,null)}function n(a,b){var c=d.fromJSON(b.from).evaluate(a);if(void 0===c.value)return new g(b.from);var e=d.fromJSON(b.path).evaluate(a);return void 0===e.parent?new g(b.path):(j(c.parent,c.key),i(e.parent,e.key,c.value),null)}function o(a,b){var c=d.fromJSON(b.from).evaluate(a);if(void 0===c.value)return new g(b.from);var e=d.fromJSON(b.path).evaluate(a);return void 0===e.parent?new g(b.path):(j(c.parent,c.key),i(e.parent,e.key,c.value),null)}function p(a,b){var c=d.fromJSON(b.path).evaluate(a),f=e(c.value,b.value);return f?null:new h(c.value,b.value)}c.add=k,c.remove=l,c.replace=m,c.move=n,c.copy=o,c.test=p,Object.defineProperty(c,"__esModule",{value:!0});var d=a("./pointer").Pointer,e=a("./equal").compare,f=a("./errors"),g=f.MissingError,h=f.TestError},{"./equal":2,"./errors":3,"./pointer":6}],6:[function(a,b,c){"use strict";function f(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function g(a){return a.replace(/~/g,"~0").replace(/\//g,"~1")}var d=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(c,"__esModule",{value:!0});c.Pointer=function(){function a(){var b=void 0===arguments[0]?[""]:arguments[0];e(this,a),this.tokens=b}return d(a,{toString:{value:function(){return this.tokens.map(g).join("/")}},evaluate:{value:function(b){for(var c=null,d=null,e=1,f=this.tokens.length;e<f;e++)c=b,d=this.tokens[e],b=(c||{})[d];return{parent:c,key:d,value:b}}},push:{value:function(b){this.tokens.push(b)}},add:{value:function(c){var d=this.tokens.concat(String(c));return new a(d)}}},{fromJSON:{value:function(c){var d=c.split("/").map(f);if(""!==d[0])throw new Error("Invalid JSON Pointer: "+c);return new a(d)}}}),a}()},{}]},{},[4])(4)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],182:[function(a,b,c){"use strict";function r(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=r(d),f=a("babel-runtime/core-js/object/get-prototype-of"),g=r(f),h=a("babel-runtime/helpers/createClass"),i=r(h),j=a("babel-runtime/helpers/possibleConstructorReturn"),k=r(j),l=a("babel-runtime/helpers/inherits"),m=r(l),n=a("babel-runtime/helpers/classCallCheck"),o=r(n),p=a("babel-runtime/core-js/promise"),q=r(p),s=function(a,b,c,d){return new(c||(c=q.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},t=a("events"),u=a("operation-retrier"),v=a("./configuration"),w=a("./logger"),x=a("twilio-transport"),y="Twilio::RTD::EndpointId",A=function a(){(0,o.default)(this,a)},B=function(a){function b(a){(0,o.default)(this,b);var c=(0,k.default)(this,(b.__proto__||(0,g.default)(b)).call(this));return c.myInstanceNumber=b.instancesCounter++,a=a||{},a.transport=a.transport||new x.Transport(a.twilsockClient||null),c.config=new v.default(a),c.twilsock=a.twilsockClient,c.transport=a.transport,c.cachedContinuationToken=null,c}return(0,m.default)(b,a),(0,i.default)(b,[{key:"setToken",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var c;return e.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.currentFpaToken!==b&&(this.currentFpaToken=b,c=this.currentTokenRequest,this.currentTokenRequest=this.establishToken(b),this.notifyRejected(c)),d.abrupt("return",this.currentTokenRequest.promise);case 2:case"end":return d.stop()}},a,this)}))}},{key:"notifyRejected",value:function(b){b&&setTimeout(function(){return b.reject(new Error("Operation has been cancelled by next token"))},0)}},{key:"establishToken",value:function(b){var c=this,d=new A,e=new q.default(function(a,e){c.establishTokenImpl(b).then(a).catch(e),d.resolve=a,d.reject=e});return d.promise=e,d}},{key:"establishTokenImpl",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var c=this;return e.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",new u.default({min:500,max:2e3}).run(function(){return c.requestRtdToken(b)}).then(function(a){if("ok"!=a.status)throw a.exception;if(c.currentFpaToken===b){c.continuationToken=a.response.continuation_token;var d=a.response.twilio_rtd_token;return"NEW"===a.response.status.status?c.emit("tokenCreated",d):c.emit("tokenUpdated",d),c.emit("token",d),{token:a.response.twilio_rtd_token,ttl:a.response.ttl,status:a.response.status.status,reason:a.response.status.reason||null,identity:a.response.identity||null,accountSid:a.response.account_sid,serviceSids:a.response.instance_sids}}}).catch(function(a){throw w.default.error(a),a}));case 1:case"end":return d.stop()}},a,this)}))}},{key:"requestRtdToken",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var c,d,f;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c={"Content-Type":"application/json"},d={fpa_token:b,continuation_token:this.continuationToken},w.default.debug("Token request",d),e.prev=3,e.next=6,this.transport.post(this.config.url,c,d);case 6:return f=e.sent,w.default.debug("Token response:",f),e.abrupt("return",{status:"ok",token:b,response:f.body});case 11:if(e.prev=11,e.t0=e.catch(3),401!==e.t0.status&&403!==e.t0.status){e.next=15;break}return e.abrupt("return",{status:"denied",exeception:e.t0,token:null,response:null});case 15:throw e.t0;case 16:case"end":return e.stop()}},a,this,[[3,11]])}))}},{key:"shouldUsePersistentToken",get:function(){return 0===this.myInstanceNumber}},{key:"continuationToken",get:function(){if(this.cachedContinuationToken)return this.cachedContinuationToken;try{if(this.shouldUsePersistentToken&&sessionStorage)return this.cachedContinuationToken=sessionStorage.getItem(y),this.cachedContinuationToken}catch(a){w.default.warn("Can't access persistent storage",a)}return null},set:function(b){this.cachedContinuationToken=b;try{this.shouldUsePersistentToken&&sessionStorage&&sessionStorage.setItem(y,b)}catch(a){w.default.warn("Can't access persistent storage",a)}}}]),b}(t.EventEmitter);B.instancesCounter=0,c.EmsClient=B;var C=B;c.EMSClient=C,Object.defineProperty(c,"__esModule",{value:!0}),c.default=C},{"./configuration":183,"./logger":184,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169,"operation-retrier":173,"twilio-transport":214}],183:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=f(d),g="https://ems.us1.twilio.com",h="/v1/token",i=function a(b){(0,e.default)(this,a);var c=b.host||g;this.url=c+h};Object.defineProperty(c,"__esModule",{value:!0}),c.default=i},{"babel-runtime/helpers/classCallCheck":21}],184:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}function h(a,b){return[a].concat((0,e.default)(b))}var d=a("babel-runtime/core-js/array/from"),e=f(d),g=a("loglevel");Object.defineProperty(c,"__esModule",{value:!0}),c.default={setLevel:function(b){g.setLevel(b)},trace:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.trace.apply(null,h("EMS T:",c))},debug:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.debug.apply(null,h("EMS D:",c))},info:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.info.apply(null,h("EMS I:",c))},warn:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.warn.apply(null,h("EMS W:",c))},error:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.error.apply(null,h("EMS E:",c))}}},{"babel-runtime/core-js/array/from":1,loglevel:172}],185:[function(a,b,c){"use strict";function G(a){return a&&a.__esModule?a:{default:a}}function H(a,b,c){var d=new y.default(b,c,1,y.default.strategy.LEAK);return function(){var b=Array.prototype.slice.call(arguments,0);return b.unshift(a),d.schedule.apply(d,b)}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/promise"),e=G(d),f=a("babel-runtime/core-js/object/define-properties"),g=G(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=G(h),j=a("babel-runtime/helpers/classCallCheck"),k=G(j),l=a("babel-runtime/helpers/createClass"),m=G(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=G(n),p=a("babel-runtime/helpers/inherits"),q=G(p),r=a("./configuration"),s=G(r),t=a("events"),u=G(t),v=a("./logger"),w=G(v),x=a("bottleneck"),y=G(x),z=a("./registrar"),A=G(z),B=a("twilsock"),C=G(B),D=a("twilio-transport"),E=G(D),F=a("twilio-ems-client"),I=function(a){function b(a,c){(0,k.default)(this,b);var d=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this));if(!a)throw new Error("Token is required for Notifications client");c=c||{},c.logLevel=c.logLevel||"error",w.default.setLevel(c.logLevel);var e=c.minTokenRefreshInterval||1e4,f=c.productId||"notifications";c.twilsockClient=c.twilsockClient||new C.default(a,c),c.transport=c.transport||new E.default(c.twilsockClient),c.emsClient=c.emsClient||new F.EMSClient(c);var h=c.twilsockClient,j=c.transport,l={overall:!1,transport:!1,registration:!1},m=new s.default(null,c);return(0,g.default)(d,{_config:{value:m},_emsClient:{value:c.emsClient},_registrar:{value:new A.default(f,j,h,m)},_twilsock:{value:h},_reliableTransportState:{value:l},updateToken:{value:H(d._updateToken.bind(d),1,e),enumerable:!0},connectionState:{get:function(){return"disconnected"===d._twilsock.state?"disconnected":"disconnecting"===d._twilsock.state?"disconnecting":"connected"===d._twilsock.state&&d._reliableTransportState.registration?"connected":"rejected"===d._twilsock.state?"denied":"connecting"}}}),d._emsClient.setToken(a).then(function(a){return a.token}).then(function(a){d._config.updateToken(a),d._registrar.updateToken()}),d._onTransportStateChange(d._twilsock.connected),d._registrar.on("transportReady",function(a){d._onRegistrationStateChange(a?"registered":"")}),d._registrar.on("stateChanged",function(a){d._onRegistrationStateChange(a)}),d._registrar.on("needReliableTransport",d._onNeedReliableTransport.bind(d)),d._twilsock.on("message",function(a,b){return d._routeMessage(a,b)}),d._twilsock.on("connected",function(a){d._onTransportStateChange(!0),d._registrar.setNotificationId("twilsock",a)}),d._twilsock.on("disconnected",function(){d._onTransportStateChange(!1)}),d}return(0,q.default)(b,a),(0,m.default)(b,[{key:"_routeMessage",value:function(b,c){w.default.trace("Message arrived: ",b,c),this.emit("message",b,c)}},{key:"_onNeedReliableTransport",value:function(b){b?this._twilsock.connect():this._twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(b){this._reliableTransportState.registration="registered"===b,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(b){this._reliableTransportState.transport=b,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var b=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==b&&(this._reliableTransportState.overall=b,w.default.info("Transport ready "+b),this.emit("transportReady",b),this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(b,c){return c=c||"twilsock",w.default.trace("Add subscriptions for message type: ",b,c),this._registrar.subscribe(b,c)}},{key:"unsubscribe",value:function(b,c){return c=c||"twilsock",w.default.trace("Remove subscriptions for message type: ",b,c),this._registrar.unsubscribe(b,c)}},{key:"handlePushNotification",value:function(b){w.default.warn("Push message passed, but no functionality implemented yet: "+b)}},{key:"setPushRegistrationId",value:function(b,c){this._registrar.setNotificationId(c||"gcm",b)}},{key:"_updateToken",value:function(b){var c=this;return w.default.info("authTokenUpdated"),this._fpaToken===b?e.default.resolve():(this._twilsock.updateToken(b),this._emsClient.setToken(b).then(function(a){return a.token}).then(function(a){c._config.updateToken(a),c._registrar.updateToken()}))}}]),b}(u.default);c.default=I,b.exports=c.default},{"./configuration":186,"./logger":188,"./registrar":190,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,bottleneck:39,events:169,"twilio-ems-client":182,"twilio-transport":214,twilsock:217}],186:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/define-properties"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k="https://ers.twilio.com",l="/v1/registrations",m=function(){function a(b,c){var d=this;(0,g.default)(this,a),c=(c||{}).Notification||{};var f=c.ersUri||k;(0,e.default)(this,{_registrarUri:{value:f+l},_token:{value:b,writable:!0},registrarUri:{get:function(){return d._registrarUri}},token:{get:function(){return d._token}}})}return(0,i.default)(a,[{key:"updateToken",value:function(b){this._token=b}}]),a}();c.default=m,b.exports=c.default},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],187:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("./client"),e=f(d);c.default=e.default,b.exports=c.default},{"./client":185}],188:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){return[a].concat((0,e.default)(b))}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/array/from"),e=h(d),f=a("loglevel"),g=h(f);c.default={setLevel:function(b){g.default.setLevel(b)},trace:function(){g.default.trace.apply(null,i("Notify T:",arguments))},debug:function(){g.default.debug.apply(null,i("Notify D:",arguments))},info:function(){g.default.info.apply(null,i("Notify I:",arguments))},warn:function(){g.default.warn.apply(null,i("Notify W:",arguments))},error:function(){g.default.error.apply(null,i("Notify E:",arguments))}},b.exports=c.default},{"babel-runtime/core-js/array/from":1,loglevel:172}],189:[function(a,b,c){"use strict";function D(a){return a&&a.__esModule?a:{default:a}}function E(a){var b=[];return a.forEach(function(a){return b.push(a)}),b}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/freeze"),e=D(d),f=a("babel-runtime/core-js/promise"),g=D(f),h=a("babel-runtime/core-js/set"),i=D(h),j=a("babel-runtime/core-js/object/define-properties"),k=D(j),l=a("babel-runtime/core-js/object/get-prototype-of"),m=D(l),n=a("babel-runtime/helpers/classCallCheck"),o=D(n),p=a("babel-runtime/helpers/createClass"),q=D(p),r=a("babel-runtime/helpers/possibleConstructorReturn"),s=D(r),t=a("babel-runtime/helpers/inherits"),u=D(t),v=a("events"),w=D(v),x=a("./logger"),y=D(x),z=a("javascript-state-machine"),A=D(z),B=a("backoff"),C=D(B),F=function(a){function b(a,c,d,e){(0,o.default)(this,b);var f=(0,s.default)(this,(b.__proto__||(0,m.default)(b)).call(this)),g=A.default.create({initial:{state:"unregistered",event:"init",defer:!0},events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering","retrying"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"retry",from:["retrying"],to:"retrying"},{name:"failure",from:["registering"],to:"retrying"},{name:"failure",from:["retrying"],to:"retrying"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(b,c,d,e){return f._register(e)},onunregistering:function(){return f._unregister()},onregistered:function(){return f._onRegistered()},onunregistered:function(){return f._onUnregistered()},onretrying:function(b,c,d,e){return f._initRetry(e)},onfailure:function(b,c,d,e){"retrying"===c&&f._initRetry(e)}}}),h=C.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return h.on("ready",function(){f._retry()}),(0,k.default)(f,{_transport:{value:c},_context:{value:a},_url:{value:d.registrarUri,writable:!1},_config:{value:d},_fsm:{value:g},_backoff:{value:h},_channelType:{value:e},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1,writable:!0},_messageTypes:{value:new i.default,writable:!0},_pendingUpdate:{value:null,writable:!0}}),g.init(),f}return(0,u.default)(b,a),(0,q.default)(b,[{key:"setNotificationId",value:function(b){this._notificationId!==b&&(this._notificationId=b,this._updateRegistration())}},{key:"updateToken",value:function(){return this._updateRegistration()}},{key:"has",value:function(b){return this._messageTypes.has(b)}},{key:"subscribe",value:function(b){return this._messageTypes.has(b)?(y.default.debug("Message type already registered ",b),!1):(this._messageTypes.add(b),this._updateRegistration(),!0)}},{key:"unsubscribe",value:function(b){return!!this._messageTypes.has(b)&&(this._messageTypes.delete(b),this._messageTypes.size>0?this._updateRegistration():this._removeRegistration(),!0)}},{key:"_updateRegistration",value:function(){this._notificationId&&this._update(this._notificationId,E(this._messageTypes))}},{key:"_removeRegistration",value:function(){this._notificationId&&this._update(this._notificationId,E(this._messageTypes))}},{key:"_update",value:function(b,c){var d={notificationId:b,messageTypes:c};this._fsm.is("unregistered")?d.notificationId&&d.messageTypes.length>0&&this._fsm.userUpdate(d):this._fsm.is("registered")?(this._fsm.userUpdate(d),this._setPendingUpdate(d)):this._setPendingUpdate(d)}},{key:"_setPendingUpdate",value:function(b){this._pendingUpdate=b}},{key:"_checkPendingUpdate",value:function(){if(this._pendingUpdate){var b=this._pendingUpdate;this._pendingUpdate=null,this._updateRegistration(b.notificationId,b.messageTypes)}}},{key:"_initRetry",value:function(b){this._pendingUpdate||this._setPendingUpdate(b),this._backoff.backoff()}},{key:"_retry",value:function(){if(this._pendingUpdate){var b=this._pendingUpdate;this._pendingUpdate=null,this._register(b)}}},{key:"_onRegistered",value:function(){this._backoff.reset(),this.emit("stateChanged","registered"),this._checkPendingUpdate()}},{key:"_onUnregistered",value:function(){this._backoff.reset(),this.emit("stateChanged","unregistered"),this._checkPendingUpdate()}},{key:"_register",value:function(b){var c=this,d={endpoint_platform:this._context.platform,channel_type:this._channelType,version:"2",message_types:b.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?d.data.url=b.notificationId:d.data.registration_id=b.notificationId;var e=this._url+"?productId="+this._context.productId,f={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return y.default.trace("Creating registration for channel ",this._channelType),this._transport.post(e,f,d).then(function(a){c._registrationId=a.body.id,c._registrationData=b,y.default.debug("Registration created: ",a),c._fsm.registered()}).catch(function(a){return y.default.error("Registration failed: ",a),c._fsm.failure(b),a})}},{key:"_unregister",value:function(){var b=this;if(!this._registrationId)return g.default.resolve();var c=this._url+"/"+this._registrationId+"?productId="+this._context.productId,d={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return y.default.trace("Removing registration for ",this._channelType),this._transport.delete(c,d).then(function(){y.default.debug("Registration removed for ",b._channelType),b._registrationId=!1,b._fsm.unregistered()}).catch(function(a){return y.default.error("Failed to remove of registration ",b.channelType,a),b._fsm.failure(),a})}}]),b}(w.default);c.default=F,(0,e.default)(F),b.exports=c.default},{"./logger":188,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,backoff:29,events:169,"javascript-state-machine":170}],190:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/freeze"),e=z(d),f=a("babel-runtime/core-js/map"),g=z(f),h=a("babel-runtime/core-js/object/define-properties"),i=z(h),j=a("babel-runtime/core-js/object/get-prototype-of"),k=z(j),l=a("babel-runtime/helpers/classCallCheck"),m=z(l),n=a("babel-runtime/helpers/createClass"),o=z(n),p=a("babel-runtime/helpers/possibleConstructorReturn"),q=z(p),r=a("babel-runtime/helpers/inherits"),s=z(r),t=a("events"),u=z(t),v=a("./registrar.connector"),w=z(v),x=a("./twilsock.connector"),y=z(x),A=function(a){function b(a,c,d,e){(0,m.default)(this,b);var f=(0,q.default)(this,(b.__proto__||(0,k.default)(b)).call(this));(0,i.default)(f,{_conf:{value:e},_connectors:{value:new g.default}});var h=("undefined"!=typeof navigator?navigator.userAgent:"web").substring(0,128);return f._connectors.set("twilsock",new y.default({productId:a,platform:h},d,e)),f._connectors.set("gcm",new w.default({productId:a,platform:h},c,e,"gcm")),f._connectors.set("fcm",new w.default({productId:a,platform:h},c,e,"fcm")),f._connectors.set("apn",new w.default({productId:a,platform:h},c,e,"apn")),f._connectors.get("twilsock").on("transportReady",function(a){return f.emit("transportReady",a)}),f}return(0,s.default)(b,a),(0,o.default)(b,[{key:"setNotificationId",value:function(b,c){this._connector(b).setNotificationId(c)}},{key:"hasSubscription",value:function(b,c){this._connector(c).has(b)}},{key:"subscribe",value:function(b,c){this._connector(c).subscribe(b)}},{key:"unsubscribe",value:function(b,c){this._connector(c).unsubscribe(b)}},{key:"updateToken",value:function(){this._connectors.forEach(function(a){return a.updateToken()})}},{key:"_connector",value:function(b){var c=this._connectors.get(b);if(!c)throw new Error("Unknown channel type: "+b);return c}}]),b}(u.default);c.default=A,(0,e.default)(A),b.exports=c.default},{"./registrar.connector":189,"./twilsock.connector":191,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],191:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{default:a}}function B(a){var b=[];return a.forEach(function(a){return b.push(a)}),b}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/freeze"),e=z(d),f=a("babel-runtime/core-js/set"),g=z(f),h=a("babel-runtime/core-js/object/define-properties"),i=z(h),j=a("babel-runtime/core-js/object/get-prototype-of"),k=z(j),l=a("babel-runtime/helpers/classCallCheck"),m=z(l),n=a("babel-runtime/helpers/createClass"),o=z(n),p=a("babel-runtime/helpers/possibleConstructorReturn"),q=z(p),r=a("babel-runtime/helpers/inherits"),s=z(r),t=a("uuid"),u=z(t),v=a("./logger"),w=z(v),x=a("events"),y=z(x),A=172800,C=function(a){function b(a,c,d){(0,m.default)(this,b);var e=(0,q.default)(this,(b.__proto__||(0,k.default)(b)).call(this));return a.id=u.default.v4(),(0,i.default)(e,{_twilsock:{value:c},_messageTypes:{value:new g.default},config:{value:d},context:{value:a}}),c.on("stateChanged",function(a){"connected"!==a&&e.emit("transportReady",!1)}),c.on("registered",function(b){a&&b===a.id&&"connected"===c.state&&e.emit("transportReady",!0)}),e}return(0,s.default)(b,a),(0,o.default)(b,[{key:"setNotificationId",value:function(){return!1}},{key:"updateToken",value:function(){this._twilsock.removeNotificationsContext(this.context.id),this.context.id=u.default.v4(),this._updateContext()}},{key:"has",value:function(b){return this._messageTypes.has(b)}},{key:"subscribe",value:function(b){return this._messageTypes.has(b)?(w.default.trace("Message type already registered ",b),!1):(this._messageTypes.add(b),this._updateContext(),!0)}},{key:"unsubscribe",value:function(b){return!!this._messageTypes.has(b)&&(this._messageTypes.delete(b),this._messageTypes.size>0?this._updateContext():this._twilsock.removeNotificationsContext(this.context.id),!0)}},{key:"_updateContext",value:function(){if(this.config.token){var b=B(this._messageTypes),c={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,ttl:A,token:this.config.token,message_types:b};this.emit("transportReady",!1),this._twilsock.setNotificationsContext(this.context.id,c)}}}]),b}(y.default);c.default=C,(0,e.default)(C),b.exports=c.default},{"./logger":188,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,uuid:224}],192:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=h(d),f=a("babel-runtime/helpers/createClass"),g=h(f),i=a("karibu"),j=function(){function a(b,c){(0,e.default)(this,a),this.value=b,this.revision=c}return(0,g.default)(a,[{key:"isValid",get:function(){return!0}}]),a}(),k=function(){function a(b){(0,e.default)(this,a),this.revision=b}return(0,g.default)(a,[{key:"isValid",get:function(){return!1}}]),a}(),l=function(){function a(){(0,e.default)(this,a),this.items=new i.TreeMap}return(0,g.default)(a,[{key:"store",value:function(b,c,d){var e=this.items.get(b);return e&&e.revision>d?e.isValid?e.value:null:(this.items.set(b,new j(c,d)),c)}},{key:"delete",value:function(b,c){var d=this.items.get(b);(!d||d.revision<c)&&this.items.set(b,new k(c))}},{key:"isKnown",value:function(b,c){var d=this.items.get(b);return d&&d.revision>=c}},{key:"get",value:function(b){var c=this.items.get(b);return c&&c.isValid?c.value:null}},{key:"has",value:function(b){var c=this.items.get(b);return c&&c.isValid}}]),a}();c.Cache=l,Object.defineProperty(c,"__esModule",{value:!0}),c.default=l},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,karibu:171}],193:[function(a,b,c){"use strict";function r(a){return a&&a.__esModule?a:{default:a}}function M(a){return a._subscribe(),a}function N(a,b,c,d){return{unique_name:a,purpose:b,context:c,data:d}}function O(a){return a?"string"==typeof a?{id:a,purpose:null,data:null,context:null,mode:null}:{id:a.uniqueName||a.sid||a.id,purpose:a.purpose,data:a.data,context:a.context,mode:a.mode}:{id:null,purpose:null,data:null,context:null,mode:null}}var d=a("babel-runtime/regenerator"),e=r(d),f=a("babel-runtime/core-js/object/get-prototype-of"),g=r(f),h=a("babel-runtime/helpers/classCallCheck"),i=r(h),j=a("babel-runtime/helpers/createClass"),k=r(j),l=a("babel-runtime/helpers/possibleConstructorReturn"),m=r(l),n=a("babel-runtime/helpers/inherits"),o=r(n),p=a("babel-runtime/core-js/promise"),q=r(p),s=function(a,b,c,d){return new(c||(c=q.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},t=a("events"),u=a("twilsock"),v=a("twilio-transport"),w=a("twilio-ems-client"),x=a("twilio-notifications"),y=a("./utils"),z=a("./logger"),A=a("./configuration"),B=a("./subscriptions"),C=a("./router"),D=a("./network"),E=a("./syncdocument"),F=a("./synclist"),G=a("./syncmap"),H=a("./clientInfo"),I=a("./entitiesCache"),J=a("./syncerror"),K="data_sync",L=a("../package.json").version,P=function(a){
function b(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.default)(this,b);var d=(0,m.default)(this,(b.__proto__||(0,g.default)(b)).call(this));if(!a)throw new Error("Sync library needs a valid Twilio token to be passed");c.hasOwnProperty("logLevel")&&z.default.setLevel(c.logLevel);var e=c.productId=c.productId||K,f=c.twilsockClient=c.twilsockClient||new u(a,c),h=c.transport=c.transport||new v.Transport(c.twilsockClient),j=c.emsClient=c.emsClient||new w.EmsClient(c),k=c.notificationsClient=c.notificationsClient||new x(a,c),l=new A.Configuration(null,c),n=new D.Network(e,new H.ClientInfo(L),l,h);d.fpaToken=a,j.setToken(a).then(function(a){return d.services.config.updateToken(a.token)}),f.connect(),d.services={config:l,twilsock:f,notifications:k,network:n,emsClient:j,router:null,subscriptions:null};var o=new B.Subscriptions(d.services),p=new C.Router({config:l,subscriptions:o,notifications:k});return d.services.router=p,d.services.subscriptions=o,d.entities=new I.EntitiesCache,k.on("connectionStateChanged",function(){d.emit("connectionStateChanged",d.services.notifications.connectionState)}),d}return(0,o.default)(b,a),(0,k.default)(b,[{key:"ensureReady",value:function(){var b=this;return this.services.config.token?q.default.resolve(this.services.config.token):new q.default(function(a,c){b.services.emsClient.once("token",function(b){setTimeout(function(){return a(b)},0)})})}},{key:"_get",value:function(b,c){return s(this,void 0,void 0,e.default.mark(function a(){var d,f,g;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=2;break}return e.abrupt("return",null);case 2:return d=new y.UriBuilder(b).arg("Deep",!0).arg("Id",c).build(),e.next=5,this.services.network.get(d);case 5:return f=e.sent,g=f.body.documents||f.body.lists||f.body.maps||[],e.abrupt("return",0===g.length?null:g[0]);case 8:case"end":return e.stop()}},a,this)}))}},{key:"_createDocument",value:function(b,c,d){var e=N(b,c,null,d);return this.services.network.post(this.services.config.documentsUri,e).then(function(a){return a.body})}},{key:"_getDocument",value:function(b){return this._get(this.services.config.documentsUri,b)}},{key:"_createList",value:function(b,c,d){var e=N(b,c,d);return this.services.network.post(this.services.config.listsUri,e).then(function(a){return a.body})}},{key:"_getList",value:function(b){return this._get(this.services.config.listsUri,b)}},{key:"_createMap",value:function(b,c,d){var e=N(b,c,d);return this.services.network.post(this.services.config.mapsUri,e).then(function(a){return a.body})}},{key:"_getMap",value:function(b){return this._get(this.services.config.mapsUri,b)}},{key:"getCached",value:function(b,c){return this.entities.get(b,c)||null}},{key:"removeFromCache",value:function(b){this.entities.remove(b)}},{key:"document",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var d,f,g,h,i,c=this;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return d=O(b),f=d.id,g=d.purpose,h=d.data,i=d.mode,e.abrupt("return",this.getCached(f,"document")||this._getDocument(f).then(function(a){if(a)return a;if("open"!==i)return c._createDocument(f,g,h);throw new J.default("Not found",404)}).then(function(a){return new E.SyncDocument(c.services,a,function(a){return c.removeFromCache(a)})}).then(function(a){return c.entities.store(a)}).then(M));case 4:case"end":return e.stop()}},a,this)}))}},{key:"map",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var d,f,g,h,i,c=this;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return d=O(b),f=d.id,g=d.purpose,h=d.context,i=d.mode,e.abrupt("return",this.getCached(f,"map")||this._getMap(f).then(function(a){if(a)return a;if("open"!==i)return c._createMap(f,g,h);throw new J.default("Not found",404)}).then(function(a){return new G.SyncMap(c.services,a,function(a){return c.removeFromCache(a)})}).then(function(a){return c.entities.store(a)}).then(M));case 4:case"end":return e.stop()}},a,this)}))}},{key:"list",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var d,f,g,h,i,c=this;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return d=O(b),f=d.id,g=d.purpose,h=d.context,i=d.mode,e.abrupt("return",this.getCached(f,"list")||this._getList(f).then(function(a){if(a)return a;if("open"!==i)return c._createList(f,g,h);throw new J.default("Not found",404)}).then(function(a){return new F.SyncList(c.services,a,function(a){return c.removeFromCache(a)})}).then(function(a){return c.entities.store(a)}).then(M));case 4:case"end":return e.stop()}},a,this)}))}},{key:"shutdown",value:function(){return s(this,void 0,void 0,e.default.mark(function a(){return e.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.services.subscriptions.shutdown();case 2:return b.next=4,this.services.twilsock.disconnect();case 4:case"end":return b.stop()}},a,this)}))}},{key:"updateToken",value:function(b){return s(this,void 0,void 0,e.default.mark(function a(){var c;return e.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.emsClient.setToken(b);case 2:return c=d.sent,this.services.config.updateToken(c.token),d.next=6,q.default.all([this.services.notifications.updateToken(b),this.services.twilsock.updateToken(b)]);case 6:this.fpaToken=b;case 7:case"end":return d.stop()}},a,this)}))}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return L}}]),b}(t.EventEmitter);c.SyncClient=P,c.Client=P,Object.defineProperty(c,"__esModule",{value:!0}),c.default=P},{"../package.json":212,"./clientInfo":194,"./configuration":195,"./entitiesCache":196,"./logger":200,"./network":202,"./router":205,"./subscriptions":206,"./syncdocument":207,"./syncerror":208,"./synclist":209,"./syncmap":210,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169,"twilio-ems-client":182,"twilio-notifications":187,"twilio-transport":214,twilsock:217}],194:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=f(d),g=a("platform"),h=function a(b){(0,e.default)(this,a),this.sdk="js",this.sdkVer=b,this.os=g.os.family,this.osVer=g.os.version,this.pl=g.name,this.plVer=g.version};c.ClientInfo=h,Object.defineProperty(c,"__esModule",{value:!0}),c.default=h},{"babel-runtime/helpers/classCallCheck":21,platform:174}],195:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=h(d),f=a("babel-runtime/helpers/createClass"),g=h(f),i="https://cds.twilio.com",j="/v4/Subscriptions",k="/v3/Maps",l="/v3/Lists",m="/v3/Documents",n=function(){function a(b,c){(0,e.default)(this,a),c=(c||{}).DataSync||{};var d=c.cdsUri||i;this._token=b,this.settings={subscriptionsUri:d+j,documentsUri:d+m,listsUri:d+l,mapsUri:d+k}}return(0,g.default)(a,[{key:"updateToken",value:function(b){this._token=b}},{key:"token",get:function(){return this._token}},{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}}]),a}();c.Configuration=n},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],196:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/map"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k=function(){function a(){(0,g.default)(this,a),this.names=new e.default,this.entities=new e.default}return(0,i.default)(a,[{key:"store",value:function(b){var c=this.entities.get(b.sid);return c?c:(this.entities.set(b.sid,b),b.uniqueName&&this.names.set(b.type+"::"+b.uniqueName,b.sid),b)}},{key:"getResolved",value:function(b,c){var d=this.names.get(c+"::"+b);return d?this.entities.get(d):null}},{key:"get",value:function(b,c){return this.entities.get(b)||this.getResolved(b,c)||null}},{key:"remove",value:function(b){var c=this.entities.get(b);c&&(this.entities.delete(b),c.uniqueName&&this.names.delete(c.type+"::"+c.uniqueName))}}]),a}();c.EntitiesCache=k},{"babel-runtime/core-js/map":5,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],197:[function(a,b,c){"use strict";function n(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/get-prototype-of"),e=n(d),f=a("babel-runtime/helpers/classCallCheck"),g=n(f),h=a("babel-runtime/helpers/createClass"),i=n(h),j=a("babel-runtime/helpers/possibleConstructorReturn"),k=n(j),l=a("babel-runtime/helpers/inherits"),m=n(l),o=a("events"),p=function(a){function b(a){(0,g.default)(this,b);var c=(0,k.default)(this,(b.__proto__||(0,e.default)(b)).call(this));return c.services=a,c}return(0,m.default)(b,a),(0,i.default)(b,[{key:"reportFailure",value:function(b){404===b.status?this.onRemoved(!1):this.emit("failure",b)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"close",value:function(){this._unsubscribe()}}]),b}(o.EventEmitter);c.SyncEntity=p,Object.defineProperty(c,"__esModule",{value:!0}),c.default=p},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],198:[function(a,b,c){"use strict";var d=a("./client");c.SyncClient=d.SyncClient,Object.defineProperty(c,"__esModule",{value:!0}),c.default=d.SyncClient},{"./client":193}],199:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=h(d),f=a("babel-runtime/helpers/createClass"),g=h(f),i=function(){function a(b){(0,e.default)(this,a),this.data=b}return(0,g.default)(a,[{key:"update",value:function(b,c,d){return this.data.lastEventId=b,this.data.revision=c,this.data.value=d,this}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),a}();c.ListItem=i,Object.defineProperty(c,"__esModule",{value:!0}),c.default=i},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],200:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}function h(a,b){return[a].concat((0,e.default)(b))}var d=a("babel-runtime/core-js/array/from"),e=f(d),g=a("loglevel");Object.defineProperty(c,"__esModule",{value:!0}),c.default={setLevel:function(b){g.setLevel(b)},trace:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.trace.apply(null,h("Sync T:",c))},debug:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.debug.apply(null,h("Sync D:",c))},info:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.info.apply(null,h("Sync I:",c))},warn:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.warn.apply(null,h("Sync W:",c))},error:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];g.error.apply(null,h("Sync E:",c))}}},{"babel-runtime/core-js/array/from":1,loglevel:172}],201:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/classCallCheck"),e=h(d),f=a("babel-runtime/helpers/createClass"),g=h(f),i=function(){function a(b){(0,e.default)(this,a),this.data=b}return(0,g.default)(a,[{key:"update",value:function(b,c,d){return this.data.lastEventId=b,this.data.revision=c,this.data.value=d,this}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"key",get:function(){return this.data.key}},{key:"value",get:function(){return this.data.value}}]),a}();c.MapItem=i,Object.defineProperty(c,"__esModule",{value:!0}),c.default=i},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],202:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function n(a){throw 429===a.status?new m.SyncError(a.body.message,429):a}var d=a("babel-runtime/core-js/json/stringify"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k=a("uuid"),l=a("./logger"),m=a("./syncerror"),o=function(){function a(b,c,d,e){(0,g.default)(this,a),this.productId=b,this.clientInfo=c,this.config=d,this.transport=e}return(0,i.default)(a,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,e.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+k.v4().replace(/-/g,""),"X-Twilio-Product-Id":this.productId,"X-Twilio-Token":this.config.token}}},{key:"get",value:function(b){var c=this.createHeaders();return l.default.debug("GET",b,"ID:",c["Twilio-Request-Id"]),this.transport.get(b,c).catch(n)}},{key:"post",value:function(b,c,d,e){var f=this.createHeaders();return"undefined"!=typeof d&&(f["If-Match"]=d),l.default.debug("POST",b,"ID:",f["Twilio-Request-Id"]),this.transport.post(b,f,c,e).catch(n)}},{key:"put",value:function(b,c,d){var e=this.createHeaders();return"undefined"!=typeof d&&(e["If-Match"]=d),l.default.debug("PUT",b,"ID:",e["Twilio-Request-Id"]),this.transport.put(b,e,c).catch(n)}},{key:"delete",value:function(b){var c=this.createHeaders();return l.default.debug("DELETE",b,"ID:",c["Twilio-Request-Id"]),this.transport.delete(b,c).catch(n)}}]),a}();c.Network=o,Object.defineProperty(c,"__esModule",{value:!0}),c.default=o},{"./logger":200,"./syncerror":208,"babel-runtime/core-js/json/stringify":4,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,uuid:224}],203:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=l(d),f=a("babel-runtime/helpers/classCallCheck"),g=l(f),h=a("babel-runtime/helpers/createClass"),i=l(h),j=a("babel-runtime/core-js/promise"),k=l(j),m=function(a,b,c,d){return new(c||(c=k.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},n=function(){function a(b,c,d,e){(0,g.default)(this,a),this.prevToken=d,this.nextToken=e,this.items=b,this.source=c}return(0,i.default)(a,[{key:"nextPage",value:function(){return m(this,void 0,void 0,e.default.mark(function a(){return e.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.hasNextPage){b.next=2;break}throw new Error("No next page");case 2:return b.abrupt("return",this.source(this.nextToken));case 3:case"end":return b.stop()}},a,this)}))}},{key:"prevPage",value:function(){return m(this,void 0,void 0,e.default.mark(function a(){return e.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.hasPrevPage){b.next=2;break}throw new Error("No previous page");case 2:return b.abrupt("return",this.source(this.prevToken));case 3:case"end":return b.stop()}},a,this)}))}},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),a}();c.Paginator=n,Object.defineProperty(c,"__esModule",{value:!0}),c.default=n},{"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],204:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/freeze"),e=l(d),f=a("babel-runtime/core-js/promise"),g=l(f),h=a("babel-runtime/helpers/classCallCheck"),i=l(h),j=a("babel-runtime/helpers/createClass"),k=l(j),m=function(){function a(){(0,i.default)(this,a),this.queue=new Array,this.isActive=!1}return(0,k.default)(a,[{key:"wakeupQueue",value:function(){var b=this;!this.isActive&&this.queue.length>0&&(this.isActive=!0,setTimeout(function(){return b.executeTask(b.queue[0])},0))}},{key:"pickNext",value:function(){var b=this;return this.queue.shift(),0===this.queue.length?void(this.isActive=!1):void setTimeout(function(){return b.executeTask(b.queue[0])},0)}},{key:"pickSame",value:function(b){var c=this;this.queue[0].arg=b,setTimeout(function(){return c.executeTask(c.queue[0])},0)}},{key:"executeTask",value:function(b){var c=this;b.task(b.context,b.arg).then(function(a){c.pickNext(),b.resolve(a)}).catch(function(a){try{if(!b.handle)throw a;b.handle(a).then(function(a){return c.pickSame(a)}).catch(b.reject)}catch(c){b.reject(a)}})}},{key:"add",value:function(b,c,d,e){var f=this;return new g.default(function(a,g){f.queue.push({task:b,context:c,arg:d,handle:e,resolve:a,reject:g}),f.wakeupQueue()})}}]),a}();c.RetryingQueue=m,(0,e.default)(m),Object.defineProperty(c,"__esModule",{value:!0}),c.default=m},{"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],205:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=l(d),f=a("babel-runtime/helpers/classCallCheck"),g=l(f),h=a("babel-runtime/helpers/createClass"),i=l(h),j=a("babel-runtime/core-js/promise"),k=l(j),m=function(a,b,c,d){return new(c||(c=k.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},n=a("./logger"),o="com.twilio.rtd.cds.document",p="com.twilio.rtd.cds.list",q="com.twilio.rtd.cds.map",r="twilio.sync.event",s=function(){function a(b){var c=this;(0,g.default)(this,a),this.config=b.config,this.subscriptions=b.subscriptions,this.notifications=b.notifications,this.notifications.subscribe(r),this.notifications.subscribe(o),this.notifications.subscribe(p),this.notifications.subscribe(q),this.notifications.on("message",function(a,b){return c.onMessage(a,b)}),this.notifications.on("transportReady",function(a){a&&c.onConnected()})}return(0,i.default)(a,[{key:"onMessage",value:function(b,c){switch(b){case o:case p:case q:case r:n.default.trace("Notification type:",b,"content:",c),this.subscriptions.acceptMessage(c)}}},{key:"subscribe",value:function(b,c){return m(this,void 0,void 0,e.default.mark(function a(){return e.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.subscriptions.add(b,c);case 2:case"end":return d.stop()}},a,this)}))}},{key:"unsubscribe",value:function(b,c){return m(this,void 0,void 0,e.default.mark(function a(){return e.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.subscriptions.remove(b);case 2:case"end":return c.stop()}},a,this)}))}},{key:"onConnected",value:function(){this.subscriptions.poke()}}]),a}();c.Router=s,Object.defineProperty(c,"__esModule",{value:!0}),c.default=s},{"./logger":200,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],206:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=t(d),f=a("babel-runtime/helpers/slicedToArray"),g=t(f),h=a("babel-runtime/core-js/get-iterator"),i=t(h),j=a("babel-runtime/helpers/extends"),k=t(j),l=a("babel-runtime/core-js/map"),m=t(l),n=a("babel-runtime/helpers/classCallCheck"),o=t(n),p=a("babel-runtime/helpers/createClass"),q=t(p),r=a("babel-runtime/core-js/promise"),s=t(r),u=function(a,b,c,d){return new(c||(c=s.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},v=a("backoff"),w=a("./logger"),x=a("./syncerror"),y=a("twilio-transport"),z=1e3,A=function(){function a(b){(0,o.default)(this,a),this.localObject=b,this.correlationId=null}return(0,q.default)(a,[{key:"markAsFailed",value:function(b){this.pendingPokeTimer&&clearTimeout(this.pendingPokeTimer),this.rejectedWithError=b}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isInTransition",get:function(){return null!==this.correlationId}}]),a}(),B=function(){function a(b){var c=this;(0,o.default)(this,a),this.services=b,this.subscriptions=new m.default,this.persisted=new m.default;var d={randomisationFactor:.2,initialDelay:100,maxDelay:12e4};this.backoff=v.exponential((0,k.default)(d,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var a=c.getSubscriptionUpdateBatch(),b=a.action,d=a.subscriptions;b?c.applyNewSubscriptionUpdateBatch(b,d):(c.backoff.reset(),w.default.info("All subscriptions resolved."))})}return(0,q.default)(a,[{key:"getSubscriptionUpdateBatch",value:function(){function b(a,b,c,d){var e=[],f=!0,h=!1,j=void 0;try{for(var l,k=(0,i.default)(a);!(f=(l=k.next()).done);f=!0){var m=(0,g.default)(l.value,2),n=m[0],o=m[1],p=b.get(n);if(!p&&(c||!o.isInTransition)&&!o.rejectedWithError&&(e.push(o),d&&e.length>=d))break}}catch(a){h=!0,j=a}finally{try{!f&&k.return&&k.return()}finally{if(h)throw j}}return e}var c=b(this.subscriptions,this.persisted,!1,z).map(function(a){return new A(a)});if(c.length>0)return{action:"establish",subscriptions:c};var d=b(this.persisted,this.subscriptions,!0,z);return d.length>0?{action:"cancel",subscriptions:d}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(a){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(b,c){return u(this,void 0,void 0,e.default.mark(function a(){var d,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,x,z,A;return e.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(c=this.processLocalActions(b,c),d=(new Date).getTime(),f=!0,g=!1,h=void 0,e.prev=5,j=(0,i.default)(c);!(f=(k=j.next()).done);f=!0)l=k.value,this.recordActionAttemptOn(l,b,d);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),g=!0,h=e.t0;case 13:e.prev=13,e.prev=14,!f&&j.return&&j.return();case 16:if(e.prev=16,!g){e.next=19;break}throw h;case 19:return e.finish(16);case 20:return e.finish(13);case 21:return e.prev=21,e.next=24,this.request(b,d,c.map(function(a){return{object_sid:a.sid,object_type:a.type,last_event_id:"establish"===b?a.lastEventId:void 0}}));case 24:if(m=e.sent,"establish"!==b){e.next=45;break}for(n=!0,o=!1,p=void 0,e.prev=29,q=(0,i.default)(c);!(n=(r=q.next()).done);n=!0)s=r.value,s.correlationId===d&&this.beginReplayTimeout(m.body.estimated_delivery_in_ms,s,b,d);e.next=37;break;case 33:e.prev=33,e.t1=e.catch(29),o=!0,p=e.t1;case 37:e.prev=37,e.prev=38,!n&&q.return&&q.return();case 40:if(e.prev=40,!o){e.next=43;break}throw p;case 43:return e.finish(40);case 44:return e.finish(37);case 45:this.backoff.reset(),e.next=70;break;case 48:for(e.prev=48,e.t2=e.catch(21),t=!0,u=!1,v=void 0,e.prev=53,x=(0,i.default)(c);!(t=(z=x.next()).done);t=!0)A=z.value,this.recordActionFailureOn(A,b);e.next=61;break;case 57:e.prev=57,e.t3=e.catch(53),u=!0,v=e.t3;case 61:e.prev=61,e.prev=62,!t&&x.return&&x.return();case 64:if(e.prev=64,!u){e.next=67;break}throw v;case 67:return e.finish(64);case 68:return e.finish(61);case 69:e.t2 instanceof y.TwilsockUnavailableError?(w.default.debug("Twilsock connection (required for subscription) not ready (c:"+d+"); waiting…"),this.backoff.reset()):(w.default.debug("Failed an attempt to "+b+" subscriptions (c:"+d+"); retrying",e.t2),this.persist());case 70:case"end":return e.stop()}},a,this,[[5,9,13,21],[14,,16,20],[21,48],[29,33,37,45],[38,,40,44],[53,57,61,69],[62,,64,68]])}))}},{key:"processLocalActions",value:function(b,c){return"cancel"===b?c.filter(function(a){return!a.rejectedWithError}):c}},{key:"recordActionAttemptOn",value:function(b,c,d){if("establish"===c)this.persisted.set(b.sid,b),b.correlationId=d;else{var e=this.persisted.get(b.sid);e&&(e.correlationId=d)}}},{key:"recordActionFailureOn",value:function(b,c){b.correlationId=null,"establish"===c&&this.persisted.delete(b.sid)}},{key:"request",value:function(b,c,d){w.default.debug("Attempting '"+b+"' request (c:"+c+"):",d);var e={event_protocol_version:3,action:b,correlation_id:c,requests:d};return this.services.network.post(this.services.config.subscriptionsUri,e,null,!0)}},{key:"beginReplayTimeout",value:function(b,c,d,e){var f=this,g=!isNaN(parseFloat(b))&&isFinite(b),h=g&&b>0;h&&(c.pendingPokeTimer=setTimeout(function(){c.correlationId===e&&(w.default.debug("Attempt to "+d+" "+c.sid+" (c:"+e+") timed out without confirmation; trying again."),c.correlationId=null,f.persisted.delete(c.sid),f.persist())},b))}},{key:"add",value:function(b,c){w.default.debug("Establishing intent to subscribe to "+b);var d=this.subscriptions.get(b);d&&d.lastEventId===c.lastEventId||(this.persisted.delete(b),this.subscriptions.set(b,c),this.persist())}},{key:"remove",value:function(b){w.default.debug("Establishing intent to unsubscribe from "+b);var c=this.subscriptions.delete(b);c&&this.persist()}},{key:"acceptMessage",value:function(b){switch(w.default.trace("Subscriptions received",b),b.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(b.event,b.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(b.event,b.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(b.event,b.correlation_id);break;case(b.event_type.match(/^(?:map|list|document)_/)||{}).input:var c=function(){return b.event_type.match(/^map_/)?b.event.map_sid:b.event_type.match(/^list_/)?b.event.list_sid:b.event_type.match(/^document_/)?b.event.document_sid:void 0};this.applyEventToSubscribedEntity(c(),b);break;default:w.default.debug("Dropping unknown message type "+b.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(b,c){var d=b.object_sid,e=this.persisted.get(b.object_sid);e&&e.correlationId===c?"interrupted"===b.replay_status?(w.default.debug("Event Replay for subscription to "+d+" (c:"+c+") interrupted; continuing eagerly."),clearTimeout(e.pendingPokeTimer),e.pendingPokeTimer=null,e.correlationId=null,this.persisted.delete(e.sid),this.backoff.reset()):"completed"===b.replay_status&&(w.default.debug("Event Replay for subscription to "+d+" (c:"+c+") completed. Subscription is ready."),clearTimeout(e.pendingPokeTimer),e.pendingPokeTimer=null,e.correlationId=null,this.persisted.set(b.object_sid,e),this.backoff.reset()):w.default.debug("Late message for "+b.object_sid+" (c:"+c+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(b,c){var d=this.persisted.get(b.object_sid);d&&d.correlationId===c?(clearTimeout(d.pendingPokeTimer),d.pendingPokeTimer=null,d.correlationId=null,this.persisted.delete(b.object_sid)):w.default.debug("Late message for "+b.object_sid+" (c:"+c+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(b,c){var d=b.object_sid,e=this.subscriptions.get(d),f=this.persisted.get(d);e&&f?f.correlationId===c&&(f.markAsFailed(b.error),w.default.error("Failed to subscribe on "+f.sid,b.error),e.reportFailure(new x.SyncError("Failed to subscribe on service events: "+b.error.message,b.error.status))):!e&&f&&this.persisted.delete(d),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(b,c){var d=b?this.subscriptions.get(b):null;d?(c.event.type=c.event_type,d._update(c.event)):w.default.debug("Message dropped for SID '"+b+"', for which there is no subscription.")}},{key:"poke",value:function(){w.default.info("Triggering event replay for all subscriptions.");var b=[],c=!0,d=!1,e=void 0;try{for(var h,f=(0,i.default)(this.persisted);!(c=(h=f.next()).done);c=!0){var j=(0,g.default)(h.value,2),l=(j[0],j[1]);clearTimeout(l.pendingPokeTimer),l.pendingPokeTimer=null,l.correlationId=null,l.rejectedWithError&&b.push(l)}}catch(a){d=!0,e=a}finally{try{!c&&f.return&&f.return()}finally{if(d)throw e}}this.persisted.clear();var m=!0,n=!1,o=void 0;try{for(var q,p=(0,i.default)(b);!(m=(q=p.next()).done);m=!0){var l=q.value;this.persisted.set(l.sid,l)}}catch(a){n=!0,o=a}finally{try{!m&&p.return&&p.return()}finally{if(n)throw o}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),a}();c.Subscriptions=B,Object.defineProperty(c,"__esModule",{value:!0}),c.default=B},{"./logger":200,"./syncerror":208,"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/map":5,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/slicedToArray":26,"babel-runtime/regenerator":28,backoff:29,"twilio-transport":214}],207:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/extends"),e=t(d),f=a("babel-runtime/regenerator"),g=t(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=t(h),j=a("babel-runtime/helpers/classCallCheck"),k=t(j),l=a("babel-runtime/helpers/createClass"),m=t(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=t(n),p=a("babel-runtime/helpers/inherits"),q=t(p),r=a("babel-runtime/core-js/promise"),s=t(r),u=function(a,b,c,d){return new(c||(c=s.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},v=a("./logger"),w=a("./entity"),x=a("rfc6902"),y=a("./retryingqueue"),z=function(a){function b(a,c,d){(0,k.default)(this,b);var e=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this,a));return e.actionQueue=new y.RetryingQueue,e.descriptor=c,e.onRemoveDocument=d,e}return(0,q.default)(b,a),(0,m.default)(b,[{key:"_update",value:function(b){switch(b.type){case"document_updated":if(b.id>this.lastEventId){var c=this.descriptor.data;this.descriptor.last_event_id=b.id,this.descriptor.revision=b.document_revision,this.descriptor.data=b.document_data,this.traverse(c,b.document_data,!1),this.emit("updated",b.document_data,!1),this.emit("updatedRemotely",b.document_data)}break;case"document_removed":this.onRemoved(!1)}}},{key:"traverse",value:function(b,c,d){var e=this,f=x.createPatch(b,c);f.forEach(function(a){"add"===a.op?(e.emit("keyAdded",a.path,a.value,d),d||e.emit("keyAddedRemotely",a.path,a.value)):"replace"===a.op?(e.emit("keyUpdated",a.path,a.value,d),d||e.emit("keyUpdatedRemotely",a.path,a.value)):"remove"===a.op&&(e.emit("keyRemoved",a.path,d),d||e.emit("keyRemovedRemotely",a.path))})}},{key:"get",value:function(b){return this.value}},{key:"set",value:function(b,c){return this._actualSet(b,c?function(){throw new Error("Revision mismatch")}:null)}},{key:"_actualSet",value:function(b,c){var d=this,e=void 0,f={data:b,revision:c?this.revision:void 0};return c&&(e=function(e){return u(d,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(412!==e.status){d.next=4;break}return d.next=3,this.softSync();
case 3:return d.abrupt("return",{revision:this.revision,data:c(this.value,b)});case 4:throw e;case 5:case"end":return d.stop()}},a,this)}))}),this.actionQueue.add(this._set.bind(this),this.uri,f,e).then(function(a){return d.descriptor.revision=a.revision,d.descriptor.data=a.data,d.emit("updated",d.value,!0),d.value})}},{key:"mutate",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this._actualSet(b(this.value),b));case 1:case"end":return c.stop()}},a,this)}))}},{key:"update",value:function(b){return this.mutate(function(a){return(0,e.default)(a,b)})}},{key:"_set",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){var b;return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.services.network.post(this.uri,{data:c.data},c.revision);case 2:return b=d.sent,d.abrupt("return",{revision:b.body.revision,data:c.data});case 4:case"end":return d.stop()}},a,this)}))}},{key:"softSync",value:function(){var b=this;return this.services.network.get(this.uri).then(function(a){return b._update({type:"document_updated",id:a.body.last_event_id,document_revision:a.body.revision,document_data:a.body.data}),b}).catch(function(a){404===a.status?b.onRemoved(!1):v.default.error("Can't get updates for "+b.sid+":",a)})}},{key:"onRemoved",value:function(b){this._unsubscribe(),this.emit("removed",b),b||this.emit("removedRemotely")}},{key:"removeDocument",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return this.onRemoveDocument(this.sid),b.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return b.stop()}},a,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"document"}}],[{key:"type",get:function(){return"document"}}]),b}(w.SyncEntity);c.SyncDocument=z,Object.defineProperty(c,"__esModule",{value:!0}),c.default=z},{"./entity":197,"./logger":200,"./retryingqueue":204,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,rfc6902:181}],208:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/get-prototype-of"),e=l(d),f=a("babel-runtime/helpers/classCallCheck"),g=l(f),h=a("babel-runtime/helpers/possibleConstructorReturn"),i=l(h),j=a("babel-runtime/helpers/inherits"),k=l(j),m=function(a){function b(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,g.default)(this,b);var d=(0,i.default)(this,(b.__proto__||(0,e.default)(b)).call(this));return d.name=d.constructor.name,d.message=a,d.status=c,d}return(0,k.default)(b,a),b}(Error);c.SyncError=m,Object.defineProperty(c,"__esModule",{value:!0}),c.default=m},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25}],209:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/extends"),e=t(d),f=a("babel-runtime/regenerator"),g=t(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=t(h),j=a("babel-runtime/helpers/classCallCheck"),k=t(j),l=a("babel-runtime/helpers/createClass"),m=t(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=t(n),p=a("babel-runtime/helpers/inherits"),q=t(p),r=a("babel-runtime/core-js/promise"),s=t(r),u=function(a,b,c,d){return new(c||(c=s.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},v=a("./utils"),w=a("./logger"),x=a("./entity"),y=a("./retryingqueue"),z=a("./listitem"),A=a("./paginator"),B=a("./cache"),C=function(a){function b(a,c,d){(0,k.default)(this,b);var e=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this,a));return e.actionQueue=new y.RetryingQueue,e.cache=new B.Cache,e.descriptor=c,e.onRemoveList=d,e}return(0,q.default)(b,a),(0,m.default)(b,[{key:"__set",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){var d;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.post(b,{data:c.data},c.revision);case 2:return d=e.sent,d.body.data=c.data,e.abrupt("return",d.body);case 5:case"end":return e.stop()}},a,this)}))}},{key:"_set",value:function(b,c,d){return u(this,void 0,void 0,g.default.mark(function a(){var f,h,e=this;return g.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(d){g.next=5;break}return g.next=3,this.services.network.post(b.uri,{data:c});case 3:return f=g.sent,g.abrupt("return",b.update(f.body.last_event_id,f.body.revision,c));case 5:return h=function(f){if(412===f.status)return e.queryEvents().then(function(){return e.get(b.index)}).then(function(a){return{revision:a.revision,data:d(a.value,c)}});throw f},g.abrupt("return",this.actionQueue.add(this.__set.bind(this),b.uri,{revision:b.revision,data:c},h).then(function(a){return b.update(a.last_event_id,a.revision,a.data)}));case 7:case"end":return g.stop()}},a,this)}))}},{key:"push",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var c,d,e;return g.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.services.network.post(this.links.items,{data:b});case 2:return c=f.sent,d=Number(c.body.index),e=this.cache.store(d,new z.ListItem({index:d,revision:c.body.revision,lastEventId:c.body.last_event_id,uri:c.body.url,value:b}),c.body.last_event_id),this.emit("itemAdded",e,!0),f.abrupt("return",e);case 7:case"end":return f.stop()}},a,this)}))}},{key:"set",value:function(b,c){return this._actualSet(b,c)}},{key:"_actualSet",value:function(b,c,d){return u(this,void 0,void 0,g.default.mark(function a(){var e;return g.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.get(b);case 2:return e=f.sent,f.next=5,this._set(e,c,d);case 5:return e=f.sent,this.emit("itemUpdated",e,!0),f.abrupt("return",e);case 8:case"end":return f.stop()}},a,this)}))}},{key:"mutate",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){var d;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(b);case 2:return d=e.sent,e.abrupt("return",this._actualSet(b,c(d.value),c));case 4:case"end":return e.stop()}},a,this)}))}},{key:"update",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",this.mutate(b,function(a){return(0,e.default)(a,c)}));case 1:case"end":return d.stop()}},a,this)}))}},{key:"remove",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var c;return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.get(b);case 2:return c=d.sent,d.next=5,this.services.network.delete(c.uri);case 5:this.cache.delete(b,c.lastEventId),this.emit("itemRemoved",b,!0);case 7:case"end":return d.stop()}},a,this)}))}},{key:"get",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var c,d;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.cache.get(b),!c){e.next=3;break}return e.abrupt("return",c);case 3:return e.next=5,this.queryItems({index:b});case 5:if(d=e.sent,!(d.items.length<1)){e.next=8;break}throw new Error("No item with index "+b+" found");case 8:return e.abrupt("return",this.cache.store(b,d.items[0],d.items[0].lastEventId));case 9:case"end":return e.stop()}},a,this)}))}},{key:"queryEvents",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){var c,d,b=this;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=3,this.services.network.get(c);case 3:d=e.sent,d.body.events.forEach(function(a){return b._update(a)});case 5:case"end":return e.stop()}},a,this)}))}},{key:"queryItems",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var d,e,f,h,c=this;return g.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return b=b||{},d=new v.UriBuilder(this.links.items).arg("From",b.from).arg("PageSize",b.limit).arg("Index",b.index).arg("PageToken",b.pageToken).arg("Order",b.order).build(),g.next=4,this.services.network.get(d);case 4:return e=g.sent,f=e.body.items.map(function(a){return c.cache.store(Number(a.index),new z.ListItem({index:Number(a.index),uri:a.url,revision:a.revision,lastEventId:a.last_event_id,value:a.data}),a.last_event_id)}),h=e.body.meta,g.abrupt("return",new A.Paginator(f,function(a){return c.queryItems({pageToken:a})},h.previous_token,h.next_token));case 8:case"end":return g.stop()}},a,this)}))}},{key:"getItems",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return b=b||{},b.limit=b.pageSize||b.limit||50,b.order=b.order||"asc",c.abrupt("return",this.queryItems(b));case 4:case"end":return c.stop()}},a,this)}))}},{key:"getContext",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){var b;return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.context){c.next=2;break}return c.abrupt("return",this.context);case 2:return c.next=4,this.services.network.get(this.links.context);case 4:return b=c.sent,this.context=b.body.data,c.abrupt("return",this.context);case 7:case"end":return c.stop()}},a,this)}))}},{key:"updateContext",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,this.services.network.post(this.links.context,{data:b});case 3:return this.context=b,this.emit("contextUpdated",b,!0),c.abrupt("return",this);case 8:throw c.prev=8,c.t0=c.catch(0),w.default.error("Failed to update context",c.t0),c.t0;case 12:case"end":return c.stop()}},a,this,[[0,8]])}))}},{key:"removeList",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return this.onRemoveList(this.sid),b.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return b.stop()}},a,this)}))}},{key:"onRemoved",value:function(b){this._unsubscribe(),this.emit("collectionRemoved",b),b||this.emit("collectionRemovedRemotely")}},{key:"softSync",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,this.queryEvents();case 3:b.next=8;break;case 5:b.prev=5,b.t0=b.catch(0),404===b.t0.status?this.onRemoved(!1):w.default.error("Can't get updates for "+this.sid+":",b.t0);case 8:case"end":return b.stop()}},a,this,[[0,5]])}))}},{key:"shouldIgnoreEvent",value:function(b,c){return this.cache.isKnown(b,c)}},{key:"_update",value:function(b){var c=Number(b.item_index);switch(b.type){case"list_item_added":this._handleItemAdded(c,b.item_url,b.id,b.item_revision,b.item_data);break;case"list_item_updated":this._handleItemUpdated(c,b.item_url,b.id,b.item_revision,b.item_data);break;case"list_item_removed":this._handleItemRemoved(c,b.id);break;case"list_context_updated":this._handleContextUpdate(b.context_data,b.id);break;case"list_removed":this.onRemoved(!1)}this.lastEventId<b.id&&(this.descriptor.revision=b.list_revision,this.descriptor.last_event_id=b.id)}},{key:"_handleItemAdded",value:function(b,c,d,e,f){if(!this.cache.isKnown(b,d)){var g=new z.ListItem({index:b,uri:c,lastEventId:d,revision:e,value:f});this.cache.store(b,g,d),this.emit("itemAdded",g,!1),this.emit("itemAddedRemotely",g)}}},{key:"_handleItemUpdated",value:function(b,c,d,e,f){var g=this.cache.get(b);g||this.shouldIgnoreEvent(b,d)?g&&d>g.lastEventId&&(g.update(d,e,f),this.emit("itemUpdated",g,!1),this.emit("itemUpdatedRemotely",g)):(g=this.cache.store(b,new z.ListItem({index:b,uri:c,lastEventId:d,revision:e,value:f}),d),this.emit("itemUpdated",g,!1),this.emit("itemUpdatedRemotely",g))}},{key:"_handleItemRemoved",value:function(b,c){this.cache.delete(b,c),this.emit("itemRemoved",b,!1),this.emit("itemRemovedRemotely",b)}},{key:"_handleContextUpdate",value:function(b,c){this.lastEventId<c&&(this.context=b,this.emit("contextUpdated",b,!1),this.emit("contextUpdatedRemotely",b))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"list"}}],[{key:"type",get:function(){return"list"}}]),b}(x.SyncEntity);c.SyncList=C,Object.defineProperty(c,"__esModule",{value:!0}),c.default=C},{"./cache":192,"./entity":197,"./listitem":199,"./logger":200,"./paginator":203,"./retryingqueue":204,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28}],210:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/helpers/extends"),e=t(d),f=a("babel-runtime/regenerator"),g=t(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=t(h),j=a("babel-runtime/helpers/classCallCheck"),k=t(j),l=a("babel-runtime/helpers/createClass"),m=t(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=t(n),p=a("babel-runtime/helpers/inherits"),q=t(p),r=a("babel-runtime/core-js/promise"),s=t(r),u=function(a,b,c,d){return new(c||(c=s.default))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},v=a("./utils"),w=a("./logger"),x=a("./entity"),y=a("./retryingqueue"),z=a("./mapitem"),A=a("./paginator"),B=a("./cache"),C=function(a){function b(a,c,d){(0,k.default)(this,b);var e=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this,a));return e.actionQueue=new y.RetryingQueue,e.cache=new B.Cache,e.descriptor=c,e.onRemoveMap=d,e}return(0,q.default)(b,a),(0,m.default)(b,[{key:"_get",value:function(b){return this.queryItems({key:b}).then(function(a){if(a.items.length<1)throw new Error("No item with key "+b+" found");return a.items[0]})}},{key:"__set",value:function(b,c){return this.services.network.post(b,{data:c.data},c.revision).then(function(a){return a=a.body,a.data=c.data,a})}},{key:"_set",value:function(b,c,d){return u(this,void 0,void 0,g.default.mark(function a(){var f,e=this;return g.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(d){h.next=2;break}return h.abrupt("return",this.__set(b,{data:c.data}));case 2:return f=function(b){return u(e,void 0,void 0,g.default.mark(function a(){var e;return g.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(412!==b.status){f.next=7;break}return f.next=3,this.queryEvents();case 3:return f.next=5,this.get(c.key);case 5:return e=f.sent,f.abrupt("return",{revision:e.revision,data:d(e.value,c.data)});case 7:throw b;case 8:case"end":return f.stop()}},a,this)}))},h.abrupt("return",this.actionQueue.add(this.__set.bind(this),b,{revision:c.revision,data:c.data},f));case 4:case"end":return h.stop()}},a,this)}))}},{key:"_tryAddOrUpdate",value:function(b,c,d){return u(this,void 0,void 0,g.default.mark(function a(){var e,f,h,i,j;return g.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.services.network.post(b,c);case 3:return e=g.sent,e.body.data=c.data,g.abrupt("return",{added:!0,value:e.body});case 8:if(g.prev=8,g.t0=g.catch(0),409===g.t0.status){g.next=12;break}throw g.t0;case 12:if(f=g.t0.body.links.item,d){g.next=20;break}return g.next=16,this._set(f,c,d);case 16:return h=g.sent,g.abrupt("return",{added:!1,value:h});case 20:return g.next=22,this.services.network.get(f);case 22:return i=g.sent,g.next=25,this._set(f,{key:i.key,revision:i.revision,data:c},d);case 25:return j=g.sent,g.abrupt("return",{added:!1,value:j});case 27:case"end":return g.stop()}},a,this,[[0,8]])}))}},{key:"queryEvents",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){var c,d,b=this;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=this.descriptor.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=4,this.services.network.get(c);case 4:d=e.sent,d.body.events.forEach(function(a){return b._update(a)}),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),w.default.error("Failed to fetch events:",e.t0),e.t0;case 12:case 13:case"end":return e.stop()}},a,this,[[0,8]])}))}},{key:"getContext",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){var b;return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if("undefined"==typeof this.context){c.next=2;break}return c.abrupt("return",this.context);case 2:return c.next=4,this.services.network.get(this.links.context);case 4:return b=c.sent,this.context=b.body.data,c.abrupt("return",this.context);case 7:case"end":return c.stop()}},a,this)}))}},{key:"updateContext",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.services.network.post(this.links.context,{data:b});case 2:this.context=b,this.emit("contextUpdated",b,!0);case 4:case"end":return c.stop()}},a,this)}))}},{key:"set",value:function(b,c){return this._actualSet(b,c)}},{key:"_actualSet",value:function(b,c,d){return u(this,void 0,void 0,g.default.mark(function a(){var e,f,h,i,j,k,l;return g.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(e=this.cache.get(b),!e){g.next=9;break}return f={key:b,data:c,revision:e.revision||void 0},g.next=5,this._set(e.uri,f,d);case 5:return h=g.sent,e.update(h.last_event_id,h.revision,h.data),this.emit("itemUpdated",e,!0),g.abrupt("return",e);case 9:return g.next=11,this._tryAddOrUpdate(this.links.items,{key:b,data:c},d);case 11:return i=g.sent,j=i.added,k=i.value,l={key:k.key,revision:k.revision,lastEventId:k.last_event_id,uri:k.url,value:k.data},g.next=17,this.cache.get(b);case 17:return e=g.sent,e&&l.lastEventId>e.lastEventId?e.update(l.lastEventId,l.revision,l.value):e||(e=this.cache.store(b,new z.MapItem(l),l.lastEventId),j?this.emit("itemAdded",e,!0):this.emit("itemUpdated",e,!0)),g.abrupt("return",e);case 20:case"end":return g.stop()}},a,this)}))}},{key:"get",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var c;return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!this.cache.has(b)){d.next=2;break}return d.abrupt("return",this.cache.get(b));case 2:return d.next=4,this.queryItems({key:b});case 4:if(c=d.sent,!(c.items.length<1)){d.next=7;break}throw new Error("No item with key "+b+" found");case 7:return d.abrupt("return",c.items[0]);case 8:case"end":return d.stop()}},a,this)}))}},{key:"mutate",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){var d;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(b).then(function(a){return a.value}).catch(function(){return{}});case 2:return d=e.sent,e.abrupt("return",this._actualSet(b,c(d),c));case 4:case"end":return e.stop()}},a,this)}))}},{key:"update",value:function(b,c){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",this.mutate(b,function(a){return(0,e.default)(a,c)}));case 1:case"end":return d.stop()}},a,this)}))}},{key:"remove",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var c;return g.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if("undefined"!=typeof b){d.next=2;break}throw new Error("Key argument is invalid");case 2:return d.next=4,this.get(b);case 4:return c=d.sent,d.next=7,this.services.network.delete(c.uri);case 7:this.cache.delete(b,c.lastEventId),this.emit("itemRemoved",b,!0);case 9:case"end":return d.stop()}},a,this)}))}},{key:"queryItems",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){var d,e,f,h,c=this;return g.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return b=b||{},d=new v.UriBuilder(this.links.items).arg("From",b.from).arg("PageSize",b.limit).arg("Key",b.key).arg("PageToken",b.pageToken).arg("Order",b.order).build(),g.next=4,this.services.network.get(d);case 4:return e=g.sent,f=e.body.items.map(function(a){return c.cache.store(a.key,new z.MapItem({key:a.key,uri:a.url,revision:a.revision,lastEventId:a.last_event_id,value:a.data}),a.last_event_id)}),h=e.body.meta,g.abrupt("return",new A.Paginator(f,function(a){return c.queryItems({pageToken:a})},h.previous_token,h.next_token));case 8:case"end":return g.stop()}},a,this)}))}},{key:"getItems",value:function(b){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return b=b||{},b.limit=b.pageSize||b.limit||50,b.order=b.order||"asc",c.abrupt("return",this.queryItems(b));case 4:case"end":return c.stop()}},a,this)}))}},{key:"softSync",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,this.queryEvents();case 3:b.next=8;break;case 5:b.prev=5,b.t0=b.catch(0),404===b.t0.status?this.onRemoved(!1):w.default.error("Can't get updates for "+this.sid+":",b.t0);case 8:case"end":return b.stop()}},a,this,[[0,5]])}))}},{key:"forEach",value:function(b){var c=this;return new s.default(function(a,d){function e(c){c.items.forEach(function(a){return b(a)}),c.hasNextPage?c.nextPage().then(e).catch(d):a()}c.queryItems().then(e).catch(d)})}},{key:"shouldIgnoreEvent",value:function(b,c){return this.cache.isKnown(b,c)}},{key:"_update",value:function(b){switch(b.type){case"map_item_added":this._handleItemAdded(b.item_key,b.item_url,b.id,b.item_revision,b.item_data);break;case"map_item_updated":this._handleItemUpdated(b.item_key,b.item_url,b.id,b.item_revision,b.item_data);break;case"map_item_removed":this._handleItemRemoved(b.item_key,b.id);break;case"map_context_updated":this._handleContextUpdate(b.context_data,b.id);break;case"map_removed":this.onRemoved(!1)}this.lastEventId<b.id&&(this.descriptor.revision=b.map_revision,this.descriptor.last_event_id=b.id)}},{key:"_handleItemAdded",value:function(b,c,d,e,f){if(!this.cache.has(b)&&!this.shouldIgnoreEvent(b,d)){var g=new z.MapItem({key:b,uri:c,lastEventId:d,revision:e,value:f});this.cache.store(b,g,d),this.emit("itemAdded",g,!1),this.emit("itemAddedRemotely",g)}}},{key:"_handleItemUpdated",value:function(b,c,d,e,f){var g=this.cache.get(b);g||this.shouldIgnoreEvent(b,d)?g&&d>g.lastEventId&&(g.update(d,e,f),this.emit("itemUpdated",g,!1),this.emit("itemUpdatedRemotely",g)):(g=new z.MapItem({key:b,uri:c,lastEventId:d,revision:e,value:f}),this.cache.store(b,g,d),this.emit("itemUpdated",g,!1),this.emit("itemUpdatedRemotely",g))}},{key:"_handleItemRemoved",value:function(b,c){this.cache.delete(b,c),this.emit("itemRemoved",b,!1),this.emit("itemRemovedRemotely",b,!1)}},{key:"_handleContextUpdate",value:function(b,c){this.lastEventId<c&&(this.context=b,this.emit("contextUpdated",b,!1),this.emit("contextUpdatedRemotely",b))}},{key:"onRemoved",value:function(b){this._unsubscribe(),this.emit("collectionRemoved",b),b||this.emit("collectionRemovedRemotely")}},{key:"removeMap",value:function(){return u(this,void 0,void 0,g.default.mark(function a(){return g.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return this.onRemoveMap(this.sid),b.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return b.stop()}},a,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"map"}}],[{key:"type",get:function(){return"map"}}]),b}(x.SyncEntity);c.SyncMap=C,Object.defineProperty(c,"__esModule",{value:!0}),c.default=C},{"./cache":192,"./entity":197,"./logger":200,"./mapitem":201,"./paginator":203,"./retryingqueue":204,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28}],211:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function k(a){return JSON.parse((0,i.default)(a))}var d=a("babel-runtime/helpers/classCallCheck"),e=j(d),f=a("babel-runtime/helpers/createClass"),g=j(f),h=a("babel-runtime/core-js/json/stringify"),i=j(h);c.deepClone=k;var l=function(){function a(b){(0,e.default)(this,a),this.base=b,this.args=new Array,this.paths=new Array}return(0,g.default)(a,[{key:"path",value:function(b){return this.paths.push(b),this}},{key:"arg",value:function(b,c){return"undefined"!=typeof c&&this.args.push(b+"="+encodeURIComponent(c)),this}},{key:"build",value:function(){var b=this.base;return this.paths.length&&(b+="/"+this.paths.join("/")),this.args.length&&(b+="?"+this.args.join("&")),b}}]),a}();c.UriBuilder=l},{"babel-runtime/core-js/json/stringify":4,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],212:[function(a,b,c){b.exports={_args:[[{raw:"twilio-sync@^0.4.2",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.4.2",spec:">=0.4.2 <0.5.0",type:"range"},"/Users/schertkov/workspace/twilio/rtd/js/ipmessaging-js-lib"]],_from:"twilio-sync@>=0.4.2 <0.5.0",_id:"twilio-sync@0.4.2",_inCache:!0,_location:"/twilio-sync",_nodeVersion:"7.5.0",_npmOperationalInternal:{host:"packages-18-east.internal.npmjs.com",tmp:"tmp/twilio-sync-0.4.2.tgz_1487671857135_0.2178721190430224"},_npmUser:{name:"schertkov",email:"schertkov@twilio.com"},_npmVersion:"4.1.2",_phantomChildren:{},_requested:{raw:"twilio-sync@^0.4.2",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.4.2",spec:">=0.4.2 <0.5.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.4.2.tgz",_shasum:"ef4f1137fa5f1575a4f090a4469498d2fa204856",_shrinkwrap:null,_spec:"twilio-sync@^0.4.2",_where:"/Users/schertkov/workspace/twilio/rtd/js/ipmessaging-js-lib",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"babel-runtime":"^6.23.0",karibu:"^1.0.1",loglevel:"^1.4.1",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.1.5","twilio-notifications":"^0.3.0","twilio-transport":"^0.1.1",twilsock:"^0.2.2",uuid:"^3.0.1"},description:"Twilio Sync client library",devDependencies:{"@types/chai":"^3.4.34","@types/chai-as-promised":"0.0.29","@types/loglevel":"^1.4.29","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^1.16.35","@types/sinon-as-promised":"^4.0.5","@types/sinon-chai":"^2.7.27","async-test-tools":"^1.0.6","babel-cli":"^6.23.0","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0",backoff:"^2.5.0",browserify:"^14.1.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2","event-to-promise":"^0.7.0",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^3.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.4","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3",jsonwebtoken:"^7.3.0",karma:"^1.4.1","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0","ts-node":"^2.1.0",tslint:"^4.4.2",twilio:"^3.3.0-edge",typescript:"^2.1.6",underscore:"^1.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},directories:{},dist:{shasum:"ef4f1137fa5f1575a4f090a4469498d2fa204856",tarball:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.4.2.tgz"},gitHead:"894388524f3fd61ed39162b4ceae3c8100348f1d",license:"MIT",main:"lib/index.js",maintainers:[{name:"schertkov",email:"schertkov@twilio.com"},{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"}],name:"twilio-sync",optionalDependencies:{},readme:"ERROR: No README data found!",scripts:{prepublish:"gulp build",test:"gulp unit-test"},version:"0.4.2"}},{}],213:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function n(a){return a.split("\r\n").map(function(a){return a.split(": ")}).filter(function(a){return 2===a.length&&a[1].length>0}).reduce(function(a,b){return a[b[0]]=b[1],a},{})}function o(a){var b=a.getResponseHeader("Content-Type");if(!b||0!==b.indexOf("application/json")||0===a.responseText.length)return a.responseText;try{return JSON.parse(a.responseText)}catch(b){return a.responseText}}var d=a("babel-runtime/core-js/json/stringify"),e=j(d),f=a("babel-runtime/core-js/promise"),g=j(f),h=a("babel-runtime/core-js/object/define-property"),i=j(h);Object.defineProperty(c,"__esModule",{value:!0});var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,i.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m="undefined"==typeof XMLHttpRequest?a("xmlhttprequest").XMLHttpRequest:XMLHttpRequest,p=function(){function a(){l(this,a)}return k(a,null,[{key:"request",value:function(b,c){return new g.default(function(a,d){var f=new m;f.open(b,c.url,!0),f.onreadystatechange=function(){if(4===f.readyState){var c=n(f.getAllResponseHeaders()),e=o(f);200<=f.status&&f.status<300?a({status:f.status,headers:c,body:e}):d({status:f.status,description:f.statusText,headers:c,body:e})}};for(var g in c.headers)f.setRequestHeader(g,c.headers[g]),"Content-Type"===g&&"application/json"===c.headers[g]&&(c.body=(0,e.default)(c.body));f.send(c.body)})}},{key:"get",value:function(b){return this.request("GET",b)}},{key:"post",value:function(b){return this.request("POST",b)}},{key:"put",value:function(b){return this.request("PUT",b)}},{key:"delete",value:function(b){return this.request("DELETE",b)}}]),a}();c.default=p,b.exports=p,b.exports=c.default;
},{"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-property":10,"babel-runtime/core-js/promise":15,xmlhttprequest:40}],214:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{default:a}}function D(a){return a&&a.__esModule?a:{default:a}}function E(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function F(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==("undefined"==typeof b?"undefined":(0,w.default)(b))&&"function"!=typeof b?a:b}function G(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof b?"undefined":(0,w.default)(b)));a.prototype=(0,u.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(s.default?(0,s.default)(a,b):a.__proto__=b)}function H(a){function b(){var b=(0,q.default)(a,(0,o.default)(arguments));return(0,s.default)(b,(0,m.default)(this)),b}return b.prototype=(0,u.default)(a.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),s.default?(0,s.default)(b,a):b.__proto__=a,b}function I(a){var b=a.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(b){var c={protocol:b[1],host:b[2],hostname:b[3],port:b[4],pathname:b[5],search:b[6],hash:b[7]};if(c.search.length>0){var d=c.search.substring(1);c.params=d.split("&").map(function(a){return a.split("=")}).reduce(function(a,b){return a.hasOwnProperty(b[0])?Array.isArray(a[b[0]])?a[b[0]].push(b[1]):a[b[0]]=[a[b[0]],b[1]]:a[b[0]]=b[1],a},{})}return c}throw new Error("Incorrect URI: "+a)}function J(a,b){var c=I(b),d={method:a,host:c.host,path:c.pathname};return c.params&&(d.params=c.params),d}function K(a,b,c,d){return{to:J(a,b),headers:c,body:d}}function L(a){return{status:a.status,headers:a.header.http_headers,body:a.body}}function M(a,b,c){return{url:a,headers:b,body:c}}function N(a){try{a.body=JSON.parse(a.body)}catch(a){}return a}function O(a){for(var b=(0,k.default)(a.headers),c=b.length,d={};c--;){var e=b[c];d[e.toLowerCase()]=a.headers[e]}return a.headers=d,a}var d=a("babel-runtime/core-js/promise"),e=z(d),f=a("babel-runtime/core-js/map"),g=z(f),h=a("babel-runtime/core-js/object/define-properties"),i=z(h),j=a("babel-runtime/core-js/object/keys"),k=z(j),l=a("babel-runtime/core-js/object/get-prototype-of"),m=z(l),n=a("babel-runtime/core-js/array/from"),o=z(n),p=a("babel-runtime/core-js/reflect/construct"),q=z(p),r=a("babel-runtime/core-js/object/set-prototype-of"),s=z(r),t=a("babel-runtime/core-js/object/create"),u=z(t),v=a("babel-runtime/helpers/typeof"),w=z(v),x=a("babel-runtime/core-js/object/define-property"),y=z(x);Object.defineProperty(c,"__esModule",{value:!0}),c.TwilsockUnavailableError=c.Transport=void 0;var A=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,y.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),B=a("./httprequest"),C=D(B),P=function(a){function b(){return E(this,b),F(this,(b.__proto__||(0,m.default)(b)).call(this))}return G(b,a),b}(H(Error)),Q=function(){function a(b){var c=this;E(this,a),(0,i.default)(this,{_activeGetRequests:{value:new g.default},_twilsock:{value:b},_http:{value:C.default},_twilsockIsAvailable:{get:function(){return c._twilsock&&c._twilsock.isConnected}}}),b&&b.connect()}return A(a,[{key:"get",value:function(b,c,d){var e=this;if(this._activeGetRequests.has(b))return this._activeGetRequests.get(b);var f=this._get(b,c,d).then(function(a){return e._activeGetRequests.delete(b),a}).catch(function(a){throw e._activeGetRequests.delete(b),a});return this._activeGetRequests.set(b,f),f}},{key:"_oneOfBasedOnChannelAvailability",value:function(b,c){var d=this,f=function(b){var f=b.sendViaTwilsock,g=b.sendDirectHttp;return d._twilsockIsAvailable?f():c?e.default.reject(new P):g()};return f(b).then(O)}},{key:"_get",value:function(b,c,d){var e=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return e._twilsock.send(K("GET",b,c)).then(L)},sendDirectHttp:function(){return e._http.get(M(b,c)).then(N)}},d)}},{key:"post",value:function(b,c,d,e){var f=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return f._twilsock.send(K("POST",b,c,d)).then(L)},sendDirectHttp:function(){return f._http.post(M(b,c,d)).then(N)}},e)}},{key:"put",value:function(b,c,d,e){var f=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return f._twilsock.send(K("PUT",b,c,d)).then(L)},sendDirectHttp:function(){return f._http.put(M(b,c,d)).then(N)}},e)}},{key:"delete",value:function(b,c,d){var e=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return e._twilsock.send(K("DELETE",b,c)).then(L)},sendDirectHttp:function(){return e._http.delete(M(b,c)).then(N)}},d)}}]),a}();c.default=Q,c.Transport=Q,c.TwilsockUnavailableError=P},{"./httprequest":213,"babel-runtime/core-js/array/from":1,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/create":8,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/define-property":10,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/object/keys":13,"babel-runtime/core-js/object/set-prototype-of":14,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/reflect/construct":16,"babel-runtime/helpers/typeof":27}],215:[function(a,b,c){"use strict";function J(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/freeze"),e=J(d),f=a("babel-runtime/core-js/set"),g=J(f),h=a("babel-runtime/core-js/promise"),i=J(h),j=a("babel-runtime/core-js/map"),k=J(j),l=a("babel-runtime/core-js/object/define-properties"),m=J(l),n=a("babel-runtime/core-js/object/get-prototype-of"),o=J(n),p=a("babel-runtime/helpers/classCallCheck"),q=J(p),r=a("babel-runtime/helpers/createClass"),s=J(r),t=a("babel-runtime/helpers/possibleConstructorReturn"),u=J(t),v=a("babel-runtime/helpers/inherits"),w=J(v),x=a("events"),y=J(x),z=a("./logger"),A=J(z),B=a("uuid"),C=J(B),D=a("./configuration"),E=J(D),F=a("./twilsock"),G=J(F),H=a("./packetinterface"),I=J(H),K=function(a){function b(a,c){(0,q.default)(this,b);var d=(0,u.default)(this,(b.__proto__||(0,o.default)(b)).call(this));c=c||{},c.logLevel=c.logLevel||"error",A.default.setLevel(c.logLevel);var e=new E.default(a,c),f=new G.default(e),g=new I.default(f);return(0,m.default)(d,{_config:{value:e},_socket:{value:f},_packet:{value:g},_registrations:{value:new k.default},_registrationsInProgress:{value:new k.default},isConnected:{get:function(){return d._socket.isConnected}},connected:{get:function(){return d._socket.isConnected}},state:{get:function(){return d._socket.state}}}),d._socket.on("message",function(a,b){return setTimeout(function(){d.emit("message",a,b)},0)}),d._socket.on("connected",function(){return d._updateRegistrations()}),d._socket.on("connected",function(a){return d.emit("connected",a)}),d._socket.on("disconnected",function(){return d.emit("disconnected")}),d._socket.on("stateChanged",function(a){return d.emit("stateChanged",a)}),d}return(0,w.default)(b,a),(0,s.default)(b,[{key:"send",value:function(b){return this._packet.send(b.to,b.headers,b.body)}},{key:"updateToken",value:function(b){var c=this;return A.default.info("updateToken"),this._config.token===b?i.default.resolve():(this._config.updateToken(b),this._socket.disconnect().then(function(){return c._socket.connect()}),i.default.resolve())}},{key:"_updateRegistration",value:function(b,c){var d=this;A.default.info("update registration for context",b);var e=this._registrationsInProgress.get(b);e||(e=new g.default,this._registrationsInProgress.set(b,e));var f=C.default.v4();return e.add(f),this._packet.putNotificationContext(b,c).then(function(){A.default.info("registration attempt succeeded for context",c),e.delete(f),0===e.size&&(d._registrationsInProgress.delete(b),d.emit("registered",b))}).catch(function(a){A.default.info("registration attempt failed for context",c),A.default.debug(a),e.delete(f),0===e.size&&(d._registrationsInProgress.delete(b),d.emit("registrationFailed",b,a))})}},{key:"_updateRegistrations",value:function(){var b=this;A.default.info("refreshing all registrations"),this._registrations.forEach(function(a,c){b._updateRegistration(c,a)})}},{key:"setNotificationsContext",value:function(b,c){if(!b||!c)throw new Error("Invalid arguments provided");this._registrations.set(b,c),this._socket.isConnected&&this._updateRegistration(b,c)}},{key:"removeNotificationsContext",value:function(b){this._registrations.has(b)&&(this._registrations.delete(b),this._socket.isConnected&&this._packet.deleteNotificationContext(b))}},{key:"connect",value:function(){return this._socket.connect()}},{key:"disconnect",value:function(){return this._socket.disconnect()}}]),b}(y.default);c.default=K,(0,e.default)(K),b.exports=c.default},{"./configuration":216,"./logger":218,"./packetinterface":219,"./twilsock":220,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,uuid:224}],216:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/object/define-properties"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k="wss://tsock.twilio.com",l="/v2/wsconnect",m=function(){function a(b,c){var d=this;(0,g.default)(this,a),c=c||{};var f=c.Twilsock||{},h=f.uri||c.wsServer||k;(0,e.default)(this,{_twilsockWsHost:{value:h+l},_token:{value:b,writable:!0},twilsockUri:{get:function(){return d._twilsockWsHost}},token:{get:function(){return d._token}}})}return(0,i.default)(a,[{key:"updateToken",value:function(b){this._token=b}}]),a}();c.default=m,b.exports=c.default},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],217:[function(a,b,c){arguments[4][187][0].apply(c,arguments)},{"./client":215,dup:187}],218:[function(a,b,c){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){return[a].concat((0,e.default)(b))}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/array/from"),e=h(d),f=a("loglevel"),g=h(f);c.default={setLevel:function(b){g.default.setLevel(b)},trace:function(){g.default.trace.apply(null,i("Twilsock T:",arguments))},debug:function(){g.default.debug.apply(null,i("Twilsock D:",arguments))},info:function(){g.default.info.apply(null,i("Twilsock I:",arguments))},warn:function(){g.default.warn.apply(null,i("Twilsock W:",arguments))},error:function(){g.default.error.apply(null,i("Twilsock E:",arguments))}},b.exports=c.default},{"babel-runtime/core-js/array/from":1,loglevel:172}],219:[function(a,b,c){"use strict";function p(a){return a&&a.__esModule?a:{default:a}}function r(a){return a>=200&&a<300}function s(a){return a&&a.header&&a.header.http_status}Object.defineProperty(c,"__esModule",{value:!0});var d=a("babel-runtime/core-js/promise"),e=p(d),f=a("babel-runtime/core-js/map"),g=p(f),h=a("babel-runtime/core-js/object/define-properties"),i=p(h),j=a("babel-runtime/helpers/classCallCheck"),k=p(j),l=a("babel-runtime/helpers/createClass"),m=p(l),n=a("./logger"),o=p(n),q=3e4,t=function(){function a(b){var c=this;(0,k.default)(this,a),(0,i.default)(this,{_activeRequests:{value:new g.default},_socket:{value:b}}),this._socket.on("reply",this._processReply.bind(this)),this._socket.on("disconnected",function(){c._activeRequests.forEach(function(a){clearTimeout(a.timeout),a.reject(new Error("Twilsock disconnected"))}),c._activeRequests.clear()})}return(0,m.default)(a,[{key:"_processReply",value:function(b){var c=this._activeRequests.get(b.id);c&&(clearTimeout(c.timeout),this._activeRequests.delete(b.id),setTimeout(function(){r(b.status.code)?s(b)&&!r(b.header.http_status.code)?c.reject({status:b.header.http_status.code,description:b.header.http_status.status,body:b.body}):c.resolve(b):c.reject(new Error("Transport failure: "+b.status.status))},0))}},{key:"_storeRequest",value:function(b,c,d){var e={resolve:c,reject:d,timeout:setTimeout(function(){o.default.debug("request",b,"is timed out"),d(new Error("Twilsock: request timeout: "+b))},q)};this._activeRequests.set(b,e)}},{key:"send",value:function(b,c,d){var f=this;return new e.default(function(a,e){var g=f._socket.sendUpstreamMessage(b,c,d);o.default.trace("message sent: ",{id:g,address:b,headers:c,body:d}),f._storeRequest(g,a,e)})}},{key:"putNotificationContext",value:function(b,c){var d=this;return new e.default(function(a,e){var f={method:"put_notification_ctx",notification_ctx_id:b},g=d._socket.send(f,c);d._storeRequest(g,a,e)})}},{key:"deleteNotificationContext",value:function(b){var c=this;return new e.default(function(a,d){var e={method:"delete_notification_ctx",notification_ctx_id:b},f=c._socket.send(e);c._storeRequest(f,a,d)})}},{key:"shutdown",value:function(){this._activeRequests.forEach(function(a){clearTimeout(a.timeout),a.reject(new Error("Twilsock: request cancelled by user"))}),this._activeRequests.clear()}}]),a}();c.default=t,b.exports=c.default},{"./logger":218,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],220:[function(a,b,c){(function(d){"use strict";function I(a){return a&&a.__esModule?a:{default:a}}function M(a){var b=encodeURIComponent(a),c=b.replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)});return c.length}function N(a){var b=encodeURIComponent(a),c=b.replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}),d=new Uint8Array(c.length);return Array.prototype.forEach.call(c,function(a,b){d[b]=a.charCodeAt(0)}),d}function O(a){var b=Array.prototype.map.call(a,function(a){return String.fromCharCode(a)}).join(""),c=b.replace(/(.)/g,function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return c.length<2&&(c="0"+c),"%"+c});return decodeURIComponent(c)}function P(a){for(var b="",c=0;c<a.length;++c){var d=String.fromCharCode(a[c]);if(b+=d,"\r"===d){c+=2;break}}var e=b.split(" ");return{size:c,protocol:e[0],version:e[1],headerSize:Number(e[2])}}function Q(a){switch("undefined"==typeof a?"undefined":(0,x.default)(a)){case"undefined":return"";case"object":return(0,v.default)(a);default:return a}}function R(a){var b=O(a);try{return JSON.parse(b)}catch(a){throw B.default.error("failed to parse input: ",b),a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/core-js/object/freeze"),f=I(e),g=a("babel-runtime/core-js/promise"),h=I(g),i=a("babel-runtime/core-js/object/define-properties"),j=I(i),k=a("babel-runtime/core-js/object/get-prototype-of"),l=I(k),m=a("babel-runtime/helpers/classCallCheck"),n=I(m),o=a("babel-runtime/helpers/createClass"),p=I(o),q=a("babel-runtime/helpers/possibleConstructorReturn"),r=I(q),s=a("babel-runtime/helpers/inherits"),t=I(s),u=a("babel-runtime/core-js/json/stringify"),v=I(u),w=a("babel-runtime/helpers/typeof"),x=I(w),y=a("events"),z=I(y),A=a("./logger"),B=I(A),C=a("uuid"),D=I(C),E=a("backoff"),F=I(E),G=a("javascript-state-machine"),H=I(G),J=d.WebSocket||d.MozWebSocket||a("ws"),K=5e3,L=43e3,S=function(a){function b(a){var c=arguments;(0,n.default)(this,b);var d=(0,r.default)(this,(b.__proto__||(0,l.default)(b)).call(this)),e=F.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return e.on("ready",function(){d._retry()}),(0,j.default)(d,{_config:{value:a},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_backoff:{value:e},_fsm:{value:null,writable:!0},_watchTimer:{value:null,writable:!0},_timestamp:{value:0,writable:!0},_socket:{value:null,writable:!0},_activeToken:{value:null,writable:!0},activeToken:{enumerable:!0,get:function(){return d._activeToken}},state:{enumberable:!0,get:function(){return d._getState()}},isConnected:{enumberable:!0,get:function(){return d._isConnected()}}}),d._fsm=H.default.create({initial:"disconnected",events:[{name:"userConnect",from:["error","disconnected"],to:"connecting"},{name:"userDisconnect",from:["connecting","connected","retrying"],to:"disconnecting"},{name:"userDisconnect",from:["rejected"],to:"disconnected"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"connected"},{name:"socketClosed",from:["connecting","connected","error"],to:"retrying"},{name:"socketError",from:["connected"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketRejected",from:["connecting","connected"],to:"disconnecting"},{name:"tokenRejected",from:["connecting","connected"],to:"rejected"},{name:"evUnsupported",from:["connecting"],to:"unsupported"},{name:"evUnsupported",from:["connected"],to:"error"},{name:"protocolError",from:["connecting","connected"],to:"error"}],callbacks:{onconnecting:function(){d._startWatchdogTimer(),d._setupSocket(),d.emit("connecting")},onretrying:function(){d._initRetry(),d.emit("connecting")},onenterconnected:d._onConnected.bind(d),onuserDisconnect:function(){d._closeSocket()},ondisconnected:function(){return d._finalizeSocket()},onsocketRejected:function(){var b=Array.prototype.slice.call(c,3,c.length);d._onSocketRejected(b)},onunsupported:function(){d._closeSocket(),d._finalizeSocket()},onrejected:function(){d._closeSocket(),d._finalizeSocket()},onerror:function(){d._closeSocket(),d._finalizeSocket()},onenterstate:function(){d.emit("stateChanged",d.state)}},error:function(){B.default.trace("FSM: unexpected transition",arguments)}}),d}return(0,t.default)(b,a),(0,p.default)(b,[{key:"_isConnected",value:function(){return this.state===b.state.CONNECTED&&this._socket&&1===this._socket.readyState}},{key:"_getState",value:function(){if(!this._fsm)return b.state.DISCONNECTED;switch(this._fsm.current){case"connecting":case"retrying":return b.state.CONNECTING;case"connected":return b.state.CONNECTED;case"rejected":return b.state.REJECTED;case"disconnecting":return b.state.DISCONNECTING;case"disconnected":case"error":default:return b.state.DISCONNECTED}}},{key:"_initRetry",value:function(){this._backoff.backoff()}},{key:"_retry",value:function(){this._socket=null,this._activeToken=null,this._fsm.userRetry()}},{key:"_onConnected",value:function(){this._backoff.reset(),this.emit("connected",this._wschannelUrl)}},{key:"_finalizeSocket",value:function(){if(this._stopWatchdogTimer(),this._onDisconnected(),this._disconnectedPromiseResolve){var b=this._disconnectedPromiseResolve;this._disconnectedPromiseResolve=null,b()}}},{key:"_onDisconnected",value:function(){this._backoff.reset(),this._wschannelUrl=null,this._socket=null,this._activeToken=null,this.emit("disconnected")}},{key:"_setupSocket",value:function(){var b=this,c=this._config.token,d=this._config.twilsockUri+"?token="+encodeURIComponent(c),e=new J(d);e.binaryType="arraybuffer",e.onopen=function(){B.default.info("socket opened")},e.onclose=function(a){B.default.info("socket closed",a),b._fsm.socketClosed()},e.onerror=function(a){B.default.error("error: ",a)},e.onmessage=function(a){B.default.trace("data: ",a.data);var c=2,d=new Uint8Array(a.data),e=P(d);if("TWILSOCK"!==e.protocol||"V1.0"!==e.version)return B.default.error("unsupported protocol: "+e.protocol+" ver "+e.version),void b._fsm.evUnsupported("Unsupported protocol");var f=null;try{f=R(d.subarray(e.size,e.size+e.headerSize))}catch(c){return B.default.error("failed to parse message header",c,a),void b._fsm.protocolError()}B.default.trace("message received: ",f);var g=null;if(f.payload_size>0){var h=c+e.size+e.headerSize,i=f.payload_size;if(f.hasOwnProperty("payload_type")&&0!==f.payload_type.indexOf("application/json"))0===f.payload_type.indexOf("text/plain")&&(g=O(d.subarray(h,h+i)));else try{g=R(d.subarray(h,h+i))}catch(c){return B.default.error("failed to parse message body",c,a),void b._fsm.protocolError()}}b._updateActivityTimestamp(),"ready"===f.method?(B.default.trace("ready",g),b._wschannelUrl=g.wschannel_url,b._confirmReceiving(f),b._fsm.socketConnected()):"notification"===f.method?(b._confirmReceiving(f),b.emit("message",f.message_type,g)):"reply"===f.method?b.emit("reply",{id:f.id,status:f.status,header:f,body:g}):"ping"===f.method?b._confirmReceiving(f):"close"===f.method&&(B.default.trace("connection close initated by server"),b._confirmReceiving(f),!g||401!==g.code&&410!==g.code?b._fsm.socketRejected(g):b._fsm.tokenRejected(g))},this._activeToken=c,this._socket=e}},{key:"_confirmReceiving",value:function(b){var c={method:"reply",id:b.id,payload_type:"application/json",status:{code:200,status:"OK"}};try{this._sendPacket(c)}catch(a){B.default.debug("failed to confirm packet receiving",a)}}},{key:"_sendPacket",value:function(b,c){var d=Q(c);b.payload_size=M(d);var e=(0,v.default)(b)+"\r\n",f="TWILSOCK V1.0 "+(M(e)-2)+"\r\n",g=N(f+e+d);try{this._socket.send(g.buffer)}catch(a){throw B.default.info("failed to send ",b,a),B.default.info(a.stack),a}}},{key:"_cancelRetryAttempt",value:function(){this._backoff.reset()}},{key:"_closeSocket",value:function(){this._cancelRetryAttempt(),this._socket&&(this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.close()),this._fsm.socketClosed()}},{key:"connect",value:function(){this._fsm.userConnect()}},{key:"disconnect",value:function(){var b=this;return this._fsm.is("disconnected")?h.default.resolve():new h.default(function(a){b._disconnectedPromiseResolve=a,b._fsm.userDisconnect()})}},{key:"sendUpstreamMessage",value:function(b,c,d){var e=D.default.v4(),f={host:b.host,path:b.path,method:b.method};b.hasOwnProperty("params")&&(f.params=b.params);var g={method:"message",id:e,http_header:f};return c&&(g.http_header.headers=c),c&&c.hasOwnProperty("Content-Type")&&(g.payload_type=c["Content-Type"]),this._sendPacket(g,d),e}},{key:"send",value:function(b,c){return b.id=b.id||D.default.v4(),this._sendPacket(b,c),b.id}},{key:"_onSocketRejected",value:function(b){B.default.error("connection closed by server",b),this._closeSocket()}},{key:"_startWatchdogTimer",value:function(){var b=this;this._timestamp=Date.now(),this._watchTimer=setInterval(function(){Date.now()-b._timestamp>L&&b._socket&&b._socket.close()},K)}},{key:"_stopWatchdogTimer",value:function(){clearInterval(this._watchTimer)}},{key:"_updateActivityTimestamp",value:function(){this._timestamp=Date.now()}}]),b}(z.default);c.default=S,S.state={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",ERROR:"error",REJECTED:"rejected"},(0,f.default)(S.state),(0,f.default)(S),b.exports=c.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":218,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/helpers/typeof":27,backoff:29,events:169,"javascript-state-machine":170,uuid:224,ws:40}],221:[function(a,b,c){"function"==typeof Object.create?b.exports=function(b,c){b.super_=c,b.prototype=Object.create(c.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(b,c){b.super_=c;var d=function(){};d.prototype=c.prototype,b.prototype=new d,b.prototype.constructor=b}},{}],222:[function(a,b,c){b.exports=function(b){return b&&"object"==typeof b&&"function"==typeof b.copy&&"function"==typeof b.fill&&"function"==typeof b.readUInt8}},{}],223:[function(a,b,c){(function(b,d){function h(a,b){var d={seen:[],stylize:j};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),s(b)?d.showHidden=b:b&&c._extend(d,b),y(d.showHidden)&&(d.showHidden=!1),y(d.depth)&&(d.depth=2),y(d.colors)&&(d.colors=!1),y(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=i),l(d,a,d.depth)}function i(a,b){var c=h.styles[b];return c?"["+h.colors[c][0]+"m"+a+"["+h.colors[c][1]+"m":a}function j(a,b){return a}function k(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function l(a,b,d){if(a.customInspect&&b&&D(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return w(e)||(e=l(a,e,d)),e}var f=m(a,b);if(f)return f;var g=Object.keys(b),h=k(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),C(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return n(b);if(0===g.length){if(D(b)){var i=b.name?": "+b.name:"";return a.stylize("[Function"+i+"]","special")}if(z(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(B(b))return a.stylize(Date.prototype.toString.call(b),"date");if(C(b))return n(b)}var j="",s=!1,t=["{","}"];if(r(b)&&(s=!0,t=["[","]"]),D(b)){var u=b.name?": "+b.name:"";j=" [Function"+u+"]"}if(z(b)&&(j=" "+RegExp.prototype.toString.call(b)),B(b)&&(j=" "+Date.prototype.toUTCString.call(b)),C(b)&&(j=" "+n(b)),0===g.length&&(!s||0==b.length))return t[0]+j+t[1];if(d<0)return z(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var v;return v=s?o(a,b,d,h,g):g.map(function(c){return p(a,b,d,h,c,s)}),a.seen.pop(),q(v,j,t)}function m(a,b){if(y(b))return a.stylize("undefined","undefined");if(w(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return v(b)?a.stylize(""+b,"number"):s(b)?a.stylize(""+b,"boolean"):t(b)?a.stylize("null","null"):void 0}function n(a){return"["+Error.prototype.toString.call(a)+"]"}function o(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)J(b,String(g))?f.push(p(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(p(a,b,c,d,e,!0))}),f}function p(a,b,c,d,e,f){var g,h,i;if(i=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},i.get?h=i.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):i.set&&(h=a.stylize("[Setter]","special")),J(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(i.value)<0?(h=t(c)?l(a,i.value,null):l(a,i.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),y(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function q(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function r(a){return Array.isArray(a)}function s(a){return"boolean"==typeof a}function t(a){return null===a}function u(a){return null==a}function v(a){return"number"==typeof a}function w(a){return"string"==typeof a}function x(a){return"symbol"==typeof a}function y(a){return void 0===a}function z(a){return A(a)&&"[object RegExp]"===F(a)}function A(a){return"object"==typeof a&&null!==a}function B(a){return A(a)&&"[object Date]"===F(a)}function C(a){return A(a)&&("[object Error]"===F(a)||a instanceof Error)}function D(a){return"function"==typeof a}function E(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function F(a){return Object.prototype.toString.call(a)}function G(a){return a<10?"0"+a.toString(10):a.toString(10)}function I(){var a=new Date,b=[G(a.getHours()),G(a.getMinutes()),G(a.getSeconds())].join(":");return[a.getDate(),H[a.getMonth()],b].join(" ")}function J(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var e=/%[sdj%]/g;c.format=function(a){if(!w(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(h(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(e,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),i=d[c];c<f;i=d[++c])g+=t(i)||!A(i)?" "+i:" "+h(i);return g},c.deprecate=function(a,e){function g(){if(!f){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),f=!0}return a.apply(this,arguments)}if(y(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var f=!1;return g};var g,f={};c.debuglog=function(a){if(y(g)&&(g=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!f[a])if(new RegExp("\\b"+a+"\\b","i").test(g)){var d=b.pid;f[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else f[a]=function(){};return f[a]},c.inspect=h,h.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},h.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=r,c.isBoolean=s,c.isNull=t,c.isNullOrUndefined=u,c.isNumber=v,c.isString=w,c.isSymbol=x,c.isUndefined=y,c.isRegExp=z,c.isObject=A,c.isDate=B,c.isError=C,c.isFunction=D,c.isPrimitive=E,c.isBuffer=a("./support/isBuffer");var H=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",I(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!A(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":222,_process:178,inherits:221}],224:[function(a,b,c){var d=a("./v1"),e=a("./v4"),f=e;f.v1=d,f.v4=e,b.exports=f},{"./v1":227,"./v4":228}],225:[function(a,b,c){function f(a,b){var c=b||0,e=d;return e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]}for(var d=[],e=0;e<256;++e)d[e]=(e+256).toString(16).substr(1);b.exports=f},{}],226:[function(a,b,c){(function(a){var c,d=a.crypto||a.msCrypto;if(d&&d.getRandomValues){var e=new Uint8Array(16);c=function(){return d.getRandomValues(e),e}}if(!c){var f=new Array(16);c=function(){for(var b,a=0;a<16;a++)0===(3&a)&&(b=4294967296*Math.random()),f[a]=b>>>((3&a)<<3)&255;return f}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],227:[function(a,b,c){function k(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var k=void 0!==a.clockseq?a.clockseq:h,l=void 0!==a.msecs?a.msecs:(new Date).getTime(),m=void 0!==a.nsecs?a.nsecs:j+1,n=l-i+(m-j)/1e4;if(n<0&&void 0===a.clockseq&&(k=k+1&16383),(n<0||l>i)&&void 0===a.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");i=l,j=m,h=k,l+=122192928e5;var o=(1e4*(268435455&l)+m)%4294967296;f[d++]=o>>>24&255,f[d++]=o>>>16&255,f[d++]=o>>>8&255,f[d++]=255&o;var p=l/4294967296*1e4&268435455;f[d++]=p>>>8&255,
f[d++]=255&p,f[d++]=p>>>24&15|16,f[d++]=p>>>16&255,f[d++]=k>>>8|128,f[d++]=255&k;for(var q=a.node||g,r=0;r<6;++r)f[d+r]=q[r];return b?b:e(f)}var d=a("./lib/rng"),e=a("./lib/bytesToUuid"),f=d(),g=[1|f[0],f[1],f[2],f[3],f[4],f[5]],h=16383&(f[6]<<8|f[7]),i=0,j=0;b.exports=k},{"./lib/bytesToUuid":225,"./lib/rng":226}],228:[function(a,b,c){function f(a,b,c){var f=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||d)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[f+h]=g[h];return b||e(g)}var d=a("./lib/rng"),e=a("./lib/bytesToUuid");b.exports=f},{"./lib/bytesToUuid":225,"./lib/rng":226}],229:[function(a,b,c){b.exports={name:"twilio-chat",version:"0.12.0",description:"A library for Twilio IP messaging",main:"lib/index.js",author:"Twilio",license:"MIT",dependencies:{"babel-runtime":"^6.18.0",backoff:"^2.5.0",durational:"^1.1.0",loglevel:"^1.4.1",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.1.5","twilio-notifications":"^0.3.0","twilio-sync":"^0.4.2","twilio-transport":"^0.1.1",twilsock:"^0.2.2",uuid:"^3.0.1"},devDependencies:{async:"^2.1.4","async-test-tools":"^1.0.6","babel-eslint":"^7.1.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-async-to-generator":"^6.22.0","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.22.0","babel-preset-es2015":"^6.22.0","babel-runtime":"^6.22.0",babelify:"^7.3.0",browserify:"^14.0.0","browserify-replace":"^0.9.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2","event-to-promise":"^0.7.0",express:"^4.14.1",gulp:"^3.9.1","gulp-derequire":"^2.1.0","gulp-eslint":"^3.0.1","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^3.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-uglify":"^2.0.1","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3","jsdoc-strip-async-await":"^0.1.0",karma:"^1.4.1","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","karma-sinon-ie":"^2.0.0","loglevel-message-prefix":"^2.0.1","mocha.parallel":"^0.14.0",proxyquire:"^1.7.11","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0",twilio:"^2.11.1","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},engines:{node:">=6"}}},{}],230:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{default:a}}function I(a){try{return new Date(a)}catch(a){return null}}function J(a){switch(a){case"notParticipating":return"known";default:return a}}var d=a("babel-runtime/core-js/object/freeze"),e=z(d),f=a("babel-runtime/core-js/get-iterator"),g=z(f),h=a("babel-runtime/core-js/promise"),i=z(h),j=a("babel-runtime/core-js/object/define-properties"),k=z(j),l=a("babel-runtime/core-js/map"),m=z(l),n=a("babel-runtime/core-js/json/stringify"),o=z(n),p=a("babel-runtime/core-js/object/get-prototype-of"),q=z(p),r=a("babel-runtime/helpers/classCallCheck"),s=z(r),t=a("babel-runtime/helpers/createClass"),u=z(t),v=a("babel-runtime/helpers/possibleConstructorReturn"),w=z(v),x=a("babel-runtime/helpers/inherits"),y=z(x),A=a("events").EventEmitter,B=a("./data/members"),C=a("./member"),D=a("./data/messages"),E=a("./logger"),F=a("./util").isDeepEqual,G=a("./util").UriBuilder,H={attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",name:"friendlyName",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"},K=function(a){function b(a,c,d){(0,s.default)(this,b);var e=(0,w.default)(this,(b.__proto__||(0,q.default)(b)).call(this)),f=c.attributes||{},g=c.createdBy,h=I(c.dateCreated),i=I(c.dateUpdated),j=c.name||c.friendlyName||null,l="undefined"!=typeof c.lastConsumedMessageIndex?c.lastConsumedMessageIndex:null,n="known",p=c.type||b.type.PUBLIC,r=c.uniqueName||null,t=c.channel;c.isPrivate&&(p=b.type.PRIVATE);try{(0,o.default)(f)}catch(a){throw new Error("Attributes must be a valid JSON object.")}var u=new m.default,v=new B(e,a.session,a.userInfos,u);v.on("memberJoined",e.emit.bind(e,"memberJoined")),v.on("memberLeft",e.emit.bind(e,"memberLeft")),v.on("memberUpdated",e.emit.bind(e,"memberUpdated")),v.on("memberInfoUpdated",e.emit.bind(e,"memberInfoUpdated"));var x=[],y=new D(e,a.session,x);return y.on("messageAdded",function(a){return e._onMessageAdded(a)}),y.on("messageUpdated",e.emit.bind(e,"messageUpdated")),y.on("messageRemoved",e.emit.bind(e,"messageRemoved")),(0,k.default)(e,{_attributes:{get:function(){return f},set:function(b){return f=b}},_createdBy:{get:function(){return g},set:function(b){return g=b}},_dateCreated:{get:function(){return h},set:function(b){return h=b}},_dateUpdated:{get:function(){return i},set:function(b){return i=b}},_friendlyName:{get:function(){return j},set:function(b){return j=b}},_lastConsumedMessageIndex:{get:function(){return l},set:function(b){return l=b}},_type:{get:function(){return p},set:function(b){return p=b}},_sid:{get:function(){return d},set:function(b){return d=b}},_status:{get:function(){return n},set:function(b){return n=b}},_uniqueName:{get:function(){return r},set:function(b){return r=b}},_entityPromise:{value:null,writable:!0},_subscribePromise:{value:null,writable:!0},_membersEntity:{value:v},_messagesEntity:{value:y},_services:{value:a},_session:{value:a.session},_typingIndicator:{value:a.typingIndicator},_consumptionHorizon:{value:a.consumptionHorizon},_entityName:{value:t,writable:!0},_members:{value:u},_messages:{value:x},attributes:{enumerable:!0,get:function(){return f}},createdBy:{enumerable:!0,get:function(){return g}},dateCreated:{enumerable:!0,get:function(){return h}},dateUpdated:{enumerable:!0,get:function(){return i}},friendlyName:{enumerable:!0,get:function(){return j}},isPrivate:{enumerable:!0,get:function(){return e._type===b.type.PRIVATE}},lastConsumedMessageIndex:{enumerable:!0,get:function(){return l}},sid:{enumerable:!0,get:function(){return d}},status:{enumerable:!0,get:function(){return n}},type:{enumerable:!0,get:function(){return p}},uniqueName:{enumerable:!0,get:function(){return r}}}),e}return(0,y.default)(b,a),(0,u.default)(b,[{key:"_subscribe",value:function(){var b=this;return this._entityPromise?this._entityPromise:(this._entityPromise=this._session.datasync.document({uniqueName:this._entityName,mode:"open"}).then(function(a){return b._entity=a,a.on("updated",function(a){return b._update(a)}),b._update(a.value),b._entity}).catch(function(a){throw b._enityPromise=null,E.error("Failed to get channel object",a),a}),this._entityPromise)}},{key:"_subscribeStreams",value:function(){var b=this;return this._subscribePromise=this._subscribePromise||this._subscribe().then(function(a){var c=a.value.messages,d=a.value.roster;return i.default.all([b._messagesEntity.subscribe(c),b._membersEntity.subscribe(d)])}).then(function(){return b._entity}).catch(function(a){throw b._subscribePromise=null,E.error("Failed to subscribe on channel objects",b.sid,a),a}),this._subscribePromise}},{key:"_fetch",value:function(){return this._session.datasync.document({uniqueName:this._entityName,mode:"open"}).then(function(a){return a.value})}},{key:"_unsubscribe",value:function(){var b=[];return this._entityPromise&&b.push(this._entity.close()),b.push(this._membersEntity.unsubscribe()),b.push(this._messagesEntity.unsubscribe()),this._entityPromise=null,this._subscribePromise=null,i.default.all(b)}},{key:"_setStatus",value:function(c){this._status!==c&&(this._status=c,c===b.status.JOINED?this._subscribeStreams():c===b.status.INVITED?this._subscribe():this._entityPromise&&this._unsubscribe())}},{key:"_update",value:function(c){b._preprocessUpdate(c,this._sid);var d=!1;for(var e in c){var f=H[e];f&&(f===H.status?this._status=J(c.status):f===H.attributes?F(this._attributes,c.attributes)||(this._attributes=c.attributes,d=!0):c[e]instanceof Date?this[f]&&this[f].getTime()===c[e].getTime()||(this["_"+f]=c[e],d=!0):this[f]!==c[e]&&(this["_"+f]=c[e],d=!0))}c.status||c.uniqueName||this._uniqueName&&(this._uniqueName=null,d=!0),d&&this.emit("updated",this)}},{key:"_onMessageAdded",value:function(b){var c=!0,d=!1,e=void 0;try{for(var h,f=(0,g.default)(this._members.values());!(c=(h=f.next()).done);c=!0){var i=h.value;if(i.identity===b.author){i._endTyping();break}}}catch(a){d=!0,e=a}finally{try{!c&&f.return&&f.return()}finally{if(d)throw e}}this.emit("messageAdded",b)}},{key:"add",value:function(b){return b&&"string"==typeof b?this._membersEntity.add(b):i.default.reject(new Error("Channel.add requires an <String>identity parameter"))}},{key:"advanceLastConsumedMessageIndex",value:function(b){var c=this;if(parseInt(b)!==b){var d="Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter";return i.default.reject(new Error(d))}return null!==this.lastConsumedMessageIndex&&b<=this.lastConsumedMessageIndex?i.default.resolve():this._subscribeStreams().then(function(){c._consumptionHorizon.advanceLastConsumedMessageIndexForChannel(c.sid,b)}).then(function(){return c})}},{key:"decline",value:function(){var b=this;return this._session.addCommand("declineInvitation",{channelSid:this._sid}).then(function(){return b})}},{key:"delete",value:function(){var b=this;return this._session.addCommand("destroyChannel",{channelSid:this._sid}).then(function(){return b})}},{key:"getAttributes",value:function(){var b=this;return this._entityPromise?this._subscribe().then(function(){return b.attributes}):this._fetch().then(function(a){return b._update(a),b.attributes})}},{key:"getMessages",value:function(b,c,d){var e=this;return this._subscribeStreams().then(function(){return e._messagesEntity.getMessages(b,c,d)})}},{key:"getMembers",value:function(){var b=this;return this._subscribeStreams().then(function(){return b._membersEntity.getMembers()})}},{key:"getMembersCount",value:function(){var b=this;return this._session.getSessionLinks().then(function(a){return new G(a.publicChannelsUrl).path(b.sid).build()}).then(function(a){return b._services.network.get(a)}).then(function(a){return a.body.members_count})}},{key:"getMessagesCount",value:function(){var b=this;return this._session.getSessionLinks().then(function(a){return new G(a.publicChannelsUrl).path(b.sid).build()}).then(function(a){return b._services.network.get(a)}).then(function(a){return a.body.messages_count})}},{key:"getUnconsumedMessagesCount",value:function(){var b=this;return this._session.getSessionLinks().then(function(a){return new G(a.myChannelsUrl).arg("ChannelSid",b.sid).build()}).then(function(a){return b._services.network.get(a)}).then(function(a){if(a.body.channels.length)return a.body.channels[0].unread_messages_count||0;var b="Channel is not in user channels list";return i.default.reject(new Error(b))})}},{key:"invite",value:function(b){return"string"==typeof b&&b.length?this._membersEntity.invite(b):i.default.reject(new Error("Channel.invite requires an <String>identity parameter"))}},{key:"join",value:function(){var b=this;return this._session.addCommand("joinChannel",{channelSid:this._sid}).then(function(){return b})}},{key:"leave",value:function(){var c=this;return this._status!==b.status.JOINED?i.default.resolve(this):this._session.addCommand("leaveChannel",{channelSid:this._sid}).then(function(){return c})}},{key:"removeMember",value:function(b){return b&&("string"==typeof b||b instanceof C)?this._membersEntity.remove("string"==typeof b?b:b.identity):i.default.reject(new Error("Channel.removeMember requires a <String|Member>member parameter."))}},{key:"sendMessage",value:function(b,c){return this._messagesEntity.send(b,c).then(function(a){return a.messageId})}},{key:"setAllMessagesConsumed",value:function(){var b=this;return this._subscribeStreams().then(function(){return b.getMessages(1)}).then(function(a){a.items.length>0&&b.advanceLastConsumedMessageIndex(a.items[0].index)}).then(function(){return b})}},{key:"setNoMessagesConsumed",value:function(){return this.updateLastConsumedMessageIndex(null)}},{key:"typing",value:function(){return this._typingIndicator.send(this._sid)}},{key:"updateAttributes",value:function(b){var c=this;if(!b){var d="Attributes is a required parameter for updateAttributes and it should be valid JSON";return i.default.reject(new Error(d))}return b.constructor!==Object?i.default.reject(new Error("Attributes must be a valid JSON object.")):this._session.addCommand("editAttributes",{channelSid:this._sid,attributes:(0,o.default)(b)}).then(function(){return c})}},{key:"updateFriendlyName",value:function(b){var c=this;return this._friendlyName===b?i.default.resolve(this):this._session.addCommand("editFriendlyName",{channelSid:this._sid,friendlyName:b}).then(function(){return c})}},{key:"updateLastConsumedMessageIndex",value:function(b){var c=this;if(null!==b&&parseInt(b)!==b){var d="Channel.updateLastConsumedMessageIndex requires an integral <Number>index parameter";return i.default.reject(new Error(d))}return this._subscribeStreams().then(function(){c._consumptionHorizon.updateLastConsumedMessageIndexForChannel(c.sid,b)}).then(function(){return c})}},{key:"updateUniqueName",value:function(b){var c=this;return this._uniqueName===b?i.default.resolve(this):this._session.addCommand("editUniqueName",{channelSid:this._sid,uniqueName:b}).then(function(){return c})}}],[{key:"_preprocessUpdate",value:function(b,c){try{"string"==typeof b.attributes?b.attributes=JSON.parse(b.attributes):b.attributes&&(0,o.default)(b.attributes)}catch(a){E.warn("Retrieved malformed attributes from the server for channel: "+c),b.attributes={}}try{b.dateCreated&&(b.dateCreated=new Date(b.dateCreated))}catch(a){E.warn("Retrieved malformed attributes from the server for channel: "+c),delete b.dateCreated}try{b.dateUpdated&&(b.dateUpdated=new Date(b.dateUpdated))}catch(a){E.warn("Retrieved malformed attributes from the server for channel: "+c),delete b.dateUpdated}}}]),b}(A);K.type={PUBLIC:"public",PRIVATE:"private"},K.status={KNOWN:"known",INVITED:"invited",JOINED:"joined",FAILED:"failed"},(0,e.default)(K.type),(0,e.default)(K.status),b.exports=K},{"./data/members":235,"./data/messages":236,"./logger":240,"./member":241,"./util":251,"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],231:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function l(a){try{return JSON.parse(a)}catch(a){k.warning("Failed to parse channel attributes",a)}return{}}function m(a){try{return new Date(a)}catch(a){return null}}var d=a("babel-runtime/core-js/object/define-properties"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k=a("./logger"),n=function(){function a(b,c){(0,g.default)(this,a),(0,e.default)(this,{_client:{value:b},_descriptor:{value:c},sid:{value:c.sid,enumerable:!0},channel:{value:c.sid+".channel",enumerable:!0},uniqueName:{value:c.unique_name,enumerable:!0},friendlyName:{value:c.friendly_name,enumerable:!0},attributes:{value:l(c.attributes)},createdBy:{value:c.created_by,enumerable:!0},dateCreated:{value:m(c.date_created),enumerable:!0},dateUpdated:{value:m(c.date_updated),enumerable:!0},messagesCount:{value:c.messages_count,enumerable:!0},membersCount:{value:c.members_count,enumerable:!0},type:{value:c.type,enumerable:!0}})}return(0,i.default)(a,[{key:"getChannel",value:function(){return this._client.getChannelBySid(this.sid)}}]),a}();b.exports=n},{"./logger":240,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],232:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/freeze"),e=t(d),f=a("babel-runtime/core-js/promise"),g=t(f),h=a("babel-runtime/core-js/object/define-properties"),i=t(h),j=a("babel-runtime/core-js/object/get-prototype-of"),k=t(j),l=a("babel-runtime/helpers/classCallCheck"),m=t(l),n=a("babel-runtime/helpers/createClass"),o=t(n),p=a("babel-runtime/helpers/possibleConstructorReturn"),q=t(p),r=a("babel-runtime/helpers/inherits"),s=t(r),u=a("events").EventEmitter,v=a("./logger"),w=a("twilio-notifications"),x=a("twilsock"),y=a("twilio-transport").Transport,z=a("twilio-sync").SyncClient,A=a("./configuration"),B=a("./session"),C=a("./data/channels"),D=a("./data/publicchannels"),E=a("./data/userinfos"),F=a("./services/typingindicator"),G=a("./services/consumptionhorizon"),H=a("./services/network"),I=a("twilio-ems-client").EmsClient,J=a("./../package.json").version,K="A valid Twilio token should be provided",L=function(a){function b(a,c){(0,m.default)(this,b);var d=(0,q.default)(this,(b.__proto__||(0,k.default)(b)).call(this));if(c=c||{},c.logLevel=c.logLevel||"error",c.productId="ip_messaging",!a)throw new Error(K);v.setLevel(c.logLevel);var e=new A(null,c);c.twilsockClient=c.twilsockClient||new x(a,c),c.transport=c.transport||new y(c.twilsockClient,c);var f=c.emsClient=c.emsClient||new I(c);c.notificationsClient=c.notificationsClient||new w(a,c),c.syncClient=c.syncClient||new z(a,c);var g=c.syncClient,h=c.transport,j=c.twilsockClient,l=c.notificationsClient,n=new B(g,h,e),o=n.initialize(a),p=new H(e,n,h),r=new E(n,g,null);r.on("userInfoUpdated",d.emit.bind(d,"userInfoUpdated"));var s=new G(e,n),t=new F(e,h,l,d.getChannelBySid.bind(d)),u=new C({session:n,userInfos:r,typingIndicator:t,consumptionHorizon:s,network:p,config:e}),D=o.then(function(){return u.on("channelAdded",d.emit.bind(d,"channelAdded")),u.on("channelRemoved",d.emit.bind(d,"channelRemoved")),u.on("channelInvited",d.emit.bind(d,"channelInvited")),u.on("channelJoined",d.emit.bind(d,"channelJoined")),u.on("channelLeft",d.emit.bind(d,"channelLeft")),u.on("channelUpdated",d.emit.bind(d,"channelUpdated")),u.on("memberJoined",d.emit.bind(d,"memberJoined")),u.on("memberLeft",d.emit.bind(d,"memberLeft")),u.on("memberUpdated",d.emit.bind(d,"memberUpdated")),u.on("messageAdded",d.emit.bind(d,"messageAdded")),u.on("messageUpdated",d.emit.bind(d,"messageUpdated")),u.on("messageRemoved",d.emit.bind(d,"messageRemoved")),u.on("typingStarted",d.emit.bind(d,"typingStarted")),u.on("typingEnded",d.emit.bind(d,"typingEnded")),u.fetchChannels()}).then(function(){return u});return l.on("transportReady",function(a){if(a)d._connectionState=b.connectionState.CONNECTED,d._session.syncToken().catch(function(a){v.error("Failed to sync session token",a)});else switch(d._twilsock.state){case"rejected":d._connectionState=b.connectionState.DENIED;break;default:d._connectionState=b.connectionState.CONNECTING}d.emit("connectionStateChanged",d._connectionState)}),(0,i.default)(d,{_config:{value:e},_fpaToken:{value:a,writable:!0},_emsClient:{value:f},_channelsPromise:{value:D},_channels:{value:u},_transport:{value:p},_datasync:{value:g},_notifications:{value:l},_session:{value:n},_sessionPromise:{value:o},_initializePromise:{value:null,writable:!0},_twilsock:{value:j},_typingIndicator:{value:t},_userInfos:{value:r},_publicChannels:{value:null,writable:!0},_connectionState:{value:b.connectionState.CONNECTING,writable:!0},userInfo:{enumerable:!0,get:function(){return d._userInfos.myUserInfo}},connectionState:{enumerable:!0,get:function(){return d._connectionState}},reachabilityEnabled:{enumerable:!0,get:function(){return d._session.reachabilityEnabled}}}),d._initializePromise=d._initialize(),d}return(0,s.default)(b,a),(0,o.default)(b,[{key:"_initialize",value:function(){var b=this;return this._emsClient.setToken(this._fpaToken).then(function(a){return b._config.updateToken(a.token)}).then(function(){return b._sessionPromise}).then(function(){return b._notifications.subscribe("twilio.channel.new_message","gcm"),b._notifications.subscribe("twilio.channel.added_to_channel","gcm"),b._notifications.subscribe("twilio.channel.invited_to_channel","gcm"),b._session.getSessionLinks().then(function(a){return a.publicChannelsUrl}).then(function(a){return b._publicChannels=new D(b._config,b,b._transport,a),b._publicChannels})}).then(function(){return b._typingIndicator.initialize()})}},{key:"initialize",value:function(){var b=this;return this._initializePromise.then(function(){return b})}},{key:"shutdown",value:function(){return this._twilsock.disconnect()}},{key:"updateToken",value:function(b){var c=this;if(v.info("updateToken"),!b){var d=new Error(K);return g.default.reject(d)}return b===this._fpaToken?g.default.resolve(this):this._emsClient.setToken(b).then(function(a){if("NEW"===a.status)throw v.error("Can't extend token:",a.reason),new Error("Can't extend token:"+a.reason);return a.token}).then(function(a){return c._twilsock.updateToken(b).then(function(){return c._datasync.updateToken(b)}).then(function(){return c._notifications.updateToken(b)}).then(function(){return c._sessionPromise}).then(function(){return c._session.updateToken(a)}).then(function(){return a})}).then(function(a){return c._config.updateToken(a),c._fpaToken=b,c})}},{key:"getChannelBySid",value:function(b){var c=this;if(!b||"string"!=typeof b){var d=new Error("Client.getChannelBySid requires a <String>channelSid parameter");return g.default.reject(d)}return this._channels.getChannel(b).then(function(a){return a||c._publicChannels.getChannelBySid(b).then(function(a){return c._channels.pushChannel(a)})})}},{key:"getChannelByUniqueName",value:function(b){var c=this;if(!b||"string"!=typeof b){var d=new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");return g.default.reject(d)}return this._publicChannels.getChannelByUniqueName(b).then(function(a){return c._channels.pushChannel(a)})}},{key:"getUserChannels",value:function(b){return this._channelsPromise.then(function(a){return a.getChannels(b)})}},{key:"getPublicChannels",value:function(){return this._publicChannels.getChannels()}},{key:"createChannel",value:function(b){return b=b||{},this._channelsPromise.then(function(a){return a.addChannel(b)})}},{key:"setPushRegistrationId",value:function(b,c){this._notification.setPushRegistrationId(b,c||"gcm")}},{key:"putPushNotificationPayload",value:function(b){var c=b.additionalData;switch(c.type){case"twilio.channel.new_message":var d=c.data.channel_id,e=c.data.message_id;this.getChannelBySid(d).then(function(a){return a.getMessages(10,e)})}}}]),b}(u);(0,i.default)(L,{version:{enumerable:!0,value:J}}),L.connectionState={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",ERROR:"error",DENIED:"denied"},(0,e.default)(L.connectionState),b.exports=L},{"./../package.json":229,"./configuration":233,"./data/channels":234,"./data/publicchannels":237,"./data/userinfos":238,"./logger":240,"./services/consumptionhorizon":244,"./services/network":245,"./services/typingindicator":246,"./session":247,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,"twilio-ems-client":182,"twilio-notifications":187,"twilio-sync":198,"twilio-transport":214,twilsock:217}],233:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/define-properties"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k="https://aim.twilio.com",l="/v1/typing",m=5,n=10,o="PT5S",p=function(){function a(b,c){var d=this;(0,g.default)(this,a),c=c||{};var f=c.Chat||c.IPMessaging||{},h=f.apiUri||f.typingUri||k;(0,e.default)(this,{_token:{value:b,writable:!0},token:{get:function(){return d._token},enumerable:!0},baseUri:{value:h},baseUrl:{value:h},typingIndicatorUri:{enumerable:!0,value:h+l},typingIndicatorTimeoutDefault:{enumerable:!0,value:1e3*m},httpCacheLifetimeDefault:{enumerable:!0,value:1e3*n},consumptionReportIntervalDefault:{enumerable:!0,value:o},typingIndicatorTimeoutOverride:{enumberable:!0,value:c.typingIndicatorTimeoutOverride},httpCacheLifetimeOverride:{enumberable:!0,value:c.httpCacheLifetimeOverride},consumptionReportIntervalOverride:{enumberable:!0,value:c.consumptionReportIntervalOverride}})}return(0,i.default)(a,[{key:"updateToken",value:function(b){this._token=b}}]),a}();b.exports=p},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],234:[function(a,b,c){"use strict";function v(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=v(d),f=a("babel-runtime/core-js/json/stringify"),g=v(f),h=a("babel-runtime/core-js/map"),i=v(h),j=a("babel-runtime/core-js/object/define-properties"),k=v(j),l=a("babel-runtime/core-js/object/get-prototype-of"),m=v(l),n=a("babel-runtime/helpers/classCallCheck"),o=v(n),p=a("babel-runtime/helpers/createClass"),q=v(p),r=a("babel-runtime/helpers/possibleConstructorReturn"),s=v(r),t=a("babel-runtime/helpers/inherits"),u=v(t),w=a("events").EventEmitter,x=a("../channel"),y=a("../logger"),z=function(a){function b(a){(0,o.default)(this,b);var c=(0,s.default)(this,(b.__proto__||(0,m.default)(b)).call(this));return(0,k.default)(c,{_services:{value:a},_userInfos:{value:a.userInfos},_typingIndicator:{value:a.typingIndicator},_session:{value:a.session},channels:{enumerable:!0,value:new i.default}}),c}return(0,u.default)(b,a),(0,q.default)(b,[{key:"_getMap",value:function(){var b=this;return this._session.getMyChannelsId().then(function(a){return b._session.datasync.map({uniqueName:a,mode:"open"})})}},{key:"addChannel",value:function(b){var c=this;return this._session.addCommand("createChannel",{friendlyName:b.friendlyName,uniqueName:b.uniqueName,type:b.isPrivate?"private":"public",attributes:(0,g.default)(b.attributes)}).then(function(a){var b=c.channels.get(a.channelSid);if(b)return b._subscribe().then(function(){return b});var d=new x(c._services,{channel:a.channel,channelSid:a.channelSid},a.channelSid);return c.channels.set(d.sid,d),c._registerForEvents(d),d._subscribe().then(function(){return c.emit("channelAdded",d),d})})}},{key:"fetchChannels",value:function(){var b=this;this._session.getMyChannelsId().then(function(a){return b._session.datasync.map({uniqueName:a,mode:"open"})}).then(function(a){a.on("itemAdded",function(a){b._upsertChannel(a.key,a.value)}),a.on("itemRemoved",function(a){var c=b.channels.get(a);c&&("joined"!==c.status&&"invited"!==c.status||(c._setStatus("known"),b.emit("channelLeft",c)),b.channels.delete(a),b.emit("channelRemoved",c))}),a.on("itemUpdated",function(a){b._upsertChannel(a.key,a.value)});var c=[];return a.forEach(function(a){c.push(b._upsertChannel(a.key,a.value))}).then(function(){return e.default.all(c)})}).then(function(){y.debug("Channels list fetched")}).then(function(){return b}).catch(function(a){throw y.error("Failed to get channels list",a),a})}},{key:"_wrapPaginator",value:function(b,c){var d=this;return c(b.items).then(function(a){return{items:a,hasNextPage:b.hasNextPage,hasPrevPage:b.hasPrevPage,nextPage:function(){return b.nextPage().then(function(a){return d._wrapPaginator(a,c)})},prevPage:function(){return b.prevPage().then(function(a){return d._wrapPaginator(a,c)})}}})}},{key:"getChannels",value:function(b){var c=this;return this._getMap().then(function(a){return a.getItems(b)}).then(function(a){return c._wrapPaginator(a,function(a){return e.default.all(a.map(function(a){return c._upsertChannel(a.key,a.value)}))})})}},{key:"getChannel",value:function(b){var c=this;return this._getMap().then(function(a){return a.getItems({key:b})}).then(function(a){return a.items.map(function(a){return c._upsertChannel(a.key,a.value)})}).then(function(a){return a.length>0?a[0]:null})}},{key:"pushChannel",value:function(b){var c=b.sid,d={status:"known",type:b.type,friendlyName:b.friendlyName,dateUpdated:b.dateUpdated,dateCreated:b.dateCreated,uniqueName:b.uniqueName,createdBy:b.createdBy,attributes:b.attributes,channel:b.channel,sid:c},e=this.channels.get(b.sid);return e||(e=new x(this._services,d,c),this.channels.set(c,e)),e}},{key:"_upsertChannel",value:function(b,c){var d=this,e=this.channels.get(b);return e?("joined"===c.status&&"joined"!==e.status?(e._setStatus("joined"),"undefined"!=typeof c.lastConsumedMessageIndex&&(e._lastConsumedMessageIndex=c.lastConsumedMessageIndex),e._subscribe().then(function(){d.emit("channelJoined",e)})):"invited"===c.status&&"invited"!==e.status?(e._setStatus("invited"),e._subscribe().then(function(){d.emit("channelInvited",e)})):"known"!==c.status||"invited"!==e.status&&"joined"!==e.status?"notParticipating"===c.status&&"private"===c.type?e._subscribe():e._update(c):(e._setStatus("known"),e._update(c),e._subscribe().then(function(){d.emit("channelLeft",e)})),e._subscribe().then(function(){return e})):(e=new x(this._services,c,b),this._registerForEvents(e),this.channels.set(b,e),e._subscribe().then(function(){return"joined"===c.status?(e._setStatus("joined"),d.emit("channelJoined",e)):"invited"===c.status&&(e._setStatus("invited"),d.emit("channelInvited",e)),e.isPrivate&&d.emit("channelAdded",e),e}))}},{key:"_registerForEvents",value:function(b){var c=this;b.on("updated",function(){return c.emit("channelUpdated",b)}),b.on("memberJoined",this.emit.bind(this,"memberJoined")),b.on("memberLeft",this.emit.bind(this,"memberLeft")),b.on("memberUpdated",this.emit.bind(this,"memberUpdated")),b.on("messageAdded",this.emit.bind(this,"messageAdded")),b.on("messageUpdated",this.emit.bind(this,"messageUpdated")),b.on("messageRemoved",this.emit.bind(this,"messageRemoved")),b.on("typingStarted",this.emit.bind(this,"typingStarted")),b.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),b}(w);b.exports=z},{"../channel":230,"../logger":240,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],235:[function(a,b,c){"use strict";function r(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=r(d),f=a("babel-runtime/core-js/object/define-properties"),g=r(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=r(h),j=a("babel-runtime/helpers/classCallCheck"),k=r(j),l=a("babel-runtime/helpers/createClass"),m=r(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=r(n),p=a("babel-runtime/helpers/inherits"),q=r(p),s=a("events").EventEmitter,t=a("../logger").scope("Members"),u=a("../member"),v=function(a){function b(a,c,d,e){(0,k.default)(this,b);var f=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this));return(0,g.default)(f,{_datasync:{value:c.datasync},_userInfos:{value:d},_session:{value:c},_rosterStreamPromise:{writable:!0,value:null},channel:{enumerable:!0,value:a},members:{enumerable:!0,value:e}}),f}return(0,q.default)(b,a),(0,m.default)(b,[{key:"unsubscribe",value:function(){return this._rosterStreamPromise?this._rosterStreamPromise.then(function(a){return a.close()}):e.default.resolve()}},{key:"subscribe",value:function(b){var c=this;return this._rosterStreamPromise=this._rosterStreamPromise||this._datasync.map({uniqueName:b,mode:"open"}).then(function(a){a.on("itemAdded",function(a){c.upsertMember(a.key,a.value).then(function(a){c.emit("memberJoined",a)})}),a.on("itemRemoved",function(a){if(c.members.has(a)){var b=c.members.get(a);
c.members.delete(a),c.emit("memberLeft",b)}}),a.on("itemUpdated",function(a){c.upsertMember(a.key,a.value)});var b=[];return a.forEach(function(a){b.push(c.upsertMember(a.key,a.value))}).then(function(){return e.default.all(b)}).then(function(){return a})}).catch(function(a){throw c._rosterStreamPromise=null,t.error("Failed to get roster object for channel",c.channel.sid,a),a})}},{key:"upsertMember",value:function(b,c){var d=this,f=this.members.get(b);return f?(f._update(c),e.default.resolve(f)):this._userInfos.getUserInfo(c.identity,c.userInfo).then(function(a){return f=new u(d.channel,c,b,a),d.members.set(b,f),f.on("updated",function(){return d.emit("memberUpdated",f)}),f.on("userInfoUpdated",function(){return d.emit("memberInfoUpdated",f)}),f})}},{key:"getMembers",value:function(){var b=this;return this._rosterStreamPromise.then(function(){var a=[];return b.members.forEach(function(b){return a.push(b)}),a})}},{key:"add",value:function(b){return this._session.addCommand("addMember",{channelSid:this.channel.sid,username:b})}},{key:"invite",value:function(b){return this._session.addCommand("inviteMember",{channelSid:this.channel.sid,username:b})}},{key:"remove",value:function(b){return this._session.addCommand("removeMember",{channelSid:this.channel.sid,username:b})}}]),b}(s);b.exports=v},{"../logger":240,"../member":241,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],236:[function(a,b,c){"use strict";function x(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/number/is-integer"),e=x(d),f=a("babel-runtime/core-js/json/stringify"),g=x(f),h=a("babel-runtime/core-js/promise"),i=x(h),j=a("babel-runtime/core-js/map"),k=x(j),l=a("babel-runtime/core-js/object/define-properties"),m=x(l),n=a("babel-runtime/core-js/object/get-prototype-of"),o=x(n),p=a("babel-runtime/helpers/classCallCheck"),q=x(p),r=a("babel-runtime/helpers/createClass"),s=x(r),t=a("babel-runtime/helpers/possibleConstructorReturn"),u=x(t),v=a("babel-runtime/helpers/inherits"),w=x(v),y=a("events").EventEmitter,z=a("loglevel"),A=a("../message"),B=function(a){function b(a,c,d){(0,q.default)(this,b);var e=(0,u.default)(this,(b.__proto__||(0,o.default)(b)).call(this));return(0,m.default)(e,{_datasync:{value:c.datasync},_eventStreamPromise:{value:null,writable:!0},_sortedMessages:{value:d},_messagesByIndex:{value:new k.default},_session:{value:c},channel:{enumerable:!0,value:a}}),e}return(0,w.default)(b,a),(0,s.default)(b,[{key:"subscribe",value:function(b){var c=this;return this._eventStreamPromise=this._eventStreamPromise||this._datasync.list({uniqueName:b,mode:"open"}).then(function(a){return a.on("itemAdded",function(a){var b=new A(c.channel,a.index,a.value);return c._messagesByIndex.has(b.index)?void z.debug("Message arrived, but already known and ignored",c.channel.sid,b.index):(c._sortedMessages.push(b),c._messagesByIndex.set(b.index,b),b.on("updated",function(){return c.emit("messageUpdated",b)}),void c.emit("messageAdded",b))}),a.on("itemRemoved",function(a){var b=c._removeMessageById(a);b&&(c._messagesByIndex.delete(b.index),b.removeAllListeners("updated"),c.emit("messageRemoved",b))}),a.on("itemUpdated",function(a){var b=c._messagesByIndex.get(a.index);b&&b._update(a.value)}),a}).catch(function(a){throw c._eventStreamPromise=null,z.error("Failed to get messages object for channel",c.channel.sid,a),a})}},{key:"unsubscribe",value:function(){return this._eventStreamPromise?this._eventStreamPromise.then(function(a){return a.close()}):i.default.resolve()}},{key:"_removeMessageById",value:function(b){for(var c=void 0,d=0;d<this._sortedMessages.length;d++){var e=this._sortedMessages[d];if(e.index===b){c=this._sortedMessages.splice(d,1)[0];break}}return c}},{key:"send",value:function(b,c){if("undefined"==typeof c)c={};else if(c.constructor!==Object)return i.default.reject(new Error("Attributes must be a valid JSON object"));return this._session.addCommand("sendMessage",{channelSid:this.channel.sid,text:b,attributes:(0,g.default)(c)})}},{key:"getMessages",value:function(b,c,d){return c=(0,e.default)(c)&&c>=0?c:"end",d=d||"backwards",this._getMessages(b,c,d)}},{key:"_wrapPaginator",value:function(b,c,d){var e=this,f="desc"===b,g=function(){return c.nextPage().then(function(a){return e._wrapPaginator(b,a,d)})},h=function(){return c.prevPage().then(function(a){return e._wrapPaginator(b,a,d)})};return d(c.items).then(function(a){return{items:a.sort(function(a,b){return a.index-b.index}),hasPrevPage:f?c.hasNextPage:c.hasPrevPage||!1,hasNextPage:f?c.hasPrevPage:c.hasNextPage||!1,prevPage:f?g:h,nextPage:f?h:g}})}},{key:"_upsertMessage",value:function(b,c){var d=this,e=this._messagesByIndex.get(b);if(e)return e;var f=new A(this.channel,b,c);return this._messagesByIndex.set(f.index,f),f.on("updated",function(){return d.emit("messageUpdated",f)}),f}},{key:"_getMessages",value:function(b,c,d){var f=this;c=(0,e.default)(c)&&c>=0?c:"end",b=b||30;var g="backwards"===d?"desc":"asc";return this.subscribe().then(function(a){return a.getItems({from:"end"!==c?c:void 0,pageSize:b,order:g})}).then(function(a){return f._wrapPaginator(g,a,function(a){return i.default.all(a.map(function(a){return f._upsertMessage(a.index,a.value)}))})})}}]),b}(y);b.exports=B},{"../message":242,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/number/is-integer":6,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,loglevel:172}],237:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/define-properties"),e=j(d),f=a("babel-runtime/helpers/classCallCheck"),g=j(f),h=a("babel-runtime/helpers/createClass"),i=j(h),k=a("../util").UriBuilder,l=a("../restpaginator"),m=a("../channeldescriptor"),n=function(){function a(b,c,d,f){(0,g.default)(this,a),(0,e.default)(this,{_config:{value:b},_client:{value:c},_transport:{value:d},_url:{value:f}})}return(0,i.default)(a,[{key:"getChannels",value:function(b){var c=this;b=b||{};var d=new k(this._url).arg("PageToken",b.pageToken).build();return this._transport.get(d).then(function(a){return a.body}).then(function(a){return new l(a.channels.map(function(a){return new m(c._client,a)}),function(a){return c.getChannels({pageToken:a})},a.meta.prev_token,a.meta.next_token)})}},{key:"getChannelBySid",value:function(b){var c=this,d=new k(this._url).path(b).build();return this._transport.get(d).then(function(a){return a.body}).then(function(a){return new m(c._client,a)})}},{key:"getChannelByUniqueName",value:function(b){var c=this,d=new k(this._url).path(encodeURIComponent(b)).build();return this._transport.get(d).then(function(a){return a.body}).then(function(a){return new m(c._client,a)})}}]),a}();b.exports=n},{"../channeldescriptor":231,"../restpaginator":243,"../util":251,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],238:[function(a,b,c){"use strict";function r(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/map"),e=r(d),f=a("babel-runtime/core-js/object/define-properties"),g=r(f),h=a("babel-runtime/core-js/object/get-prototype-of"),i=r(h),j=a("babel-runtime/helpers/classCallCheck"),k=r(j),l=a("babel-runtime/helpers/createClass"),m=r(l),n=a("babel-runtime/helpers/possibleConstructorReturn"),o=r(n),p=a("babel-runtime/helpers/inherits"),q=r(p),s=a("events").EventEmitter,t=a("../userinfo"),u=function(a){function b(a,c){(0,k.default)(this,b);var d=(0,o.default)(this,(b.__proto__||(0,i.default)(b)).call(this)),f=new t(null,null,c,a);return f.on("updated",function(){return d.emit("userInfoUpdated",f)}),(0,g.default)(d,{_session:{value:a},_datasync:{value:c},_infos:{value:new e.default},_identity:{value:null,writable:!0},myUserInfo:{enumerable:!0,get:function(){return f}}}),d._session.getUserInfosData().then(function(a){return d._identity=a.identity,f._identity=a.identity,f._entityName=a.userInfo,d._infos.set(a.identity,f),f._ensureFetched()}),d}return(0,q.default)(b,a),(0,m.default)(b,[{key:"getMyUserInfo",value:function(){var b=this;return this._session.getUserInfosData().then(function(a){return b.getUserInfo(a.identity,a.userInfo)})}},{key:"getUserInfo",value:function(b,c){var d=this,e=this._infos.get(b);return e||(e=new t(b,c||null,this._datasync,this._session),this._infos.set(b,e),e.on("updated",function(){return d.emit("userInfoUpdated",e)})),e._ensureFetched()}}]),b}(s);b.exports=u},{"../userinfo":249,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],239:[function(a,b,c){"use strict";var d=a("./client");b.exports=d},{"./client":232}],240:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}function n(a,b){return[a].concat((0,k.default)(b))}var d=a("babel-runtime/core-js/object/define-properties"),e=l(d),f=a("babel-runtime/helpers/classCallCheck"),g=l(f),h=a("babel-runtime/helpers/createClass"),i=l(h),j=a("babel-runtime/core-js/array/from"),k=l(j),m=a("loglevel"),o=function(){function a(){(0,g.default)(this,a),(0,e.default)(this,{_prefix:{value:"",writable:!0}})}return(0,i.default)(a,[{key:"setLevel",value:function(b){m.setLevel(b)}},{key:"trace",value:function(){m.trace.apply(null,n("Chat T:"+this._prefix,arguments))}},{key:"debug",value:function(){m.debug.apply(null,n("Chat D:"+this._prefix,arguments))}},{key:"info",value:function(){m.info.apply(null,n("Chat I:"+this._prefix,arguments))}},{key:"warn",value:function(){m.warn.apply(null,n("Chat W:"+this._prefix,arguments))}},{key:"error",value:function(){m.error.apply(null,n("Chat E:"+this._prefix,arguments))}}],[{key:"scope",value:function(c){return this._prefix+=" "+c,new a}},{key:"setLevel",value:function(b){m.setLevel(b)}},{key:"trace",value:function(){m.trace.apply(null,n("Chat T:",arguments))}},{key:"debug",value:function(){m.debug.apply(null,n("Chat D:",arguments))}},{key:"info",value:function(){m.info.apply(null,n("Chat I:",arguments))}},{key:"warn",value:function(){m.warn.apply(null,n("Chat W:",arguments))}},{key:"error",value:function(){m.error.apply(null,n("Chat E:",arguments))}}]),a}();b.exports=o},{"babel-runtime/core-js/array/from":1,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,loglevel:172}],241:[function(a,b,c){"use strict";function p(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/define-properties"),e=p(d),f=a("babel-runtime/core-js/object/get-prototype-of"),g=p(f),h=a("babel-runtime/helpers/classCallCheck"),i=p(h),j=a("babel-runtime/helpers/createClass"),k=p(j),l=a("babel-runtime/helpers/possibleConstructorReturn"),m=p(l),n=a("babel-runtime/helpers/inherits"),o=p(n),q=a("events").EventEmitter,r=function(a){function b(a,c,d,f){(0,i.default)(this,b);var h=(0,m.default)(this,(b.__proto__||(0,g.default)(b)).call(this)),j=!1,k=null,l=c.identity,n=c.roleSid||null,o="undefined"!=typeof c.lastConsumedMessageIndex?c.lastConsumedMessageIndex:null,p=c.lastConsumptionTimestamp?new Date(c.lastConsumptionTimestamp):null;if(!c.identity)throw new Error("Received invalid Member object from server: Missing identity.");return(0,e.default)(h,{_identity:{get:function(){return l},set:function(b){return l=b}},_isTyping:{get:function(){return j},set:function(b){return j=b}},_lastConsumedMessageIndex:{get:function(){return o},set:function(b){return o=b}},_lastConsumptionTimestamp:{get:function(){return p},set:function(b){return p=b}},_roleSid:{get:function(){return n},set:function(b){return n=b}},_typingTimeout:{writable:!0,value:k},channel:{enumerable:!0,value:a},identity:{enumerable:!0,get:function(){return l}},isTyping:{enumerable:!0,get:function(){return j}},lastConsumedMessageIndex:{enumerable:!0,get:function(){return o}},lastConsumptionTimestamp:{enumerable:!0,get:function(){return p}},roleSid:{enumerable:!0,get:function(){return n}},sid:{enumerable:!0,value:d},userInfo:{enumerable:!0,get:function(){return f}}}),f.on("updated",function(){return h.emit("userInfoUpdated",h)}),h}return(0,o.default)(b,a),(0,k.default)(b,[{key:"_startTyping",value:function(b){var c=this;return clearTimeout(this._typingTimeout),this._isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this._typingTimeout=setTimeout(function(){return c._endTyping()},b),this}},{key:"_endTyping",value:function(){this._typingTimeout&&(this._isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this._typingTimeout),this._typingTimeout=null)}},{key:"_update",value:function(b){var c=!1;if(b.roleSid&&this._roleSid!==b.roleSid&&(this._roleSid=b.roleSid,c=!0),"undefined"!=typeof b.lastConsumedMessageIndex&&this._lastConsumedMessageIndex!==b.lastConsumedMessageIndex&&(this._lastConsumedMessageIndex=b.lastConsumedMessageIndex,c=!0),b.lastConsumptionTimestamp){var d=new Date(b.lastConsumptionTimestamp);this._lastConsumptionTimestamp&&this._lastConsumptionTimestamp.getTime()===d.getTime()||(this._lastConsumptionTimestamp=d,c=!0)}c&&this.emit("updated",this)}},{key:"remove",value:function(){return this.channel.removeMember(this)}}]),b}(q);b.exports=r},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],242:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}function x(a,b){try{return b?JSON.parse(b):{}}catch(b){return v.warn("Got malformed attributes for the message",a),{}}}var d=a("babel-runtime/core-js/json/stringify"),e=t(d),f=a("babel-runtime/core-js/promise"),g=t(f),h=a("babel-runtime/core-js/object/define-properties"),i=t(h),j=a("babel-runtime/core-js/object/get-prototype-of"),k=t(j),l=a("babel-runtime/helpers/classCallCheck"),m=t(l),n=a("babel-runtime/helpers/createClass"),o=t(n),p=a("babel-runtime/helpers/possibleConstructorReturn"),q=t(p),r=a("babel-runtime/helpers/inherits"),s=t(r),u=a("events").EventEmitter,v=a("./logger"),w=a("./util").isDeepEqual,y=function(a){function b(a,c,d){(0,m.default)(this,b);var e=(0,q.default)(this,(b.__proto__||(0,k.default)(b)).call(this)),f=d.text,g=d.dateUpdated?new Date(d.dateUpdated):null,h=d.lastUpdatedBy?d.lastUpdatedBy:null;return(0,i.default)(e,{_body:{get:function(){return f},set:function(b){return f=b}},_dateUpdated:{get:function(){return g},set:function(b){return g=b}},_lastUpdatedBy:{get:function(){return h},set:function(b){return h=b}},_attributes:{value:x(d.sid,d.attributes),writable:!0},author:{enumerable:!0,value:d.author},body:{enumerable:!0,get:function(){return f}},channel:{enumerable:!0,value:a},dateUpdated:{enumerable:!0,get:function(){return g}},index:{enumerable:!0,value:parseInt(c)},lastUpdatedBy:{enumerable:!0,get:function(){return h}},sid:{enumerable:!0,value:d.sid},timestamp:{enumerable:!0,value:new Date(d.timestamp)},attributes:{enumerable:!0,get:function(){return e._attributes}}}),e}return(0,s.default)(b,a),(0,o.default)(b,[{key:"_update",value:function(b){var c=!1;!b.text&&"string"!=typeof b.text||b.text===this._body||(this._body=b.text,c=!0),b.lastUpdatedBy&&b.lastUpdatedBy!==this._lastUpdatedBy&&(this._lastUpdatedBy=b.lastUpdatedBy,c=!0),b.dateUpdated&&new Date(b.dateUpdated).getTime()!==(this._dateUpdated&&this._dateUpdated.getTime())&&(this._dateUpdated=new Date(b.dateUpdated),c=!0);var d=x(this.sid,b.attributes);w(this._attributes,d)||(this._attributes=d,c=!0),c&&this.emit("updated",this)}},{key:"remove",value:function(){var b=this;return this.channel._session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()}).then(function(){return b})}},{key:"updateBody",value:function(b){var c=this;if("string"!=typeof b)throw new Error("Body <String> is a required parameter for updateBody");return this.channel._session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:b}).then(function(){return c})}},{key:"updateAttributes",value:function(b){var c=this;return"undefined"==typeof b?g.default.reject(new Error("Attributes is a required parameter for updateAttributes")):b.constructor!==Object?g.default.reject(new Error("Attributes must be a valid JSON object")):this.channel._session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,e.default)(b)}).then(function(){return c})}}]),b}(u);b.exports=y},{"./logger":240,"./util":251,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],243:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=l(d),f=a("babel-runtime/core-js/object/define-properties"),g=l(f),h=a("babel-runtime/helpers/classCallCheck"),i=l(h),j=a("babel-runtime/helpers/createClass"),k=l(j),m=function(){function a(b,c,d,e){(0,i.default)(this,a),(0,g.default)(this,{prevToken:{value:d},nextToken:{value:e},source:{value:c},hasNextPage:{value:!!e,enumerable:!0},hasPrevPage:{value:!!d,enumerable:!0},items:{get:function(){return b},enumerable:!0}})}return(0,k.default)(a,[{key:"nextPage",value:function(){return this.hasNextPage?this.source(this.nextToken):e.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.source(this.prevToken):e.default.reject(new Error("No previous page"))}}]),a}();b.exports=m},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],244:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/map"),e=l(d),f=a("babel-runtime/core-js/object/define-properties"),g=l(f),h=a("babel-runtime/helpers/classCallCheck"),i=l(h),j=a("babel-runtime/helpers/createClass"),k=l(j),m=function(){function a(b,c){(0,i.default)(this,a),(0,g.default)(this,{_session:{value:c},_consumptionHorizonReports:{value:new e.default},_consumptionHorizonUpdateTimer:{value:null,writable:!0}})}return(0,k.default)(a,[{key:"_getReportInterval",value:function(){return this._session.getConsumptionReportInterval().then(function(a){return 1e3*a.seconds})}},{key:"_delayedSendConsumptionHorizon",value:function(b){var c=this;null===this._consumptionHorizonUpdateTimer&&(this._consumptionHorizonUpdateTimer=setTimeout(function(){var a=[];c._consumptionHorizonReports.forEach(function(b){return a.push(b)}),a.length>0&&c._session.addCommand("consumptionReport",{report:a}),c._consumptionHorizonUpdateTimer=null,c._consumptionHorizonReports.clear()},b))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(b,c){var d=this;this._consumptionHorizonReports.set(b,{channelSid:b,messageIdx:c}),this._getReportInterval().then(function(a){return d._delayedSendConsumptionHorizon(a)})}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(b,c){var d=this,e=this._consumptionHorizonReports.get(b);e&&e.messageIdx>=c||(this._consumptionHorizonReports.set(b,{channelSid:b,messageIdx:c}),this._getReportInterval().then(function(a){return d._delayedSendConsumptionHorizon(a)}))}}]),a}();b.exports=m},{"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],245:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=t(d),f=a("babel-runtime/helpers/slicedToArray"),g=t(f),h=a("babel-runtime/core-js/get-iterator"),i=t(h),j=a("babel-runtime/core-js/map"),k=t(j),l=a("babel-runtime/core-js/number/is-integer"),m=t(l),n=a("babel-runtime/core-js/object/define-properties"),o=t(n),p=a("babel-runtime/helpers/classCallCheck"),q=t(p),r=a("babel-runtime/helpers/createClass"),s=t(r),u=function(){function a(b,c,d){(0,q.default)(this,a),(0,o.default)(this,{_config:{value:b},_transport:{value:d},_session:{value:c},_cacheLifetime:{value:(0,m.default)(b.httpCacheLifetimeOverride)?b.httpCacheLifetimeOverride:b.httpCacheLifetimeDefault,writable:!0},_cache:{value:new k.default},_timer:{value:null,writable:!0}})}return(0,s.default)(a,[{key:"_isExpired",value:function(b){return!this._cacheLifetime||Date.now()-b>this._cacheLifetime}},{key:"_cleanupCache",value:function(){var b=!0,c=!1,d=void 0;try{for(var f,e=(0,i.default)(this._cache);!(b=(f=e.next()).done);b=!0){var h=(0,g.default)(f.value,2),j=h[0],k=h[1];this._isExpired(k.timestamp)&&this._cache.delete(j)}}catch(a){c=!0,d=a}finally{try{!b&&e.return&&e.return()}finally{if(c)throw d}}0===this._cache.size&&clearTimeout(this._timer)}},{key:"_pokeTimer",value:function(){var b=this;this._timer=this._timer||setInterval(function(){return b._cleanupCache()},2*this._cacheLifetime)}},{key:"get",value:function(b){var c=this,d=this._cache.get(b);if(d&&!this._isExpired(d.timestamp))return e.default.resolve(d.response);var f={"X-Twilio-Token":this._config.token};return this._transport.get(b,f).then(function(a){return c._cache.set(b,{response:a,timestamp:Date.now()}),c._pokeTimer(),a})}}]),a}();b.exports=u},{"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/map":5,"babel-runtime/core-js/number/is-integer":6,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/slicedToArray":26}],246:[function(a,b,c){"use strict";function n(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=n(d),f=a("babel-runtime/core-js/map"),g=n(f),h=a("babel-runtime/core-js/object/define-properties"),i=n(h),j=a("babel-runtime/helpers/classCallCheck"),k=n(j),l=a("babel-runtime/helpers/createClass"),m=n(l),o=a("../logger").scope("TypingIndicator"),p="twilio.ipmsg.typing_indicator",q=function(){function a(b,c,d,e){var f=this;(0,k.default)(this,a),(0,i.default)(this,{_transport:{value:c},_notifications:{value:d},_config:{value:b},_typingTimeout:{value:null,writable:!0},_sentUpdates:{value:new g.default},_getChannel:{value:e},token:{get:function(){return b.token}},typingTimeout:{get:function(){return b.typingIndicatorTimeoutOverride||f._typingTimeout||b.typingIndicatorTimeoutDefault}}})}return(0,m.default)(a,[{key:"initialize",value:function(){var b=this;this._notifications.subscribe(p,"twilsock"),this._notifications.on("message",function(a,c){a===p&&b._handleRemoteTyping(c)})}},{key:"_handleRemoteTyping",value:function(b){var c=this;o.trace("Got new typing indicator ",b),this._getChannel(b.channel_sid).then(function(a){a&&a._members.forEach(function(a){a.identity===b.identity&&a._startTyping(c.typingTimeout)})}).catch(function(a){throw o.error(a),a})}},{key:"send",value:function(b){var c=this._sentUpdates.get(b);return c&&c>Date.now()-this.typingTimeout?e.default.resolve():(this._sentUpdates.set(b,Date.now()),this._send(b))}},{key:"_send",value:function(b){var c=this;o.trace("Sending typing indicator");var d=this._config.typingIndicatorUri,e={"X-Twilio-Token":this.token,"Content-Type":"application/x-www-form-urlencoded"},f="ChannelSid="+b;return this._transport.post(d,e,f).then(function(a){a.body.hasOwnProperty("typing_timeout")&&(c._typingTimeout=1e3*a.body.typing_timeout)}).catch(function(a){throw o.error("Failed to send typing indicator:",a),a})}}]),a}();b.exports=q},{"../logger":240,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],247:[function(a,b,c){"use strict";function n(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/promise"),e=n(d),f=a("babel-runtime/core-js/map"),g=n(f),h=a("babel-runtime/core-js/object/define-properties"),i=n(h),j=a("babel-runtime/helpers/classCallCheck"),k=n(j),l=a("babel-runtime/helpers/createClass"),m=n(l),o=a("uuid"),p=a("platform"),q=a("./logger").scope("Session"),r=a("./util/changetracker"),s=a("./sessionerror"),t=a("durational"),u=a("./../package.json").version,v="com.twilio.rtd.ipmsg",w=function(){function a(b,c,d){var e=this;(0,k.default)(this,a);var f="undefined"!=typeof navigator?p.parse(navigator.userAgent):p;(0,i.default)(this,{_endpointPlatform:{value:["js",u,f.os,f.name,f.version].join("|")},_pendingCommands:{value:new g.default},_sessionContextChangeTracker:{value:new r},_sessionStreamPromise:{value:null,writable:!0},_config:{value:d},_token:{value:null,writable:!0},_tokenSynced:{value:!0,writable:!0},identity:{enumerable:!0,get:function(){return e._sessionContextChangeTracker._data.identity}},userInfo:{enumerable:!0,get:function(){return e._sessionContextChangeTracker._data.userInfo}},reachabilityEnabled:{enumerable:!0,get:function(){return e._sessionContextChangeTracker._data.reachabilityEnabled}},datasync:{enumerable:!0,value:b},transport:{value:c}})}return(0,m.default)(a,[{key:"initialize",value:function(b){var c=this;this._token=b,this._tokenSynced=!1;var d={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this._endpointPlatform,token:b};return this._sessionStreamPromise=this.datasync.list({purpose:v,context:d}).then(function(a){return q.info("Session created",a.sid),c._tokenSynced=!0,a.on("itemAdded",function(a){return c._processCommandResponse(a)}),a.on("itemUpdated",function(a){return c._processCommandResponse(a)}),a.on("contextUpdated",function(a){q.info("Session context updated"),q.debug("new session context:",a),c._sessionContextChangeTracker.update(a)}),a}).catch(function(a){throw q.error("Failed to create session",a),a}),this._sessionStreamPromise}},{key:"addCommand",value:function(b,c){return this._processCommand(b,c)}},{key:"_processCommand",value:function(b,c){var d=this,f={request:c};return f.request.action=b,f.commandId=o.v4(),q.info("Adding command: ",b,f.commandId),q.debug("command arguments:",c),new e.default(function(a,b){d._sessionStreamPromise.then(function(c){return d._pendingCommands.set(f.commandId,{resolve:a,reject:b}),c.push(f)}).then(function(){return q.debug("Command accepted by server",f.commandId)}).catch(function(a){d._pendingCommands.delete(f.commandId),q.error("Failed to add a command to the session",a),b(new Error("Can't add command: "+a.description))})})}},{key:"_processCommandResponse",value:function(b){if(b.value.hasOwnProperty("response")&&b.value.hasOwnProperty("commandId")&&this._pendingCommands.has(b.value.commandId)){var c=b.value,d=b.value.commandId;if(200===c.response.status){q.debug("Command succeeded: ",c);var e=this._pendingCommands.get(d).resolve;this._pendingCommands.delete(d),e(c.response)}else{q.error("Command failed: ",c);var f=this._pendingCommands.get(d).reject;this._pendingCommands.delete(d),f(new s(c.response.statusText,c.response.status))}}}},{key:"updateToken",value:function(b){return this._token=b,this._tokenSynced=!1,this.syncToken()}},{key:"syncToken",value:function(){var b=this;return this._tokenSynced?e.default.resolve():this._sessionStreamPromise.then(function(a){return a.getContext().then(function(c){return c.token=b._token,a.updateContext(c)}).then(function(){b._tokenSynced=!0})}).catch(function(a){throw q.error("Couldn't update the token in session context",a),new Error(a)})}},{key:"onKeyUpdated",value:function(b,c){this._sessionContextChangeTracker.addEventHandler("keyAdded",b,c),this._sessionContextChangeTracker.addEventHandler("keyUpdated",b,c)}},{key:"getSessionLinks",value:function(){var b=this;return new e.default(function(a){b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(c){c.hasOwnProperty("links")?a(c.links):b.onKeyUpdated("/links",function(){b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(b){return a(b.links)})})})}).then(function(a){return{publicChannelsUrl:b._config.baseUrl+a.publicChannelsUrl,myChannelsUrl:b._config.baseUrl+a.myChannelsUrl,typingUrl:b._config.baseUrl+a.typingUrl}})}},{key:"getChannelsId",value:function(){var b=this;return new e.default(function(a){b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(c){c.hasOwnProperty("channelsUrl")?a(c.channels):b.onKeyUpdated("/channels",a)})})}},{key:"getMyChannelsId",value:function(){var b=this;return new e.default(function(a){b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(c){c.hasOwnProperty("myChannels")?a(c.myChannels):b.onKeyUpdated("/myChannels",a)})})}},{key:"getUserInfosData",value:function(){var b=this;return new e.default(function(a){function c(b){a({userInfo:b.userInfo,identity:b.identity})}b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(a){a.hasOwnProperty("userInfo")?c(a):b.onKeyUpdated("/userInfo",function(){b._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(a){return c(a)})})})})}},{key:"getConsumptionReportInterval",value:function(){var b=this;return this._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(a){return t.fromString(b._config.consumptionReportIntervalOverride||a.consumptionReportInterval||b._config.consumptionReportIntervalDefault)})}}]),a}();b.exports=w},{"./../package.json":229,"./logger":240,"./sessionerror":248,"./util/changetracker":250,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,durational:167,platform:174,uuid:224}],248:[function(a,b,c){"use strict";function l(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/core-js/object/get-prototype-of"),e=l(d),f=a("babel-runtime/helpers/classCallCheck"),g=l(f),h=a("babel-runtime/helpers/possibleConstructorReturn"),i=l(h),j=a("babel-runtime/helpers/inherits"),k=l(j),m=function(a){function b(a,c){(0,g.default)(this,b);var d=(0,i.default)(this,(b.__proto__||(0,e.default)(b)).call(this));return d.name=d.constructor.name,d.message=a,d.code=c,Error.captureStackTrace?Error.captureStackTrace(d,d.constructor):d.stack=(new Error).stack,d}return(0,k.default)(b,a),b}(Error);b.exports=m},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25}],249:[function(a,b,c){"use strict";function x(a){return a&&a.__esModule?a:{default:a}}var d=a("babel-runtime/regenerator"),e=x(d),f=a("babel-runtime/core-js/json/stringify"),g=x(f),h=a("babel-runtime/helpers/asyncToGenerator"),i=x(h),j=a("babel-runtime/core-js/promise"),k=x(j),l=a("babel-runtime/core-js/object/define-properties"),m=x(l),n=a("babel-runtime/core-js/object/get-prototype-of"),o=x(n),p=a("babel-runtime/helpers/classCallCheck"),q=x(p),r=a("babel-runtime/helpers/createClass"),s=x(r),t=a("babel-runtime/helpers/possibleConstructorReturn"),u=x(t),v=a("babel-runtime/helpers/inherits"),w=x(v),y=a("events").EventEmitter,z=a("./logger").scope("UserInfo"),A=function(a){
function b(a,c,d,e){(0,q.default)(this,b);var f=(0,u.default)(this,(b.__proto__||(0,o.default)(b)).call(this));return f.setMaxListeners(0),(0,m.default)(f,{_datasync:{value:d},_session:{value:e},_identity:{value:a,writable:!0},_entityName:{value:c,writable:!0},_attributes:{value:{},writable:!0},_friendlyName:{value:null,writable:!0},_online:{value:null,writable:!0},_notifiable:{value:null,writable:!0},_promiseToFetch:{writable:!0},identity:{enumerable:!0,get:function(){return f._identity}},attributes:{enumerable:!0,get:function(){return f._attributes}},friendlyName:{enumerable:!0,get:function(){return f._friendlyName}},online:{enumerable:!0,get:function(){return f._online}},notifiable:{enumerable:!0,get:function(){return f._notifiable}}}),f}return(0,w.default)(b,a),(0,s.default)(b,[{key:"_update",value:function(b,c){switch(z.debug("UserInfo for",this._identity,"updated:",b,c),b){case"friendlyName":this._friendlyName=c.value;break;case"attributes":try{this._attributes=JSON.parse(c.value)}catch(a){this._attributes={}}break;case"reachability":this._online=c.online,this._notifiable=c.notifiable;break;default:return}this.emit("updated",b)}},{key:"_updateReachabilityInfo",value:function(b,c){var d=this;return this._session.reachabilityEnabled?b.get("reachability").then(c).catch(function(a){z.warn("Failed to get reachability info for ",d._identity,a)}):k.default.resolve()}},{key:"_fetch",value:function(){var b=this;if(!this._entityName)return k.default.resolve(this);var c=function(c){return b._update(c.key,c.value)};return this._promiseToFetch=this._datasync.map({uniqueName:this._entityName,mode:"open"}).then(function(a){return a.on("itemUpdated",c),k.default.all([a.get("friendlyName").then(c),a.get("attributes").then(c),b._updateReachabilityInfo(a,c)])}).then(function(){return z.debug("Fetched for",b.identity),b}).catch(function(a){throw b._promiseToFetch=null,a}),this._promiseToFetch}},{key:"_ensureFetched",value:function(){return this._promiseToFetch||this._fetch()}},{key:"updateAttributes",value:function(){function b(b){return a.apply(this,arguments)}var a=(0,i.default)(e.default.mark(function a(b){return e.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(b&&b.constructor===Object){c.next=2;break}throw new Error("Attributes must be an object.");case 2:return c.next=4,this._session.addCommand("editUserAttributes",{username:this._identity,attributes:(0,g.default)(b)});case 4:return c.abrupt("return",this);case 5:case"end":return c.stop()}},a,this)}));return b}()},{key:"updateFriendlyName",value:function(){function b(b){return a.apply(this,arguments)}var a=(0,i.default)(e.default.mark(function a(b){return e.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!b||"string"==typeof b){c.next=2;break}throw new Error("friendlyName must be string or empty.");case 2:return c.next=4,this._session.addCommand("editUserFriendlyName",{username:this._identity,friendlyName:b});case 4:return c.abrupt("return",this);case 5:case"end":return c.stop()}},a,this)}));return b}()}]),b}(y);b.exports=A},{"./logger":240,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/asyncToGenerator":20,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169}],250:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}function j(a){var b=this;(0,e.default)(this,{_pendingListeners:{value:{}},_data:{value:a||{},writable:!0}}),g.call(this),["keyAdded","keyRemoved","keyUpdated"].forEach(function(a){b._pendingListeners[a]={},b.on(a,function(c,d){var e=b._pendingListeners[a][c]||[];e.forEach(function(a){return a(d)}),b._pendingListeners[a][c]=[]})})}var d=a("babel-runtime/core-js/object/define-properties"),e=f(d),g=a("events").EventEmitter,h=a("util").inherits,i=a("rfc6902");h(j,g),j.prototype._traverse=function(a,b){var c=this,d=i.createPatch(a,b);d.forEach(function(a){"add"===a.op?c.emit("keyAdded",a.path,a.value):"replace"===a.op?c.emit("keyUpdated",a.path,a.value):"remove"===a.op&&c.emit("keyRemoved",a.path)})},j.prototype.update=function(a){var b=this._data;this._data=a,this._traverse(b,a)},j.prototype.addEventHandler=function(a,b,c){var d=this._pendingListeners[a][b]||[];d.push(c),this._pendingListeners[a][b]=d},b.exports=j},{"babel-runtime/core-js/object/define-properties":9,events:169,rfc6902:181,util:223}],251:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{default:a}}function h(a,b){return 0===g.createPatch(a,b).length}function i(a){(0,e.default)(this,{base:{value:a.replace(/\/$/,"")},paths:{value:[]},args:{value:[]}}),this.arg=function(a,b){return"undefined"!=typeof b&&this.args.push(a+"="+b),this},this.path=function(a){return this.paths.push(a),this},this.build=function(){var a=this.base;return this.paths.length&&(a+="/"+this.paths.join("/")),this.args.length&&(a+="?"+this.args.join("&")),a}}var d=a("babel-runtime/core-js/object/define-properties"),e=f(d),g=a("rfc6902");b.exports.isDeepEqual=h,b.exports.UriBuilder=i},{"babel-runtime/core-js/object/define-properties":9,rfc6902:181}]},{},[239])(239)});