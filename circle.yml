dependencies:
  pre:
    # PhantomJS 2.1.1 by default on CircleCI Ubuntu 14.04, https://circleci.com/docs/build-image-trusty/#phantomjs
    # Elasticsearch 1.7.2 by default on CircleCI Ubuntu 14.04, https://circleci.com/docs/build-image-trusty/#elasticsearch
    # git-lfs
    - sudo mkdir -p /usr/etc/ && sudo touch /usr/etc/gitconfig
    - curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
    - sudo apt-get install git-lfs=1.4.1
    - ssh git@github.com git-lfs-authenticate fameandpartners/website.git download
    - git lfs pull
    # npm and bundle JS
    - npm install
    - npm run production

machine:
  ruby:
    version: 2.1.6
  node:
    version: 6.3.0
  services:
    - elasticsearch

general:
  artifacts:
    - "tmp/capybara"

test:
  override:
    - bundle exec rspec spec engines --tag $RSPEC_EXCLUDE_FLAGS -r rspec_junit_formatter --format progress --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
